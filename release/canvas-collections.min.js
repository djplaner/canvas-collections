class cc_ConfigurationModel{constructor(controller){DEBUG&&console.log("-------------- cc_ConfigurationModel.constructor()"),this.controller=controller,this.configShowing=!1,this.CONFIG_SHOW_ICONS={true:"icon-mini-arrow-down",false:"icon-mini-arrow-right"},this.availableRepresentations=["GriffithCards","CollectionOnly","AssessmentTable"]}isOn(){return DEBUG&&console.log(`-------------- cc_ConfigurationModel.isOn() - ${this.controller.parentController.ccOn}`),this.controller.parentController.ccOn}isPublished(){return this.controller.parentController.published}getCourseId(){return this.controller.parentController.courseId}turnOn(){DEBUG&&console.log("-------------- cc_ConfigurationModel.turnOn()"),this.controller.parentController.ccOn=!0,this.controller.parentController.cc_configuration.STATUS="on"}turnOff(){DEBUG&&console.log("-------------- cc_ConfigurationModel.turnOff()"),this.controller.parentController.ccOn=!1,this.controller.parentController.cc_configuration.STATUS="off"}getConfigShowing(){return this.configShowing}getStudyPeriod(){return this.controller.parentController.hasOwnProperty("calendar")&&this.controller.parentController.hasOwnProperty("studyPeriod")&&this.controller.parentController.studyPeriod?this.controller.parentController.studyPeriod:this.controller.parentController.hasOwnProperty("calendar")?`${this.controller.parentController.calendar.defaultPeriod} (default)`:""}getModuleDetails(){return DEBUG&&console.log("-------------- cc_ConfigurationModel.getModuleDetails()"),this.controller.parentController.mergedModuleDetails}setModuleConfigClass(moduleId,newClass){DEBUG&&console.log(`-------------- cc_ConfigurationModel.setModuleConfigClass() - ${moduleId} ${newClass}`);const module=this.controller.parentController.mergedModuleDetails[moduleId];module.configClass="icon-mini-arrow-down"===newClass?"icon-mini-arrow-right":"icon-mini-arrow-down"}getConfigShowClass(){return this.CONFIG_SHOW_ICONS[this.configShowing]}getOtherConfigShowClass(className){return this.CONFIG_SHOW_ICONS[!1]===className?this.CONFIG_SHOW_ICONS[!0]:this.CONFIG_SHOW_ICONS[!1]}setConfigShowClass(newClass){this.CONFIG_SHOW_ICONS[!1]===newClass?this.configShowing=!1:this.configShowing=!0,DEBUG&&console.log(`-------------- cc_ConfigurationModel.setConfigShowClass() - ${newClass} change to - ${this.configShowing}`)}getExistingCollectionNames(){return DEBUG&&console.log("-------------- cc_ConfigurationModel.getExistingCollectionNames()"),this.controller.parentController.cc_configuration.COLLECTIONS_ORDER}setExistingCollectionNames(collectionNames){DEBUG&&console.log("-------------- cc_ConfigurationModel.setExistingCollectionNames()"),this.controller.parentController.cc_configuration.COLLECTIONS_ORDER=collectionNames}getModuleCount(collectionName){DEBUG&&console.log("-------------- cc_ConfigurationModel.getModuleCount()");const modules=this.controller.parentController.cc_configuration.MODULES;let count=0;for(const id in modules)modules[id].collection===collectionName&&count++;return count}getEditMode(){return this.controller.parentController.editMode}getModuleConfiguration(id){return this.controller.parentController.cc_configuration.MODULES[id]}addModuleConfiguration(module){return this.controller.parentController.cc_configuration.MODULES[module.id]={name:module.name,id:module.id,description:"",label:"",num:"",image:""},this.controller.parentController.mergeModuleDetails(),this.controller.changeMade(!0),this.controller.parentController.cc_configuration.MODULES[module.id]}getDefaultCollection(){return DEBUG&&console.log("-------------- cc_ConfigurationModel.getDefaultCollection()"),this.controller.parentController.cc_configuration.DEFAULT_ACTIVE_COLLECTION}setDefaultCollection(collectionName){DEBUG&&console.log("-------------- cc_ConfigurationModel.setDefaultCollection()"),this.controller.parentController.cc_configuration.DEFAULT_ACTIVE_COLLECTION=collectionName}getCollectionRepresentation(collectionName){return DEBUG&&console.log("-------------- cc_ConfigurationModel.getCollectionRepresentation()"),console.log(`representation is ${this.controller.parentController.cc_configuration.COLLECTIONS[collectionName].representation}`),this.controller.parentController.cc_configuration.COLLECTIONS[collectionName].representation}getCollectionAttribute(collectionName,attribute){if(DEBUG&&console.log("-------------- cc_ConfigurationModel.getCollectionAttribute()"),this.controller.parentController.cc_configuration.COLLECTIONS[collectionName]&&this.controller.parentController.cc_configuration.COLLECTIONS[collectionName][attribute])return this.controller.parentController.cc_configuration.COLLECTIONS[collectionName][attribute]}setCollectionAttribute(collectionName,attribute,value){return DEBUG&&console.log("-------------- cc_ConfigurationModel.setCollectionAttribute()"),!!this.controller.parentController.cc_configuration.COLLECTIONS[collectionName]&&(this.controller.parentController.cc_configuration.COLLECTIONS[collectionName][attribute]=value,!0)}setCollectionRepresentation(collectionName,representation){DEBUG&&console.log("-------------- cc_ConfigurationModel.setCollectionRepresentation()"),this.controller.parentController.cc_configuration.COLLECTIONS[collectionName].representation=representation}getCollections(){return DEBUG&&console.log("-------------- cc_ConfigurationModel.getCollections()"),Object.keys(this.controller.parentController.cc_configuration.COLLECTIONS)}getCurrentCollection(){return DEBUG&&console.log("-------------- cc_ConfigurationModel.getCurrentCollection()"),this.controller.parentController.collectionsController.model.currentCollection}addNewCollection(newCollection){let cc_configuration=this.controller.parentController.cc_configuration;cc_configuration.COLLECTIONS[newCollection.name]={representation:newCollection.representation,description:newCollection.description},cc_configuration.COLLECTIONS_ORDER.push(newCollection.name);const currentDefault=this.getDefaultCollection();currentDefault&&""!==currentDefault||(cc_configuration.DEFAULT_ACTIVE_COLLECTION=newCollection.name)}deleteCollection(collectionName){let cc_configuration=this.controller.parentController.cc_configuration;cc_configuration.COLLECTIONS.hasOwnProperty(collectionName)&&delete cc_configuration.COLLECTIONS[collectionName];let index=cc_configuration.COLLECTIONS_ORDER.indexOf(collectionName);index>-1&&cc_configuration.COLLECTIONS_ORDER.splice(index,1),collectionName===cc_configuration.DEFAULT_ACTIVE_COLLECTION&&(cc_configuration.DEFAULT_ACTIVE_COLLECTION=cc_configuration.COLLECTIONS_ORDER[0]);for(const moduleId in cc_configuration.MODULES)cc_configuration.MODULES[moduleId].collection===collectionName&&(cc_configuration.MODULES[moduleId].collection=null)}changeModuleDisplay(moduleId,accordionName,eventType){const module=this.findModuleById(moduleId);if(module){module.hasOwnProperty("configDisplay")||(module.configDisplay={accordions:{dates:"",banner:"",metadata:""}});["dates","banner","metadata"].includes(accordionName)&&("sl-show"===eventType?module.configDisplay.accordions[accordionName]="open":"sl-hide"===eventType&&(module.configDisplay.accordions[accordionName]=""))}}changeModuleConfig(moduleId,fieldName,value){const module=this.findModuleById(moduleId);if(module){if(["day","week","time","date-label","day-to","week-to","time-to"].includes(fieldName))return module.hasOwnProperty("date")||(module.date={label:"",day:"",week:"",time:"",to:{day:"",week:"",time:""}}),module.date.hasOwnProperty("to")||(module.date.to={day:"",week:"",time:""}),"date-label"===fieldName&&(fieldName="label"),fieldName.includes("-to")?(fieldName=fieldName.replace("-to",""),module.date.to[fieldName]=value):module.date[fieldName]=value,!0;if("autonum"===fieldName&&(value?delete module.num:module.num=""),"iframe"===fieldName){let match=value.toLowerCase().match(/^.*(<iframe.*?src=".*?".*?<\/iframe>).*$/);if(!match)return alert("Configured iframe value does not appear to be a standard HTML iframe."),!1;{value=match[1];const updatedValue=this.prepareIframe(value);updatedValue!==value&&(value=updatedValue,alert("The iframe has been updated to work better with Collections. Changes include\n1. Modify width and height to fit.\n2. Remove any style attributes."))}}if("image"===fieldName&&""!==value&&!value.match(/^https?:\/\/.*/))return alert(`The image url field must be either a valid URL or valid iframe. It appears to be neither.\nCurrent value is\n\n${value}`),!1;const match=fieldName.match(/^metadata-(.*)-value$/);if(match)return fieldName=match[1],module.metadata[fieldName]=value,!0;module[fieldName]=value}}prepareIframe(iframe){return(iframe=(iframe=iframe.replace(/height=".*?"/,'height="auto"')).replace(/width=".*?"/,'width="100%"')).match(/height=".*?"/)||(iframe=iframe.replace(/<iframe/,'<iframe height="auto"')),iframe.match(/width=".*?"/)||(iframe=iframe.replace(/<iframe/,'<iframe width="100%"')),iframe=iframe.replace(/style=".*?"/,"")}changeCollectionPage(collectionName,pageType,value){let cc_configuration=this.controller.parentController.cc_configuration;return!(!cc_configuration.COLLECTIONS.hasOwnProperty(collectionName)||"include"!==pageType&&"output"!==pageType||cc_configuration.COLLECTIONS[collectionName][`${pageType}Page`]===value)&&(cc_configuration.COLLECTIONS[collectionName][`${pageType}Page`]=value,!0)}findModuleById(moduleId){return this.controller.parentController.cc_configuration.MODULES[moduleId]}addModuleMetadata(moduleId,fieldName,value){const module=this.findModuleById(moduleId);module&&(module.hasOwnProperty("metadata")||(module.metadata={}),module.metadata[fieldName]=value)}deleteModuleMetadata(moduleId,fieldName){const module=this.findModuleById(moduleId);module&&module.hasOwnProperty("metadata")&&delete module.metadata[fieldName]}getCollectionsWithOutputPage(){const collections=this.controller.parentController.cc_configuration.COLLECTIONS;return Object.keys(collections).filter((collectionName=>{if(collections[collectionName].outputPage&&""!==collections[collectionName].outputPage)return collectionName}))}getPagesWithMultipleCollections(){const collections=this.controller.parentController.cc_configuration.COLLECTIONS,pages={};Object.keys(collections).forEach((collectionName=>{collections[collectionName].outputPage&&""!==collections[collectionName].outputPage&&(pages.hasOwnProperty(collections[collectionName].outputPage)?pages[collections[collectionName].outputPage].push(collectionName):pages[collections[collectionName].outputPage]=[collectionName])}));for(let pageName in pages)pages[pageName].length<2&&delete pages[pageName];return pages}}class cc_View{constructor(model,controller){this.model=model,this.controller=controller,this.controller.hasOwnProperty("parentController")&&this.controller.parentController.hasOwnProperty("calendar")?this.calendar=this.controller.parentController.calendar:this.model.hasOwnProperty("controller")&&this.model.controller.hasOwnProperty("parentController")&&this.model.controller.parentController.hasOwnProperty("calendar")?this.calendar=this.model.controller.parentController.calendar:alert("Another funny calendar miss. Fix it")}addTooltips(){if(this.TOOLTIPS)for(let tooltip of this.TOOLTIPS){const slToolTips=document.querySelectorAll(`sl-tooltip${tooltip.targetSelector}`);for(let slToolTip of slToolTips)if(slToolTip){const anchor=slToolTip.querySelector("a");anchor&&(anchor.href=tooltip.href);const div=slToolTip.querySelector("div");div&&(div.innerHTML=tooltip.contentText)}}}showOnlyCurrentCollectionModules(){if(!this.hasOwnProperty("model")||!this.model.hasOwnProperty("getModulesCollections"))return;const currentCollection=this.model.getCurrentCollection();for(let module of this.model.getModulesCollections())if(module.collection!==currentCollection){document.querySelector(`div.context_module[data-module-id="${module.id}"]`).style.display="none"}else{document.querySelector(`div.context_module[data-module-id="${module.id}"]`).style.display="block"}}generateCalendarDate(dateJson){if(!dateJson)return;const fields=["day","week","time"];let singleDate="";for(let field of fields)dateJson.hasOwnProperty(field)&&(singleDate=`${singleDate}${dateJson[field]}`);let date={};if(date=this.convertUniDateToReal(dateJson),dateJson.hasOwnProperty("to")){let dualDate="";for(let field of fields)dateJson.to.hasOwnProperty(field)&&(dualDate=`${dualDate}${dateJson.to[field]}`);if(""!==dualDate){if(""===singleDate)return{};date.to=this.convertUniDateToReal(dateJson.to)}}return""===singleDate?{}:date}convertUniDateToReal(dateJson){let firstDate={label:""};if(dateJson.hasOwnProperty("label")&&(firstDate.label=dateJson.label),firstDate.week=dateJson.week||"",firstDate.day=dateJson.day||"Monday",firstDate.day=firstDate.day.substring(0,3),firstDate.time=dateJson.time||"",firstDate.time&&(firstDate.time=this.model.convertFrom24To12Format(firstDate.time)),firstDate.month=dateJson.month||"",firstDate.date=dateJson.date||"",""!==firstDate.week){let actualDate={};""===firstDate.day&&this.hasOwnProperty("calendar")?actualDate=this.calendar.getDate(firstDate.week):this.hasOwnProperty("calendar")&&(actualDate=this.calendar.getDate(firstDate.week,!1,firstDate.day)),firstDate.date=actualDate.date,firstDate.month=actualDate.month}return""===firstDate.week&&""===firstDate.time&&""===firstDate.month&&""===firstDate.date?"":firstDate}}const CC_VERSION="0.9.1",CV_DEFAULT_DATE_LABEL="Commencing",CC_UNPUBLISHED_HTML='\n<div class="cc-unpublished"> \n  \t<span style="padding-top: 0.25em;padding-right:0.25em">\n        <sl-tooltip id="cc-about-unpublished">\n\t\t  \t<div slot="content"></div>\n\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t</sl-tooltip>\n  \t\tUnpublished\n\t</span>\n  </a>\n </div>\n',CONFIG_VIEW_TOOLTIPS=[{contentText:'<p>The <em>Canvas Collections Configuration</em> page</a> is unpublished. \n\tThe live Collections view will <strong>not</strong> be visible in "Student View" or for students.</p>\n\t\t<p>Any Claytons Collections will be visible, if the relevant pages are published.</p>',maxWidth:"250px",targetSelector:"#cc-about-unpublished",persistent:!0,href:"https://djplaner.github.io/canvas-collections/reference/on-off-unpublished/"},{contentText:"Add more structure and context specific design to the Canvas module view.",maxWidth:"250px",targetSelector:"#cc-about-collections",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/"},{contentText:"The list of current collections for your course and where you \n\t\t\t\tcan modify their order, appearance etc.",maxWidth:"250px",targetSelector:"#cc-about-existing-collections",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#existing-collections"},{contentText:"Name and choose a representation for a new collection",maxWidth:"250px",targetSelector:"#cc-about-new-collection",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#add-a-new-collection"},{contentText:"Specify how the collection will be displayed by choosing one of the available representations. Representations can be changed at any time.",maxWidth:"250px",targetSelector:"#cc-about-collection-representation",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#add-a-new-collection"},{contentText:"Update all configured output pages and choose an option for the navigation bar.",maxWidth:"250px",targetSelector:"#cc-about-full-claytons",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/representations/claytons/overview"},{contentText:"<p>There are three navigation bar options:</p>\n\t\t<ol>\n\t\t  <li> None - no navigation between pages/collections. </li>\n\t\t  <li> Pages - collections on separate pages with navigation between. </li>\n\t\t  <li> Tabs - multiple collections on a page with tab navigation. </li>\n\t\t</ol>",maxWidth:"250px",targetSelector:"#cc-about-full-claytons-navigation-option",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/representations/claytons/overview/#navigation-bar-options"},{contentText:"The first collection displayed when users visit for the first time.",targetSelector:"#cc-about-default-collection"},{contentText:"<p>Make collection invisible to students. \n\t\t(Note: can't hide the default collection)</p>\n\t\t<p><i class=\"icon-warning\"></i> Also unpublish all the collection's modules to be ensure they are hidden.",targetSelector:".cc-about-hide-collection",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#hide-a-collection"},{contentText:"Update the <em>output page</em> with the collection's current representation.\n\t\t<p><strong>Note:</strong> This is how you can use Collections with students without it being\n\t\tinstalled by your institution.</p>\n\t\t",targetSelector:".cc-about-update-output-page",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#output-page"},{contentText:"Specify the name of an existing Canvas page and the content of that page\n\t\twill be displayed before the current collection's representation \n\t\t(it is <strong>included</strong>)",targetSelector:"#cc-about-include-page",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#include-page"},{contentText:"<p>🚧🧪☠️ <strong>Warning:</strong> This feature is experimental, under construction, and\n\t\tpotentially destructive. Only use as suggested and if you're certain.</p>\n\t\t<p>Modify the names of Canvas modules by apply the Collection's label/number</p>\n\t\t",targetSelector:".cc-about-apply-module-labels",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/collections/overview/#apply-module-labels"},{contentText:"Specify how this module works with and is represented by Collections.",maxWidth:"250px",targetSelector:".cc-about-module-configuration",animateFunction:"spin"},{contentText:"Configure basic collections information about the module, including:\n\t\t<ul>\n\t\t  <li> Which collection does it belong to? </li>\n\t\t  <li> What is the module's description, label and number? </li>\n\t  </ul>",maxWidth:"250px",targetSelector:"#cc-about-basic-configuration",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/"},{contentText:"Which collection does this module belong to?",maxWidth:"250px",targetSelector:"#cc-about-module-collection",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/"},{contentText:"Describe why, what or how the module relates to the students' learning",maxWidth:"250px",targetSelector:"#cc-about-module-description",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#description"},{contentText:"Describe the type of object the module represents (e.g. lecture, theme etc.)",maxWidth:"250px",targetSelector:"#cc-about-module-label",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#labels-and-numbers"},{contentText:'<p>Choose from the three supported "date types" and configure it. Options include:</p>\n\t\t<ol>\n\t\t  <li> <strong>Single date</strong> - a specific date (and time) </li>\n\t\t  <li> <strong>Date range</strong> - a start and end date (and time) </li>\n\t\t  <li> 🏗 <strong>Coming soon</strong> 🏗 - (soon you\'ll be able to) specify a single date (and time) when the module will be available.</li>\n\t\t</ol>\n\t\t<p><em>Coming Soon</em> will be able to be used with one of the other options</em></p>\n\t\t',maxWidth:"250px",targetSelector:"#cc-about-module-dates",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#dates"},{contentText:'Specify a single date, or becomes the start date in a date range when used \n\t\twith "stop" date.',maxWidth:"250px",targetSelector:"#cc-about-module-date-start",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#start-date"},{contentText:"Representation of the date as configured by <em>Start Date</em> and possible <em>Stop Date</em>.",maxWidth:"250px",targetSelector:"#cc-about-module-date-calculated",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#start-date"},{contentText:"Specify the 'stop' date in a date range. Date is relative to a specific study period.",maxWidth:"250px",targetSelector:"#cc-about-module-date-stop",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#stop-date"},{contentText:"Specify a date and message describing when the module will be available.",maxWidth:"250px",targetSelector:"#cc-about-module-coming-soon",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#coming-soon"},{contentText:"If and how a label specific number will be calculated for the module \n\t\t(e.g. <em>Lecture 1</em> or <em>Workshop 5</em>)<p>Auto number or specify a value.</p>",maxWidth:"250px",targetSelector:"#cc-about-module-number",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#labels-and-numbers"},{contentText:"Flexibly add, delete, and modify additional information about this module, which\n\t\tmay be used by collections and representations - or for your own purposes.",maxWidth:"250px",targetSelector:"#cc-about-additional-metadata",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#additional-metadata"},{contentText:"<p>Choose one of three possible banner types (for Card representations) and configure it. Options are:</p> \n\t\t<ol>\n\t\t  <li> <strong>Image</strong> - a banner image</li>\n\t\t  <li> <strong>Colour</strong> - a solid colour</li>\n\t\t  <li> <strong>Iframe</strong> - HTML embed code (e.g. YouTube video)</li>\n\t\t  </ol>\n\t\t",maxWidth:"250px",targetSelector:"#cc-about-module-banner",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#dates"},{contentText:"Specify how the image will be scaled to fit the available space",maxWidth:"250px",targetSelector:"#cc-about-module-image-scale",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#image-scale"},{contentText:"Provide the URL for an image to associate with this module.",maxWidth:"250px",targetSelector:"#cc-about-module-image-url",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#image-url"},{contentText:"Provide an iframe (embed HTML) to place in a card's banner section.",maxWidth:"250px",targetSelector:"#cc-about-module-iframe",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#iframe"},{contentText:"Choose a colour for the background of the card's banner section.",maxWidth:"250px",targetSelector:"#cc-about-module-color",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#iframe"},{contentText:'The study period automatically identified from the course site. The academic\n\t\tcalendar for this study period will be used to translate "Monday Week 1" into a calendar date.',maxWidth:"250px",targetSelector:".cc-about-module-studyPeriod",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/objects/overview/#study-period"}];class cc_ConfigurationView extends cc_View{constructor(model,controller){super(model,controller),this.TOOLTIPS=CONFIG_VIEW_TOOLTIPS}display(){DEBUG&&console.log("-------------- cc_ConfigurationView.display()"),this.addCcBundle(),this.model.getConfigShowing()?this.showConfig():this.removeConfig();const configShowClass=this.model.getConfigShowClass(),configShowSwitch=document.getElementById("configShowSwitch");configShowSwitch&&(configShowSwitch.className=configShowClass),document.querySelectorAll("div.cc-module-config").forEach((div=>{div.remove()})),this.model.isOn()&&this.addModuleConfiguration(),this.addTooltips()}addModuleConfiguration(){const moduleDetails=this.model.getModuleDetails();if(!moduleDetails)return;let moduleHeaders=document.querySelectorAll("div.ig-header");for(let i=0;i<moduleHeaders.length;i++){const moduleHeader=moduleHeaders[i];if(!moduleHeader.id.match(/^\d+$/))continue;const id=moduleHeader.id,moduleDetail=moduleDetails[id];void 0!==moduleDetail&&this.addSingleModuleConfiguration(moduleHeader,moduleDetail,id)}this.addEventHandlers(),this.addTooltips()}addEventHandlers(){const bannerTabs=document.querySelectorAll(".cc-banner-tab");for(let i=0;i<bannerTabs.length;i++){bannerTabs[i].onclick=event=>this.controller.manageBannerTabShow(event)}const colorPickers=document.querySelectorAll("sl-color-picker");for(let i=0;i<colorPickers.length;i++){colorPickers[i].addEventListener("sl-change",(event=>this.controller.manageColourPickerChange(event)))}const accordions=document.querySelectorAll("sl-details");for(let i=0;i<accordions.length;i++){const accordion=accordions[i];accordion.addEventListener("sl-show",(event=>this.controller.manageAccordionToggle(event))),accordion.addEventListener("sl-hide",(event=>this.controller.manageAccordionToggle(event)))}}addSingleModuleConfiguration(moduleHeader,moduleDetail,id){let showConfigHtml="";"configClass"in moduleDetail?"icon-mini-arrow-down"===moduleDetail.configClass&&(showConfigHtml=this.showModuleConfig(moduleDetail)):moduleDetail.configClass="icon-mini-arrow-right";const moduleConfig=this.model.getModuleConfiguration(moduleDetail.id),moduleConfigHtml=`\n<div class="cc-module-config border border-trbl" id="cc-module-config-${id}">\n\t<link href="//cdn.quilljs.com/1.0.0/quill.snow.css" rel="stylesheet" />\n    <div class="cc-module-no-collection" id="cc-module-config-no-collection-${id}">\n\t    No collection allocated\n\t</div>\n\t<span>\n\t\t<i id="cc-module-config-${id}-switch" class="icon-mini-arrow-right"></i>\n\t\tCollections Module Configuration\n        <sl-tooltip class="cc-about-module-configuration">\n\t  \t\t<div slot="content"></div>\n\t\t\t<i class="icon-question cc-module-icon"></i>\n\t\t</sl-tooltip>\n\n\t</span> \n  \t${showConfigHtml}\n</div>`;moduleHeader.insertAdjacentHTML("afterend",moduleConfigHtml);const imageInput=document.getElementById(`cc-module-config-${moduleDetail.id}-image`);imageInput&&(imageInput.value=moduleDetail.image);const iframeArea=document.querySelector(`#cc-module-config-${id}-iframe`);iframeArea&&(iframeArea.onchange=event=>this.controller.updateModuleConfigField(event),iframeArea.onkeydown=event=>event.stopPropagation(),moduleDetail.hasOwnProperty("iframe")&&(iframeArea.value=moduleDetail.iframe));const labelInput=document.getElementById(`cc-module-config-${moduleDetail.id}-label`);labelInput&&moduleDetail.label&&(labelInput.value=moduleDetail.label);for(let key in moduleDetail.metadata){const nameInput=document.getElementById(`cc-module-config-${moduleDetail.id}-metadata-${key}-name`);nameInput&&(nameInput.value=key);const valueInput=document.getElementById(`cc-module-config-${moduleDetail.id}-metadata-${key}-value`);valueInput&&(valueInput.value=moduleDetail.metadata[key])}const moduleConfigSwitch=document.getElementById(`cc-module-config-${id}-switch`);if(moduleConfigSwitch&&(moduleConfigSwitch.onclick=event=>this.controller.toggleModuleConfigSwitch(event),moduleConfigSwitch.className=moduleDetail.configClass),!moduleConfig||!moduleConfig.collection||0===moduleConfig.collection.length){document.getElementById(`cc-module-config-no-collection-${id}`).style.display="inline-block"}if("icon-mini-arrow-down"===moduleDetail.configClass){let editor=new Quill(`#cc-module-config-${id}-description`,{theme:"snow"});if(editor.container){const delta=editor.clipboard.convert(moduleConfig.description);editor.setContents(delta),this.currentQuill=editor,this.quillChanged=!1;const editorSelectionHandler=this.quillSelectionChange.bind(this);editor.on("selection-change",editorSelectionHandler);const editorChangeHandler=this.quillChange.bind(this);editor.on("text-change",editorChangeHandler)}}const buttonAddMetadata=document.querySelector("button.cc-module-config-metadata-add");buttonAddMetadata&&(buttonAddMetadata.onclick=event=>this.controller.manageModuleMetadata(event));const trashMetadata=document.querySelectorAll("i.cc-module-config-metadata-delete");for(let i=0;i<trashMetadata.length;i++){trashMetadata[i].onclick=event=>this.controller.manageModuleMetadata(event)}const configDiv=document.querySelector(`#cc-module-config-${id}`);if(configDiv){const configFields=configDiv.querySelectorAll("input, select");for(let j=0;j<configFields.length;j++)-1===configFields[j].id.indexOf("-metadata-add-")&&(configFields[j].onchange=event=>this.controller.updateModuleConfigField(event)),configFields[j].onkeydown=event=>event.stopPropagation();const quillFields=configDiv.querySelectorAll("div.ql-editor");for(let j=0;j<quillFields.length;j++)quillFields[j].onkeydown=event=>event.stopPropagation()}}quillChange(delta,oldDelta,source){this.quillChanged=!0;const event={target:{id:this.currentQuill.root.parentNode.id,value:this.currentQuill.root.innerHTML}};this.quillChanged=!1,this.controller.updateModuleConfigField(event,!1),this.controller.changeMade(!0),this.controller.parentController.updateCurrentRepresentation(!0)}quillSelectionChange(range,oldRange,source){if(range)console.log("user entered the editor");else if(this.currentQuill&&this.quillChanged){const event={target:{id:this.currentQuill.root.parentNode.id,value:this.currentQuill.root.innerHTML}};this.quillChanged=!1,this.controller.updateModuleConfigField(event)}}updateSingleModuleConfig(moduleId){let moduleDetails=this.model.getModuleDetails();if(!moduleDetails.hasOwnProperty(moduleId))return;let singleModuleDetails=moduleDetails[moduleId];const moduleHeader=document.getElementById(moduleId);if(moduleHeader){const moduleConfigDiv=document.querySelector(`#cc-module-config-${moduleId}`);moduleConfigDiv&&moduleConfigDiv.remove(),singleModuleDetails.configClass="icon-mini-arrow-down",this.addSingleModuleConfiguration(moduleHeader,singleModuleDetails,moduleId)}}calculateDayWeekOptions(dateInfo){let weekOptions="",dayOfWeekOptions="",setWeek="Not chosen";dateInfo&&dateInfo.hasOwnProperty("week")&&(setWeek=dateInfo.week);let setDayOfWeek="Not chosen";dateInfo&&dateInfo.hasOwnProperty("day")&&(setDayOfWeek=dateInfo.day);const periodWeeks=this.controller.parentController.calendar.getWeekDetails();let weeks=["Not chosen"];for(const week in periodWeeks)weeks.push(week);for(let i=0;i<weeks.length;i++){let selected="";const week=weeks[i];week===setWeek&&(selected="selected");let weekValue=week;"Not chosen"===week&&(weekValue=""),weekOptions+=`<option value="${weekValue}" ${selected}>${week}</option>`}const days=["Not chosen","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let i=0;i<days.length;i++){let selected="";const day=days[i];day===setDayOfWeek&&(selected="selected");let dayValue=day;"Not chosen"===day&&(dayValue=""),dayOfWeekOptions+=`<option value="${dayValue}" ${selected}>${day}</option>`}return{dayOfWeekOptions:dayOfWeekOptions,weekOptions:weekOptions}}configureBanner(moduleDetail){let bannerActive={image:"active",iframe:"",colour:""};return moduleDetail.hasOwnProperty("banner")?["image","iframe","colour"].includes(moduleDetail.banner)&&(bannerActive.image="",bannerActive[moduleDetail.banner]="active"):moduleDetail.banner="image",moduleDetail.hasOwnProperty("bannerColour")||(moduleDetail.bannerColour="#ffffff"),moduleDetail.hasOwnProperty("iframe")||(moduleDetail.iframe=""),bannerActive}configureDate(moduleDetail){let dateActive={start:"active",stop:"",comingSoon:""};return moduleDetail.hasOwnProperty("activeDate")||(moduleDetail.activeDate="start"),["start","stop","comingSoon"].includes(moduleDetail.activeDate)&&(dateActive.start="",dateActive[moduleDetail.activeDate]="active"),dateActive}configureConfigDisplay(moduleDetail){return moduleDetail.hasOwnProperty("configDisplay")||(moduleDetail.configDisplay={accordions:{dates:"",banner:"",metadata:""}}),moduleDetail.configDisplay}showModuleConfig(moduleDetail){DEBUG&&console.log("-------------- cc_ConfigurationView.showModuleConfig()"),console.log(moduleDetail);let moduleConfig=this.model.getModuleConfiguration(moduleDetail.id);moduleConfig||(moduleConfig=this.model.addModuleConfiguration(moduleDetail)),console.log("---- configuration"),console.log(moduleConfig);let moduleCollection="";moduleConfig.hasOwnProperty("collection")&&""!==moduleConfig.collection&&(moduleCollection=moduleConfig.collection);const collections=this.model.getCollections();let selected="",collectionsOptions='<option value="">Unallocated</option>';for(let i=0;i<collections.length;i++){const collection=collections[i];collection===moduleCollection&&(selected="selected"),collectionsOptions+=`<option value="${collection}" ${selected}>${collection}</option>`,selected=""}let imageSizeOptions="",imageSize=moduleConfig.imageSize;""===imageSize&&(imageSize="contain",moduleConfig.imageSize=imageSize);const options=["none","contain","cover","fill","scale-down"];for(let i=0;i<options.length;i++){let selected="";const option=options[i];option===moduleConfig.imageSize&&(selected="selected"),imageSizeOptions+=`<option value="${option}" ${selected}>${option}</option>`}let dateInfo={label:"",week:"",date:"",month:"",day:"",time:"",to:{week:"",date:"",month:"",day:"",time:""}};if(moduleConfig.date){for(const dateField in dateInfo)"to"!==dateField&&moduleConfig.date.hasOwnProperty(dateField)&&(dateInfo[dateField]=moduleConfig.date[dateField]);if(moduleConfig.date.hasOwnProperty("to"))for(const dateField in dateInfo.to)moduleConfig.date.to.hasOwnProperty(dateField)&&(dateInfo.to[dateField]=moduleConfig.date.to[dateField])}const dateOptions=this.calculateDayWeekOptions(dateInfo),toDateOptions=this.calculateDayWeekOptions(dateInfo.to);let comingSoon=null;moduleConfig.hasOwnProperty("comingSoon")&&(comingSoon=moduleConfig.comingSoon);const comingSoonDateOptions=this.calculateDayWeekOptions(moduleConfig.comingSoon);let dateLabel="Commencing";moduleDetail.hasOwnProperty("date")&&moduleDetail.date.hasOwnProperty("label")&&(dateLabel=moduleDetail.date.label);let calculatedDate=this.calculateDate(dateInfo);if(dateInfo.hasOwnProperty("to")){const toDate=this.calculateDate(dateInfo.to);"No date set"!==toDate&&(calculatedDate+=` to ${toDate}`)}let autonumStyle="",autonumChecked="",numStyle="",numValue="";moduleConfig.hasOwnProperty("num")?(autonumStyle="color:grey;",numValue=moduleConfig.num):(autonumChecked="checked",numStyle="disabled");const currentStudyPeriod=this.model.getStudyPeriod();let bannerActive=this.configureBanner(moduleDetail),dateActive=this.configureDate(moduleDetail),configDisplay=this.configureConfigDisplay(moduleDetail);const additionalMetaDataHTML=this.getAdditionalMetaDataHTML(moduleDetail);return`\n\t\t<style>\n\t\t   .cc-module-config-collection-representation label {\n\t\t\t   width: 5rem;\n\t\t\t   font-size: 0.8rem;\n\t\t\t   /*font-weight: bold; */\n\t\t   }\n\t\t   .cc-module-config-collection-representation input {\n\t\t\t   font-size: 0.8rem;\n\t\t   }\n\t\t   .cc-module-config-detail {\n\t\t\t   padding: 0.5rem;\n\t\t   }\n\t\t   .cc-preview-container {\n\t\t\t   display:flex;\n\t\t\t   flex-wrap: wrap;\n\t\t\t   width: 100%;\n\t\t   }\n\n\t\t   .cc-module-icon{\n\t\t\tposition:relative;\n\t\t\ttop:-0.2rem;\n\t\t   }\n\n\t\t   .cc-preview-container .cc-card {\n\t\t\t   min-width: 50%;\n\t\t   }\n\n\t\t   .cc-calculated-date {\n\t\t\t   font-size: 0.8rem;\n\t\t\t   background-color: #eee;\n\t\t\t   padding: 0.5em\n\t\t\t   margin-left: 3rem;\n\t\t\t   margin-top: 0.5rem\n\t\t   }\n\t\t\n\t\t   .cc-current-studyPeriod {\n\t\t\t   font-size: 0.7rem;\n\t\t\t   display: inline;\n\t\t\t   margin-left: 2rem;\n\t\t   }\n\n\t\t   sl-tab {\n\t\t\t   font-size: var(--sl-font-size-small);\n\t\t   }\n\t\t</style>\n\n\t\t<div class="cc-module-config-detail">\n\t\t\t<div>\n\x3c!--\t\t\t  <sl-details open>\n\t\t\t    <div slot="summary">\n\t\t\t\t  <a id="cc-about-basic-configuration" target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t  <strong>Basic configuration</strong>\n\t\t\t\t</div> --\x3e\n\t\t\t\t<div class="cc-module-config-collection-representation">\n\t\t\t        <sl-tooltip id="cc-about-module-collection">\n\t\t\t\t\t  \t<div slot="content"></div>\n\t\t\t\t\t\t<i class="icon-question cc-module-icon"></i>\n\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-collection">Collection\n\t\t\t\t\t</label>\n\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-collection">\n\t\t\t\t\t  ${collectionsOptions}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="cc-collection-description" style="margin-top: 1em">\n\t\t\t        <sl-tooltip id="cc-about-module-description">\n\t\t\t\t\t  \t<div slot="content"></div>\n\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t</sl-tooltip>\n\t\t\t\t    <label for="cc-module-config-${moduleDetail.id}-description">Description</label>\n\t\t\t\t\t<div id="cc-module-config-${moduleDetail.id}-description" class="cc-module-config-description" style="height:8rem"> </div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="cc-module-config-collection-representation" style="margin-top:0.5rem">\n\t\t\t\t        <sl-tooltip id="cc-about-module-label">\n\t\t\t\t\t\t  \t<div slot="content"></div>\n\t\t\t\t\t\t  \t<a target="_blank" href="">\n\t\t\t\t\t\t   \t<i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t    \t<label for="cc-module-config-${moduleDetail.id}-label">Label\n\t\t\t\t\t\t</label> \n\t\t\t\t\t\t<input type="text" id="cc-module-config-${moduleDetail.id}-label"\n\t\t\t\t\t    \tstyle="width:10rem" value="" />\n\t\t\t\t</div>\n\t\t\t\t<div class="cc-module-config-collection-representation" style="margin-top:0.5rem">\n\t\t\t\t        <sl-tooltip id="cc-about-module-number">\n\t\t\t\t\t  \t\t<div slot="content"></div>\n\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t    \t<label for="cc-module-config-${moduleDetail.id}-num">Number</label>\n\t\t\t\t\t\t<span class="cc-config-autonum" style="${autonumStyle}">auto:\n\t\t\t\t\t   \t\t<input type="checkbox" id="cc-module-config-${moduleDetail.id}-autonum" ${autonumChecked} \n\t\t\t\t\t\t\t    style="position:relative; top:-0.25rem; ${autonumStyle}" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input type="text" id="cc-module-config-${moduleDetail.id}-num" \n\t\t\t\t\t     \tvalue="${numValue}" style="width:3rem;" ${numStyle}/>\n\t\t\t\t</div>\n\n\x3c!--\t\t\t</sl-details> --\x3e\n\n\t\t\t</div> \n\n\t\t\t<div style="margin-right:1em">\n\t\t\t\t<sl-details ${configDisplay.accordions.dates} id="cc-module-config-${moduleDetail.id}-dates-accordion">  \x3c!-- dates accordion --\x3e\n\t\t   \t\t<div slot="summary">\n\t\t\t        <sl-tooltip id="cc-about-module-dates">\n\t\t\t\t\t  \t<div slot="content"></div>\n\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t</sl-tooltip>\n\t\t    \t\t<strong>Dates</strong>\n\t\t\t\t\t<div class="cc-current-studyPeriod">\n\t\t\t        \t<sl-tooltip class="cc-about-module-studyPeriod">\n\t\t\t\t\t  \t\t<div slot="content"></div>\n\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t</sl-tooltip>\n\t\t   \t\t\t\t<strong>Study Period</strong> ${currentStudyPeriod}\n\t\t\t\t\t</div>\n\t\t\t  \t</div>\n\t\t\t\t<sl-tab-group>\n\t\t\t  \t\t<sl-tab ${dateActive.start} slot="nav" panel="cc-module-config-${moduleDetail.id}-date-start">Start Date</sl-tab>\n\t\t\t\t  \t\t<sl-tab ${dateActive.stop} slot="nav" panel="cc-module-config-${moduleDetail.id}-date-stop">Stop Date</sl-tab>\n\t\t\t\t  \t\t\x3c!-- sl-tab ${dateActive.comingSoon} slot="nav" panel="cc-module-config-${moduleDetail.id}-coming-soon">Coming Soon</sl-tab --\x3e\n\n \t\t\t      \t\t<sl-tab-panel name="cc-module-config-${moduleDetail.id}-date-start">\n\t\t   \t\t\t\t\t<div id="cc-module-config-${moduleDetail.id}-date-start">\n\t\t\t        \t\t\t<sl-tooltip id="cc-about-module-date-start">\n\t\t\t\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t\t</sl-tooltip> About start date\n\t\t\t\t\t    \t\t<div>\n\t\t\t\t\t\t\t\t\t<div class="cc-calculated-date">\n\t\t\t        \t\t\t\t\t<sl-tooltip id="cc-about-module-date-calculated">\n\t\t\t\t\t  \t\t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t\t\t<i class="icon-question cc-module-icon"></i>\n\t\t\t\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t\t\t\t${calculatedDate}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="cc-module-config-collection-representation" style="padding-top:1rem; padding-left:3rem">\n\t\t\t\t    \t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-date-label">Date label</label>\n\t\t\t\t\t\t\t\t\t\t<input type="text" id="cc-module-config-${moduleDetail.id}-date-label"\n\t\t\t\t\t\t   \t\t\t\t\tstyle="width:10rem" value="${dateLabel}" /><br />\n\t\t\t\t    \t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-day">Day of week</label>\n\t\t\t\t\t\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-day">\n\t\t                  \t\t\t\t\t${dateOptions.dayOfWeekOptions}\n\t\t\t\t\t\t\t\t\t\t</select> <br />\n\t\t\t\t\t\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-week">Week</label>\n\t\t\t\t\t\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-week">\n\t\t   \t\t           \t\t\t\t\t${dateOptions.weekOptions}}\t\n\t\t\t\t\t\t\t\t\t\t</select> <br />\n\t\t\t\t\t\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-time">Time</label>\n\t\t\t\t\t\t\t\t\t\t<style>\n\t\t\t\t\t   \t\t\t\t\t\tinput[readonly] {\n\t\t\t\t\t\t\t\t\t\t\t\tdisplay:none;\n\t\t\t\t\t   \t\t\t\t\t\t}\n\t\t\t\t\t   \t\t\t\t\t</style>\n\t\t\t\t\t\t\t\t\t\t<aeon-datepicker local="en-au">\n\t\t\t\t\t\t\t\t\t\t<input type="time" id="cc-module-config-${moduleDetail.id}-time" name="time" value="${dateInfo.time}" />\n\t\t\t\t\t\t\t\t\t\t</aeon-datepicker>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</sl-tab-panel>\n\t\t\t\t    \t<sl-tab-panel name="cc-module-config-${moduleDetail.id}-date-stop">\n\t\t   \t\t\t  \t\t<div id="cc-module-config-${moduleDetail.id}-date-stop">\n\t\t\t        \t\t\t<sl-tooltip id="cc-about-module-date-stop">\n\t\t\t\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t\t</sl-tooltip> About stop date\n\t\t\t\t\t    \t\t<div>\n\t\t\t\t\t\t\t\t\t<div class="cc-calculated-date">\n\t\t\t        \t\t\t\t\t<sl-tooltip id="cc-about-module-date-calculated">\n\t\t\t\t\t  \t\t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t\t\t<i class="icon-question cc-module-icon"></i>\n\t\t\t\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t\t\t\t${calculatedDate}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class="cc-module-config-collection-representation" style="padding-top:1rem; padding-left:3rem">\n\t\t\t\t    \t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-day-to">Day of week</label>\n\t\t\t\t\t\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-day-to">\n\t\t                  \t\t\t\t\t${toDateOptions.dayOfWeekOptions}\n\t\t\t\t\t\t\t\t\t\t</select> <br />\n\t\t\t\t\t\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-week-to">Week</label>\n\t\t\t\t\t\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-week-to">\n\t\t   \t\t           \t\t\t\t\t${toDateOptions.weekOptions}}\t\n\t\t\t\t\t\t\t\t\t\t</select> <br />\n\t\t\t\t\t\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-time-to">Time</label>\n\t\t\t\t\t\t\t\t\t\t<style>\n\t\t\t\t\t   \t\t\t\t\t\tinput[readonly] {\n\t\t\t\t\t\t\t\t\t\t\t\tdisplay:none;\n\t\t\t\t\t   \t\t\t\t\t\t}\n\t\t\t\t\t  \t\t\t\t\t</style>\n\t\t\t\t\t\t\t\t\t\t<aeon-datepicker local="en-au">\n\t\t\t\t\t\t\t\t\t\t\t<input type="time" id="cc-module-config-${moduleDetail.id}-time-to" name="time" value="${dateInfo.to.time}" />\n\t\t\t\t\t\t\t\t\t\t</aeon-datepicker>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</sl-tab-panel>\n\t\t\t\t    \t\x3c!--\n\t\t\t\t\t\t<sl-tab-panel name="cc-module-config-${moduleDetail.id}-coming-soon">\n\t\t   \t\t\t\t\t<div id="cc-module-config-${moduleDetail.id}-coming-soon">\n\t\t\t\t\t    \t\t<div>\n\t\t\t\t\t\t\t\t\t<div class="cc-calculated-date"><em>No coming soon configured</em></div>\n\t\t\t\t\t\t\t\t\t<div class="cc-module-config-collection-representation" style="padding-top:1rem; padding-left:3rem">\n\t\t\t\t    \t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-coming-soon-label">Label</label>\n\t\t\t\t\t\t\t\t\t\t<input type="text" id="cc-module-config-${moduleDetail.id}-coming-soon-label"\n\t\t\t\t\t\t   \t\t\t\t\tstyle="width:10rem" value="" /><br />\n\t\t\t\t    \t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-coming-soon-day">Day of week</label>\n\t\t\t\t\t\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-coming-soon-day">\n\t\t                  \t\t\t\t\t${comingSoonDateOptions.dayOfWeekOptions}\n\t\t\t\t\t\t\t\t\t\t</select> <br />\n\t\t\t\t\t\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-coming-soon-week">Week</label>\n\t\t\t\t\t\t\t\t\t\t<select id="cc-module-config-${moduleDetail.id}-coming-soon-week">\n\t\t   \t\t           \t\t\t\t\t${comingSoonDateOptions.weekOptions}}\t\n\t\t\t\t\t\t\t\t\t\t</select> <br />\n\t\t\t\t\t\t\t\t\t\t<label for="cc-module-config-${moduleDetail.id}-coming-soon-time">Time</label>\n\t\t\t\t\t\t\t\t\t\t<style>\n\t\t\t\t\t   \t\t\t\t\t\tinput[readonly] {\n\t\t\t\t\t\t\t\t\t\t\t\tdisplay:none;\n\t\t\t\t\t   \t\t\t\t\t\t}\n\t\t\t\t\t   \t\t\t\t\t</style>\n\t\t\t\t\t\t\t\t\t\t<aeon-datepicker local="en-au">\n\t\t\t\t\t\t\t\t\t\t\t<input type="time" id="cc-module-config-${moduleDetail.id}-coming-soon-time" name="time" value="" />\n\t\t\t\t\t\t\t\t\t\t</aeon-datepicker>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</sl-tab-panel>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t</sl-tab-group>\n\t\t\t\t</sl-details>\n\n\t\t\t    <sl-details ${moduleDetail.configDisplay.accordions.banner} id="cc-module-config-${moduleDetail.id}-banner-accordion">\n\t\t\t\t  <div slot="summary">\n  \t\t\t        <sl-tooltip id="cc-about-module-banner">\n\t\t\t\t\t  \t<div slot="content"></div>\n\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t</sl-tooltip>\n\t\t\t\t  \t<strong>Banner</strong>\n\t\t\t\t</div>\n\t\t\t\t\t<sl-tab-group>\n\t\t\t\t  \t\t<sl-tab class="cc-banner-tab" ${bannerActive.image} slot="nav" panel="cc-module-config-${moduleDetail.id}-image">Image</sl-tab>\n\t\t\t\t  \t\t<sl-tab class="cc-banner-tab" ${bannerActive.iframe} slot="nav" panel="cc-module-config-${moduleDetail.id}-iframe">Iframe</sl-tab>\n\t\t\t\t  \t\t<sl-tab class="cc-banner-tab" ${bannerActive.colour} slot="nav" panel="cc-module-config-${moduleDetail.id}-colour">Colour</sl-tab>\n\n\n \t\t\t      \t\t<sl-tab-panel name="cc-module-config-${moduleDetail.id}-image">\n\t\t\t\t\t\t\t<div class="cc-module-config-collection-representation"\n\t\t\t\t\t\t\t     style="padding-left: 0.5rem;">\n\t\t\t\t\t\t        <sl-tooltip id="cc-about-module-image-scale">\n\t\t\t\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t\t<label for="cc-collection-representation-${moduleDetail.id}-imageSize"\n\t\t\t\t\t     \t\t\tstyle="float:left;padding-top:0.8rem;"> Image scale </label>\n\t\t   \t\t       \t\t\t<select id="cc-module-config-${moduleDetail.id}-imageSize">\n\t\t\t\t\t      \t\t\t${imageSizeOptions}\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t        <sl-tooltip id="cc-about-module-image-url">\n\t\t\t\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t\t<label for="cc-module-config-collection-representation-${moduleDetail.id}-image"     \n\t\t\t\t\t    \t\t\tstyle="float:left;padding-top:0.8rem"> Image URL\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<input type="text" id="cc-module-config-${moduleDetail.id}-image" \n\t\t\t\t\t        \t\tvalue="">\n\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</sl-tab-panel>\n\n \t\t\t      \t\t<sl-tab-panel name="cc-module-config-${moduleDetail.id}-iframe">\n\t\t\t\t\t\t\t<div class="cc-module-config-collection-representation">\n\t\t\t\t\t\t        <sl-tooltip id="cc-about-module-iframe">\n\t\t\t\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t\t<label for="cc-collection-representation-${moduleDetail.id}-iframe"\n\t\t\t\t\t     \t\t\tstyle="padding-top:0.8rem;"> iframe </label>\n\t\t   \t\t       \t\t\t<textarea id="cc-module-config-${moduleDetail.id}-iframe"></textarea>\n\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</sl-tab-panel>\n\n \t\t\t      \t\t<sl-tab-panel name="cc-module-config-${moduleDetail.id}-colour">\n\t\t\t\t\t\t\t<div class="cc-module-config-collection-representation">\n\t\t\t\t\t\t        <sl-tooltip id="cc-about-module-color">\n\t\t\t\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t\t<label for="cc-collection-representation-${moduleDetail.id}-color"\n\t\t\t\t\t     \t\t\tstyle="padding-top:0.8rem;"> colour </label>\n\t\t\t\t\t\t  \t\t<sl-color-picker \n\t\t\t\t\t\t\t\t    id="cc-module-config-${moduleDetail.id}-color"\n\t\t\t\t\t\t\t\t\tvalue="${moduleDetail.bannerColour}"\n\t\t\t\t\t\t\t\t    label="Select a color">\n\t\t\t\t\t\t\t\t</sl-color-picker>\n\t\t\t\t\t\t\t\t<br clear="all" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</sl-tab-panel>\n\t\t\t\t\t<sl-tab-group>\n\t\t\t\t</sl-details>\n\n\t\t\t\t${additionalMetaDataHTML}\n\t\t\t\t<div class="cc-module-config-imagePreview">\n\t\t\t\t\t\t\t \n\t\t\t\t  </div>\n\t\t\t\t</div>\n\t\t    </div>\n\t\t</div>\t\n\t\t`}getAdditionalMetaDataHTML(module){let additionalMetaDataHTML=`\n\t<sl-details ${module.configDisplay.accordions.metadata} id="cc-module-config-${module.id}-metadata-accordion">\n\t   <div slot="summary">\n\t         <sl-tooltip id="cc-about-additional-metadata">\n  \t\t\t\t<div slot="content"></div>\n\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\n\t     \t<strong>Additional metadata</strong>\n\t\t</div>\n\t\t<div class="cc-module-config-additional-metadata border border-trbl">\n\t\t\t<table>\n\t\t\t  <thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Action</th>\n\t\t\t\t</tr>\n\t\t\t  </thead>\n\t\t\t  <tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><input type="text" id="cc-module-config-${module.id}-metadata-add-name"></td>\n\t\t\t\t\t<td><input type="text" id="cc-module-config-${module.id}-metadata-add-value"></td>\n\t\t\t\t\t<td><button id="cc-module-config-${module.id}-metadata-add"\n\t\t\t\t\t    class="cc-module-config-metadata-add">Add</button></td>\n\t\t\t\t</tr>\n\n\t\t`;for(let key in module.metadata)additionalMetaDataHTML+=`\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input type="text" id="cc-module-config-${module.id}-metadata-${key}-name"\n\t\t\t\t\t\t\tvalue="" pattern="[^"]"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input type="text" id="cc-module-config-${module.id}-metadata-${key}-value"\n\t\t\t\t\t\t\tvalue="" />\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<i class="icon-trash cc-module-config-metadata-delete" \n\t\t\t\t\t\t\tid="cc-module-config-${module.id}-metadata-${key}-delete"></i>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`;return additionalMetaDataHTML+="\n\t\t      </tbody>\n\t\t\t</table>\n\t\t</div>\n\t</sl-details>\n\t\t",additionalMetaDataHTML}getAvailableRepresentations(currentRepresentation=null){let availableRepresentations="";for(let i=0;i<this.model.availableRepresentations.length;i++)this.model.availableRepresentations[i]===currentRepresentation?availableRepresentations+=`<option value="${this.model.availableRepresentations[i]}" selected>${this.model.availableRepresentations[i]}</option>`:availableRepresentations+=`<option value="${this.model.availableRepresentations[i]}">${this.model.availableRepresentations[i]}</option>`;return availableRepresentations}showConfig(){this.removeConfig();const configDivHtml=`\n\t\t<div id="cc-config-wrapper">\n\t\t<style>\n\t\t    #cc-config-wrapper {\n\t\t\t\tdisplay: block;\n\t\t\t\tborder-bottom: 1px solid #c7cdd1\n\t\t\t}\n\n\t\t\t#cc-config {\n\t\t\t\tfloat: right;\n\t\t\t\tdisplay: block;\n\t\t\t\tmax-width: 50%;\n\t\t\t\tmargin-top: -1em;\n\t\t\t\tmargin-right: 10em;\n\t\t\t\tmargin-bottom: 1em;\n\t\t\t\tpadding-bottom: 0.5em;\n\t\t\t\tbackground-color: #f5f5f5;\n\t\t\t}\n\n\t\t\t.cc-box-header {\n\t\t\t\tpadding-left: 0.5em;\n\t\t\t}\n\n\t\t\t.cc-box-header p {\n\t\t\t\tfont-size: 1.1em;\n\t\t\t\tfont-weight: bold;\n\t\t\t}\n\n\t\t\t.cc-box-body {\n\t\t\t\twidth: 35em; \n\t\t\t\tpadding-left: 0.5em;\n\t\t\t\tpadding-right: 0.5em;\n\t\t\t\tpadding-bottom: 1.em;\n\t\t\t}\n\n\t\t\t#cc-config-body {  display: grid; \n\t\t\t\tgrid-template-columns: 1fr 1fr; \n\t\t\t\tgrid-template-rows: 1fr; \n\t\t\t\tgap: 0px 1em; \n\t\t\t\tgrid-auto-flow: row; \n\t\t\t\tgrid-template-areas: ". .";\n\t\t\t\theight: 100%;\n\t\t\t}\n\n\t\t\t#cc-config-body p {\n\t\t\t\tfont-size: 0.9em;\n\t\t\t\t/*font-weight: bold; */\n\t\t\t}\n\n\t\t\t#cc-config-new-collection {\n\t\t\t}\n\n\t\t\t#cc-config-new-collection-button, #cc-config-update-full-claytons {\n\t\t\t\tleft: 50%;\n\t\t\t\ttransform: translateX(-50%);\n\t\t\t\tfont-size: 0.8em;\n\t\t\t}\n\n\t\t\t.cc-existing-collection {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t\tfont-weight: normal;\n\t\t\t\tpadding-left: 0.5em;\n\t\t\t}\n\n\t\t\t.cc-existing-collection label {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t}\n\n\t\t\t.cc-existing-collection select {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t\twidth: 7rem;\n\t\t\t\theight: 2rem;\n\t\t\t}\n\n\t\t\t.cc-existing-collection p {\n\t\t\t\tmargin-top: 0.2em;\n\t\t\t\tmargin-bottom: 0.2em;\n\t\t\t}\n\n\t\t\t.cc-existing-collection i {\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\n\t\t\t.cc-output-page-not-exists { \n\t\t\t\tdisplay: none ! important;\n\t\t\t}\n \n\t\t\t.cc-output-page-update {\n\t\t\t\tfont-size: 0.8rem;\n\t\t\t}\n\n\t\t\t.cc-output-page-update-button, .cc-apply-module-labels-update-button {\n\t\t\t\tfont-size: 0.8rem;\n\t\t\t\tpadding: 0.2rem;\n\t\t\t}\n\n\t\t\t.cc-config-error {\n\t\t\t\tbackground-color:red;\n\t\t\t\tcolor:white;\n\t\t\t\tpadding:0.5em;\n\t\t\t\tfont-size:0.8em;\n\t\t\t\tmargin:0.5em;\n\t\t\t}\n\t\t\n\t\t\t.cc-config-collection {\n\t\t\t\tpadding-top: 0.5em;\n\t\t\t\tpadding-left: 0.5em;\n\t\t\t}\n\n\t\t\t.cc-config-collection label {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t}\n\n\t\t\t.cc-config-collection input {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t}\n\n\t\t\t.cc-config-collection button {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t\tpadding: 0.5em 1em;\n\t\t\t}\n\t\t\t.cc-config-collection select {\n\t\t\t\tfont-size: 0.8em;\n\t\t\t\twidth: 7rem;\n\t\t\t\theight: 2rem;\n\t\t\t}\n\n\t\t\t.cc-move-collection {\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\n\t\t\t.cc-collection-representation {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: space-around;\n\t\t\t}\n\n\t\t\t.cc-version {\n\t\t\t\tfont-size: 50%;\n\t\t\t\tfont-weight: normal;\n\t\t\t}\n\n\t\t\tinput.cc-existing-collection {\n\t\t\t\twidth: 10rem;\n\t\t\t\tmargin: 0.1rem;\n\t\t\t}\n\n\t\t\t</style>\n\n<div id="cc-config">\n \t<div class="cc-box-header">\n\t  \t<p>\n\t  \t\tConfigure Canvas Collections <span class="cc-version">(v0.9.1)</span>\n\t\t</p>\n\t</div>\n    <div class="cc-box-body">\n\t  \t<div id="cc-config-body">\n\t    \t<div id="cc-config-existing-collections">\n\t        \t<sl-tooltip id="cc-about-existing-collections">\n\t\t  \t\t\t<div slot="content"></div>\n\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t</sl-tooltip>\n\t\t\t\t<strong>Existing collections</strong>\n\t\t\t</div>\n\t\t\t<div id="cc-config-new-collection">\n\t        \t<sl-tooltip id="cc-about-new-collection">\n\t\t  \t\t\t<div slot="content"></div>\n\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t</sl-tooltip>\n\t\t\t\t<strong>Add a new collection</strong>\n\t\t\t\t<div class="cc-config-collection border border-trbl">\n\t\t\t  \t\t<div class="ic-Form-control" style="margin-bottom: 0px">\n\t\t\t  \t  \t\t<input type="text" id="cc-config-new-collection-name" placeholder="Name for new collection">\n\t\t\t  \t\t</div>\n\n\t\t\t  \t\t<div class="cc-collection-representation">\n  \t\t\t        \t<sl-tooltip id="cc-about-collection-representation">\n\t\t  \t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t<i class="icon-question cc-module-icon"></i>\n\t\t\t\t\t\t</sl-tooltip>\n\n\t\t\t\t  \t\t<label for="cc-config-new-collection-representation">Representation</label>\n\t\t\t\t  \t\t<select id="cc-config-new-collection-representation">\n\t\t\t\t    \t\t${this.getAvailableRepresentations()}\n\t\t\t\t  \t\t</select>\n\t\t\t  \t\t</div>\n\n\t\t\t  \t\t<fieldset class="ic-Fieldset ic-Fieldset--radio-checkbox">\n\t\t\t\t  \t\t<button class="btn btn-primary" id="cc-config-new-collection-button">Add</button>\n\t\t\t  \t\t</fieldset>\n\t\t  \t\t</div>\n\t\t  \t\t<div style="margin-top:0.5em">\n\t\t    \t\t<div>\n\t\t        \t\t<sl-tooltip id="cc-about-full-claytons">\n\t\t  \t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t<strong>Full "Claytons"</strong>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="border border-trbl" style="padding:0.5em">\n \t\t\t        \t<sl-tooltip id="cc-about-full-claytons-navigation-option">\n\t\t  \t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t</sl-tooltip>\n\t\t\t  \t\t\t<label for="cc-config-full-claytons-navigation-option">Navigation Bar Options</label>\n\t\t\t  \t\t\t<sl-radio-group id="cc-config-full-claytons-navigation-option" value="1">\n\t\t\t    \t\t\t<sl-radio-button value="1">None</sl-radio-button>\n\t\t\t\t\t\t\t<sl-radio-button value="2">Pages</sl-radio-button>\n\t\t\t\t\t\t\t<sl-radio-button value="3">Tabs</sl-radio-button>\n\t\t\t  \t\t\t</sl-radio-group>\n\t\t\t\t\t\t<div style="margin-top: 0.5rem">\n\t\t\t  \t\t\t\t<fieldset class="ic-Fieldset ic-Fieldset--radio-checkbox">\n\t\t\t\t  \t\t\t\t<button class="btn btn-primary" id="cc-config-update-full-claytons">Update</button>\n\t\t\t  \t\t\t\t</fieldset>\n\t\t    \t\t\t</div> \n\t\t  \t\t\t</div>\n\t\t  \t\t</div>\n\t\t\t</div>\n\t  \t</div>\n\t</div>\n</div>\n\t\t`,toggleAndCrumbs=document.getElementsByClassName("ic-app-nav-toggle-and-crumbs")[0];toggleAndCrumbs&&(toggleAndCrumbs.style.borderBottom="none",toggleAndCrumbs.insertAdjacentHTML("afterEnd",configDivHtml));const ccSwitchContainer=document.getElementsByClassName("cc-switch-container")[0];ccSwitchContainer&&(ccSwitchContainer.style.borderBottom="none"),this.showExistingCollections()}updateExistingCollections(){const existingCollections=document.querySelectorAll("#cc-config-existing-collections > div.cc-existing-collection");for(let i=0;i<existingCollections.length;i++)existingCollections[i].remove();this.showExistingCollections()}showExistingCollections(){DEBUG&&console.log("cc_configugurationView::showExistingCollections()");const existingCollectionNames=this.model.getExistingCollectionNames();DEBUG&&console.log(existingCollectionNames);const existingCollectionsDiv=document.getElementById("cc-config-existing-collections"),numCollections=existingCollectionNames.length;let count=0;const defaultCollection=this.model.getDefaultCollection();existingCollectionNames.forEach((collectionName=>{const moduleCount=this.model.getModuleCount(collectionName),moduleName="module"+(1!==moduleCount?"s":""),availableRepresentations=this.getAvailableRepresentations(this.model.getCollectionRepresentation(collectionName));let includePage=this.model.getCollectionAttribute(collectionName,"includePage");includePage||(includePage="");let outputPage=this.model.getCollectionAttribute(collectionName,"outputPage"),outputPageExists="cc-output-page-not-exists";outputPage||(outputPage=""),""!==outputPage&&(outputPageExists="cc-output-page-exists");const divExistingCollection=`\n\t\t\t<div class="cc-existing-collection border border-trbl" id="cc-collection-${collectionName}">\n\t\t\t\t<p>${collectionName} - (${moduleCount} ${moduleName})\n\t\t\t\t<span class="cc-collection-move">\n\t\t\t\t<i class="icon-arrow-up cc-move-collection" id="cc-collection-${collectionName}-up"></i>\n\t\t\t\t<i class="icon-arrow-down cc-move-collection" id="cc-collection-${collectionName}-down"></i>\n\t\t\t\t</span>\n\t\t\t\t<span class="cc-collection-delete">\n\t\t\t\t<i class="icon-trash cc-delete-collection" id="cc-collection-${collectionName}-delete"></i>\n\t\t\t\t</span>\n\t\t\t\t</p>\n\n\t\t\t\t<div class="cc-collection-representation">\n\t\t\t\t\t<label for="cc-collection-${collectionName}-representation">Representation</label>\n\t\t\t\t \t<select id="cc-collection-${collectionName}-representation"\n\t\t\t\t\t    class="cc-collection-representation">\n\t\t\t\t\t  ${availableRepresentations}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="cc-collection-representation">\n\t\t\t\t\x3c!-- put the options --\x3e\n\t\t\t\t<fieldset class="ic-Fieldset ic-Fieldset--radio-checkbox" style="margin-bottom:0.5em">\n\t\t\t\t\t<div class="ic-Checkbox-group">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t        <sl-tooltip id="cc-about-default-collection">\n\t\t  \t\t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t<i class="icon-question cc-module-icon"></i>\n\t\t\t\t\t\t\t</sl-tooltip>\n\n\t\t\t\t\t\t\t<input type="checkbox" id="cc-config-collection-${collectionName}-default"\n\t\t\t\t\t\t\t    class="cc-config-collection-default">\n\t\t\t\t\t\t\t<label for="cc-config-collection-${collectionName}-default">\n\t\t\t\t\t\t\t\tDefault collection?\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- <div class="ic-Form-control ic-Form-control--checkbox"> --\x3e\n\t\t\t\t\t\t<div>\n\t\t\t\t\t        <sl-tooltip class="cc-about-hide-collection">\n\t\t  \t\t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t\t\t\t<input type="checkbox" id="cc-config-collection-${collectionName}-hide"\n\t\t\t\t\t\t\t    class="cc-config-collection-hide">\n\t\t\t\t\t\t\t<label for="cc-config-collection-${collectionName}-hide">\n\t\t\t\t\t\t\t\tHide collection?\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t        <sl-tooltip id="cc-about-include-page">\n\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t</sl-tooltip>\n\t\t\t\t  \tInclude page\n\t\t\t\t  \t<div style="padding-left:0.5em">\n\t\t\t\t \t\t<input id="cc-collection-${collectionName}-include-page" \n\t\t\t\t\t     value="${includePage}" class="cc-existing-collection" />\n\t\t\t\t  \t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- output page --\x3e\n\t\t\t\t<div style="margin-top:0.5em">\n\t\t\t        <sl-tooltip class="cc-about-update-output-page">\n\t\t  \t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t</sl-tooltip>\n\t\t\t\t  \tOutput page\n\t\t\t\t  \t<div class="cc-collection-representation">\n\x3c!--\t\t\t\t\t<label for="cc-collection-${collectionName}-output-page">Name</label> --\x3e\n\t\t\t\t \t\t<input id="cc-collection-${collectionName}-output-page" \n\t\t\t\t\t      value="${outputPage}" class="cc-existing-collection" />\n\t\t\t\t  \t\t<span class="cc-collection-representation cc-output-page-update ${outputPageExists}">\n\t\t\t\t\t\t\t<button id="cc-collection-${collectionName}-output-page-update"\n\t\t\t\t\t      \t\tclass="btn cc-output-page-update-button">Update</button>\n\t\t\t\t  \t\t</span>\n\t\t\t\t\t</div>\n  \t\t\t    \t<div style="display:flex;margin-top:1em;margin-bottom:0.5em">\n\t\t\t\t  \t\t<div style="margin-right:0.5em">\n\t\t\t\t\t        <sl-tooltip class="cc-about-apply-module-labels">\n\t\t  \t\t\t\t\t\t<div slot="content"></div>\n\t\t\t\t\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t\t\t\t\t</sl-tooltip>\n\t\t\t\t  \t\t\t🧪Apply module labels ☠️\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button id="cc-collection-${collectionName}-apply-module-labels"\n\t\t\t\t\t      class="btn cc-apply-module-labels-update-button">Apply</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;if(existingCollectionsDiv.insertAdjacentHTML("beforeEnd",divExistingCollection),defaultCollection===collectionName){const defaultCheckbox=document.getElementById(`cc-config-collection-${collectionName}-default`);defaultCheckbox&&(defaultCheckbox.checked=!0);const hideCheckbox=document.getElementById(`cc-config-collection-${collectionName}-hide`);hideCheckbox&&(hideCheckbox.disabled=!0)}const hidden=this.model.getCollectionAttribute(collectionName,"hide"),hideCheckbox=document.getElementById(`cc-config-collection-${collectionName}-hide`);hideCheckbox&&(hideCheckbox.checked=!!hidden);const representation=this.model.getCollectionRepresentation(collectionName),representationOption=document.getElementById(`cc-collection-${collectionName}-representation-${representation}`);if(representationOption&&(representationOption.selected=!0),0===count){const upButton=document.getElementById(`cc-collection-${collectionName}-up`);upButton&&upButton.remove()}else if(count===numCollections-1){const downButton=document.getElementById(`cc-collection-${collectionName}-down`);downButton&&downButton.remove()}count+=1}));document.querySelectorAll(".cc-move-collection").forEach((icon=>{icon.onclick=event=>this.controller.moveCollection(event)}));document.querySelectorAll(".cc-delete-collection").forEach((icon=>{icon.onclick=event=>this.controller.deleteCollection(event)}));document.querySelectorAll("select.cc-collection-representation").forEach((representation=>{representation.onchange=event=>this.controller.changeCollectionRepresentation(event)}));const newCollectionButton=document.querySelector("button#cc-config-new-collection-button");newCollectionButton&&(newCollectionButton.onclick=event=>this.controller.addNewCollection(event));const fullClaytonsButton=document.querySelector("button#cc-config-update-full-claytons");fullClaytonsButton&&(fullClaytonsButton.onclick=event=>this.controller.updateFullClaytons(event));document.querySelectorAll("input.cc-config-collection-default").forEach((checkbox=>{checkbox.onchange=event=>this.controller.changeDefaultCollection(event)}));document.querySelectorAll("input.cc-config-collection-hide").forEach((checkbox=>{checkbox.onchange=event=>this.controller.changeHideCollection(event)}));document.querySelectorAll("input.cc-existing-collection").forEach((collection=>{collection.onchange=event=>this.controller.modifyCollectionPages(event)}));const updateButtons=document.querySelectorAll("button.cc-output-page-update-button");for(let i=0;i<updateButtons.length;i++){updateButtons[i].onclick=event=>this.controller.updateOutputPage(event)}const applyModuleLabelsButton=document.querySelectorAll("button.cc-apply-module-labels-update-button");for(let i=0;i<applyModuleLabelsButton.length;i++){applyModuleLabelsButton[i].onclick=event=>this.controller.applyModuleLabels(event)}}removeConfig(){const configDiv=document.getElementById("cc-config-wrapper");if(configDiv){configDiv.remove();const toggleAndCrumbs=document.getElementsByClassName("ic-app-nav-toggle-and-crumbs")[0];toggleAndCrumbs&&(toggleAndCrumbs.style.borderBottom="1px solid #c7cdd1");const ccSwitchContainer=document.getElementsByClassName("cc-switch-container")[0];ccSwitchContainer&&(ccSwitchContainer.style.borderBottom="1px solid #c7cdd1")}}addCcBundle(){this.model.isOn()&&this.addConfigShowSwitch();if(document.getElementsByClassName("cc-switch-container")[0])return;let published="";this.model.isPublished()||(published=CC_UNPUBLISHED_HTML);document.querySelector("div#application").insertAdjacentHTML("afterbegin",'\n\t\t <style>\n\t\t /* The switch - the box around the slider */\n.cc-switch {\n  position: relative;\n  display: inline-block;\n  width: 2rem; \n  height: 1.2rem;\n  margin-top: .75rem;\n  margin-right: 0.5rem\n}\n\n/* Hide default HTML checkbox */\n.cc-switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n/* The slider */\n.cc-slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #ccc;\n  -webkit-transition: .4s;\n  transition: .4s;\n}\n\n.cc-slider:before {\n  position: absolute;\n  content: "";\n  height: 0.9rem;\n  width: 0.9rem;\n  left: 2px;\n  bottom: 2px;\n  background-color: white;\n  -webkit-transition: .4s;\n  transition: .4s;\n}\n\ninput:checked + .cc-slider {\n  background-color: #328c04;\n}\n\ninput:focus + .cc-slider {\n  box-shadow: 0 0 1px #2196F3;\n}\n\ninput:checked + .cc-slider:before {\n  -webkit-transform: translateX(1rem);\n  -ms-transform: translateX(1rem);\n  transform: translateX(1rem);\n}\n\n/* Rounded sliders */\n.cc-slider.cc-round {\n  border-radius: 1.1rem;\n}\n\n.cc-slider.cc-round:before {\n  border-radius: 50%;\n}\n\n.cc-switch-container {\n\tbackground-color: #f5f5f5;\n\tborder: 1px solid #c7cdd1;\n\tcolor: var(--ic-brand-font-color-dark);\n\tdisplay: flex;\n\tposition:relative;\n}\n\n.cc-unpublished {\n    display: flex;\n    font-size: .75em;\n    background-color: #ffe08a;\n    align-items: center;\n    border-radius: .5em;\n    padding-left: 0.5em;\n    padding-right: 0.5em;\n    height: 2em;\n}\n\n.cc-switch-title {\n\tmargin: 0.5rem\n}\n\n/* styles for the module configs */\n\t\t    .cc-module-config {\n\t\t\t\tpadding: 1em;\n\t\t\t\tfont-size: smaller;\n\t\t\t\tmargin:0;\n\t\t\t/*\tfont-weight: bold; */\n\t\t\t}\n\n\t\t   .cc-module-no-collection {\n\t\t\t\tfloat:right;\n\t\t\t\tbackground: red;\n\t\t\t\tcolor:white;\n\t\t\t\tborder-radius: 0.25rem;\n\t\t\t\tpadding-left: 0.5rem;\n\t\t\t\tpadding-right: 0.5rem;\n\t\t\t\tdisplay:none;\n\t\t   }\n\n\t\t   .cc-module-config-additional-metadata {\n\t\t\t    margin-top: 0.5rem;\n\t\t\t\tmargin-bottom: 0.5rem;\n\t\t\t\tpadding-left: 0.5rem;\n\t\t\t\tpadding-right: 0.5rem;\n\t\t   }\n\n\n\n\t\t\t.cc-module-config-detail {  \n\t\t\t\tdisplay: grid; \n\t\t\t\tgrid-template-columns: 1fr 1fr; \n\t\t\t\tgrid-template-rows: 1fr; \n\t\t\t\tgap: 0px 1em; \n\t\t\t\tgrid-auto-flow: row; \n\t\t\t\tgrid-template-areas: ". .";\n\t\t\t\theight: 100%;\n\t\t\t}\n\n\t\t\t.cc-save {\n\t\t\t\tmargin-top: 0.5rem;\n\t\t\t}\n\n\t\t\t.cc-active-save-button {\n\t\t\t\tbackground-color: #c94444;\n\t\t\t\tcolor: var(--ic-brand-button--primary-text);\n\t\t\t\tborder: 1px solid;\n\t\t\t\tborder-color: var(--ic-brand-primary--primary-bgd-darkened-15);\n\t\t\t\tborder-radius: 2px;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tposition: relative;\n\t\t\t\tpadding-left: 0.25rem;\n\t\t\t\tpadding-right: 0.25rem\n\t\t\t\ttext-align: center;\n\t\t\t\tvertical-align: middle;\n\t\t\t\tcursor: pointer;\n\t\t\t\tfont-size: 65%;\n\t\t\t\ttransition: background-color 0.2s ease-in-out;\n\t\t\t}\n\n\t\t\t.cc-active-save-button:hover {\n\t\t\t\tbackground: var(--ic-brand-primary);\n\t\t\t}\n\n\t\t\t.cc-save-button {\n\t\t\t\tbackground: #f5f5f5;\n\t\t\t\tcolor: #2d3b45;\n\t\t\t\tborder: 1px solid;\n\t\t\t\tborder-color: #c7cdd1;\n\t\t\t\tborder-radius: 2px;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tposition: relative;\n\t\t\t\tpadding-left: 0.25rem;\n\t\t\t\tpadding-right: 0.25rem\n\t\t\t\ttext-align: center;\n\t\t\t\tvertical-align: middle;\n\t\t\t\tcursor: pointer;\n\t\t\t\tfont-size: 65%;\n\t\t\t\ttransition: background-color 0.2s ease-in-out;\n\t\t\t}\n\n\t\t\t.cc-save-button:hover {\n\t\t\t\tbackground: #cccccc;\n\t\t\t}\n\n\t\t\t.html5tooltip-box\n{\n  background-color: #cccccc;\n  border-radius: 0.5em;\n  padding: 0.5em;\n  box-shadow: 0 0 0 1px rgba(255,255,255,.15), 0 0 10px rgba(255,255,255,.15);\n  font-size: 0.8em;\n  color: black;\n}\n\n\n\t\t </style>\n\t\t\t');let cc_on="";this.model.isOn()&&(cc_on="checked");const CC_BUNDLE_HTML=`\n\t\t<div class="cc-switch-container">\n\t\t  <div class="cc-switch-title">\n\t        <sl-tooltip id="cc-about-collections">\n\t\t\t  \t<div slot="content"></div>\n\t\t\t\t<a target="_blank" href=""><i class="icon-question cc-module-icon"></i></a>\n\t\t\t</sl-tooltip>\n\t\t    \x3c!-- <i id="configShowSwitch" class="icon-mini-arrow-right"></i> --\x3e <small>Canvas Collections</small>\n\t\t\t<span style="font-size:50%">{0.9.1}</span></small>\n\t\t  </div>\n\n\t\t<label class="cc-switch">\n\t\t    <input type="checkbox" class="cc-toggle-checkbox" id="cc-switch" ${cc_on}>\n\t\t\t<span class="cc-slider cc-round"></span>\n\t\t</label>\n\t\t<div class="cc-save">\n\t\t  <button class="cc-save-button" id="cc-save-button">Save</button>\n\t    </div>\n\t   </div>\n\t   ${published}\n\t\t`;let easy_student_view=document.querySelector("a#easy_student_view");if(easy_student_view){easy_student_view.insertAdjacentHTML("afterend",CC_BUNDLE_HTML);parseFloat(getComputedStyle(document.documentElement).fontSize);this.model.isOn()&&this.addConfigShowSwitch();document.getElementById("cc-switch").onchange=event=>this.controller.toggleOffOnSwitch(event);document.getElementById("cc-save-button").onclick=event=>this.controller.saveConfig()}else console.error("cc_ConfigurationView.addCcBundle() - could not find a#easy_student_view")}changeSaveButton(change){const saveButton=document.getElementById("cc-save-button");saveButton.className=change?"cc-active-save-button":"cc-save-button"}removeConfigShowSwitch(){const configShowSwitch=document.getElementById("configShowSwitch");configShowSwitch&&configShowSwitch.remove()}addConfigShowSwitch(){if(!document.getElementById("configShowSwitch")){const switchHtml='\n\t\t<i id="configShowSwitch" class="icon-mini-arrow-right"></i> \n\t\t',switchTitle=document.querySelector("div.cc-switch-title");if(switchTitle){switchTitle.insertAdjacentHTML("afterbegin",switchHtml);const configShowSwitch=document.getElementById("configShowSwitch");configShowSwitch&&(configShowSwitch.onclick=event=>this.controller.toggleConfigShowSwitch(event))}}}fileTest(event){console.log("---------------------- fileTest clicked")}displayNewCollectionError(error,removeExisting=!0){const errorHtml=`<div class="cc-config-error">${error}</div>`,newCollection=document.querySelector("div#cc-config-new-collection");if(newCollection){const collection=newCollection.querySelector("div.cc-config-collection");collection&&(removeExisting&&this.removeCollectionErrors(),collection.insertAdjacentHTML("beforeend",errorHtml))}}removeCollectionErrors(){const collection=document.querySelector("div#cc-config-new-collection");if(collection){const existingErrors=collection.querySelectorAll("div.cc-config-error");for(let i=0;i<existingErrors.length;i++)existingErrors[i].remove()}}calculateDate(dateInfo){if(""===dateInfo.week)return"No date set";let calcDate={};calcDate=""===dateInfo.day?this.controller.parentController.calendar.getDate(dateInfo.week):this.controller.parentController.calendar.getDate(dateInfo.week,!1,dateInfo.day);let dateString=`${calcDate.date} ${calcDate.month} ${calcDate.year}`;return calcDate.hasOwnProperty("day")&&(dateString=`${calcDate.day} ${dateString}`),""!==dateInfo.time&&(dateString=`${dateInfo.time} ${dateString}`),dateInfo.hasOwnProperty("label")&&""!==dateInfo.label&&(dateString=`${dateInfo.label} ${dateString}`),dateString}}class updatePageController{constructor(configurationController,navOption,singleCollection){this.configurationController=configurationController,this.parentController=this.configurationController.parentController,this.collectionsView=this.parentController.collectionsController.view,this.navOption=navOption,this.singleCollection=singleCollection,this.createTaskLists(),this.checkTaskList()}createTaskLists(){if(this.tasks=[],this.completedTasks=[],this.singleCollection){const collection=this.singleCollection,collectionConfig=this.parentController.cc_configuration.COLLECTIONS[collection],outputPageName=collectionConfig.outputPage,representationName=collectionConfig.representation,outputPageURL=outputPageName.toLowerCase().replace(/ /g,"-");return this.navOption=1,void this.tasks.push({collection:collection,outputPage:outputPageName,outputPageURL:outputPageURL,representation:representationName,completed:!1,error:!1,errors:[]})}const collections=this.configurationController.model.getCollectionsWithOutputPage();for(let collection of collections){const collectionConfig=this.parentController.cc_configuration.COLLECTIONS[collection],outputPageName=collectionConfig.outputPage,representationName=collectionConfig.representation,outputPageURL=outputPageName.toLowerCase().replace(/ /g,"-");this.tasks.push({collection:collection,outputPage:outputPageName,outputPageURL:outputPageURL,representation:representationName,completed:!1,error:!1,errors:[]})}if("3"!==this.navOption)return;const pagesWithMultipleCollections=this.configurationController.model.getPagesWithMultipleCollections();for(let pageName in pagesWithMultipleCollections){const collections=pagesWithMultipleCollections[pageName],outputPageURL=pageName.toLowerCase().replace(/ /g,"-");this.tasks.push({collections:collections,outputPage:pageName,outputPageURL:outputPageURL,completed:!1,error:!1,errors:[]})}}checkTaskList(){if(this.errors=[],"2"===this.navOption&&this.tasks.length>1){const outputPages=this.tasks.map((task=>task.outputPage)),uniqueOutputPages=[...new Set(outputPages)];outputPages.length!==uniqueOutputPages.length&&(this.errors.push(`"Pages" nav option doesn't work with pages used by multiple collections\nPage(s) used multiple times include: ${uniqueOutputPages.toString()}`),this.completedTasks=this.tasks,this.tasks=[])}}execute(){0===this.errors.length?this.getOutputPage():this.configurationController.completeFullClaytons(this)}async getOutputPage(){if(0===this.tasks.length)return void this.configurationController.completeFullClaytons(this);const courseId=this.configurationController.parentController.courseId,outputPageURL=this.tasks[0].outputPageURL;let callUrl=`/api/v1/courses/${courseId}/pages/${outputPageURL}`,response=await fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.parentController.csrf}});if(!response.ok)return void this.errorFirstTask(`Unable to get page ${outputPageURL} from Canvas`);const data=await response.json();0!==data.length?(this.tasks[0].pageObject=data,this.tasks[0].hasOwnProperty("collection")?this.updateOutputContent():this.updateTabContent()):this.errorFirstTask(`No data provided for page ${outputPageURL}`)}updateTabContent(){if(!this.tasks[0].hasOwnProperty("pageObject"))return void this.errorFirstTask(`No pageObject for ${this.tasks[0].outputPageURL}`);const pageObject=this.tasks[0].pageObject,collectionNames=this.tasks[0].collections,escCollectionNames=collectionNames.map((collectionName=>collectionName.replace(/ /g,"-"))),originalContent=pageObject.body,doc=(new DOMParser).parseFromString(originalContent,"text/html");let collectionDivHTML="";for(let i=0;i<escCollectionNames.length;i++){const divId=`cc-output-${escCollectionNames[i]}`,collectionDiv=doc.getElementById(divId);collectionDiv&&(collectionDivHTML+=collectionDiv.outerHTML,collectionDiv.remove())}let tabInterfaceHtml=this.generateTabHtml(collectionNames,collectionDivHTML);const navDiv=doc.getElementById("cc-nav");navDiv?navDiv.innerHTML=tabInterfaceHtml:doc.body.insertAdjacentHTML("beforeend",tabInterfaceHtml),this.tasks[0].newContent=doc.body.innerHTML,this.writeOutputPage()}updateOutputContent(){if(!this.tasks[0].hasOwnProperty("pageObject"))return void this.errorFirstTask(`No pageObject for ${this.tasks[0].outputPageURL}`);const pageObject=this.tasks[0].pageObject;DEBUG&&console.log(`updatePageController: updateOutputPage: pageObject = ${JSON.stringify(this.pageObject)}`);let collectionName=this.tasks[0].collection;const escCollectionName=collectionName.replace(/ /g,"-"),insertContentHtml=this.collectionsView.generateHTML(collectionName,"claytons",this.navOption),originalContent=pageObject.body,divId=`cc-output-${escCollectionName}`,doc=(new DOMParser).parseFromString(originalContent,"text/html"),div=doc.getElementById(divId);if(div)div.innerHTML=insertContentHtml;else{const newDiv=doc.createElement("div");newDiv.id=divId,newDiv.innerHTML=insertContentHtml,doc.body.appendChild(newDiv)}if("1"===this.navOption){const navUl=doc.querySelector("ul.cc-nav");navUl&&navUl.remove();const navDiv=doc.getElementById("cc-nav");navDiv&&(navDiv.outerHTML=navDiv.innerHTML)}this.tasks[0].newContent=doc.body.innerHTML,this.writeOutputPage()}async writeOutputPage(){if(!this.tasks[0].hasOwnProperty("newContent"))return void this.errorFirstTask(`No newContent for ${this.tasks[0].outputPageURL}`);let newContent=this.tasks[0].newContent;const courseId=this.configurationController.parentController.courseId,outputPageURL=this.tasks[0].outputPageURL;let callUrl=`/api/v1/courses/${courseId}/pages/${outputPageURL}`;-1===newContent.indexOf('\n\t\t<div id="kl_custom_css">&nbsp;</div>\n\t\t')&&(newContent+='\n\t\t<div id="kl_custom_css">&nbsp;</div>\n\t\t'),DEBUG&&console.log(`updatePageController: writeOutputPage: callUrl = ${callUrl}`);let _body={wiki_page:{body:newContent}};const bodyString=JSON.stringify(_body);let response=await fetch(callUrl,{method:"put",credentials:"include",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8","X-CSRF-Token":this.parentController.csrf},body:bodyString});if(response.ok)if(0!==(await response.json()).length){this.tasks[0].hasOwnProperty("collection")?alert(`Updated output page ${outputPageURL} for collection ${this.tasks[0].collection}`):"3"===this.navOption&&this.tasks[0].hasOwnProperty("collections")&&alert(`Add tab navigation to ${outputPageURL}`);let finishedTask=this.tasks.shift();finishedTask.completed=!0,this.completedTasks.push(finishedTask),this.getOutputPage()}else this.errorFirstTask(`No data provided for page ${outputPageURL}`);else this.errorFirstTask(`Unable to update page ${outputPageURL} in Canvas`)}errorFirstTask(error){let errorTask=this.tasks.shift();errorTask.error=!0,errorTask.errors.push(error),this.completedTasks.push(errorTask),this.getOutputPage()}generateOutcomesString(){let completedTasks=this.completedTasks.length,completed=this.completedTasks.filter((task=>!0===task.completed)).length,errors=this.completedTasks.filter((task=>!0===task.error)).length,endSummary="";errors>0&&(endSummary=` with ${errors} errors`);let summary=`completed ${completed} of ${completedTasks} tasks${endSummary}.`;for(let task of this.completedTasks)task.error?summary+=`\n- ${task.collection} - ${task.outputPageURL} - errors - ${task.errors.join("\n     ")}`:task.completed&&(task.hasOwnProperty("collection")?summary+=`\n- ${task.collection} - ${task.outputPageURL} - success`:task.hasOwnProperty("collections")&&(summary+=`\n- ${task.outputPageURL} - tab navigation update - success`));return this.errors.length>0&&(summary+=`\n\nErrors:\n${this.errors.join("\n")}`),summary}generateTabHtml(collectionNames,collectionDivHTML){let navBarHTML="";for(let collectionName of collectionNames){navBarHTML=`${navBarHTML}\n<li style="display: table-cell; width: 100%; float: none;">\n    <a style="float: none;text-decoration: none; display: block; text-align: center; padding: 1.5em 1em; font-size: 1.3em;" \n        href="#cc-output-${collectionName.replace(/ /g,"-")}">${collectionName}</a></li>`}return`\n<div id="cc-nav" class="enhanceable_content tabs" style="font-size: small;">\n  <ul class="cc-nav" style="list-style-type: none; margin: 0; padding: 0; overflow: hidden; background-color: #eeeeee; display: table; table-layout: fixed; width: 100%;">\n    ${navBarHTML}\n  </ul>\n\n  ${collectionDivHTML}\n</div>`}}class moduleLabelApplicator{constructor(collectionName,parentController){this.collectionName=collectionName,this.parentController=parentController}execute(){this.parentController.requestModuleInformation(this.checkModulesUpdated.bind(this))}checkModulesUpdated(ok){ok?(this.parentController.mergeModuleDetails(),this.calculateNewModuleNames()):alert("moduleLabelApplicator: module update failed")}calculateNewModuleNames(){this.newNames=[];const modulesCollections=this.getModulesCollections();for(let module of modulesCollections){if(module.collection!==this.collectionName)continue;const oldName=module.name;let prepend="";if(module.label&&(prepend=module.label),module.actualNum&&(prepend+=` ${module.actualNum}`," "===prepend.charAt(0)&&(prepend=prepend.substring(1))),oldName.startsWith(prepend))continue;const newName=`${prepend}: ${oldName}`;newName!==oldName&&(this.newNames.push({id:module.id,newName:newName}),console.log(`------------- moduleLabelApplicator: ${oldName} -> ${prepend}: ${oldName}`),console.log(module),console.log("-------------"))}this.updateNewModuleNames()}async updateNewModuleNames(){if(0===this.newNames.length)return void alert("moduleLabelApplicator: no new names to update");const updateModule=this.newNames[0];let callUrl=`/api/v1/courses/${this.parentController.courseId}/modules/${updateModule.id}`;DEBUG&&console.log(`moduleLabelApplicator: updateNewModuleNames: callUrl = ${callUrl}`);let _body={module:{name:updateModule.newName}};const bodyString=JSON.stringify(_body),response=await fetch(callUrl,{method:"put",credentials:"include",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8","X-CSRF-Token":this.parentController.csrf},body:bodyString});response.ok?(alert(`moduleLabelApplicator: updated ${updateModule.newName}`),this.newNames.shift(),this.updateNewModuleNames()):alert(`Problem creating config ${response.status} - `)}getModulesCollections(collectionName=null){const mergedDetails=this.parentController.mergedModuleDetails;if(null===collectionName){let values=Object.values(mergedDetails);return values.sort(((a,b)=>a.position-b.position)),values}return Object.keys(mergedDetails).filter((key=>mergedDetails[key].collection===collectionName))}}const TIME_BETWEEN_SAVES=1e4;class cc_ConfigurationController{constructor(controller){DEBUG&&console.log("-------------- cc_ConfigurationController.constructor()"),this.parentController=controller,this.model=new cc_ConfigurationModel(this),this.view=new cc_ConfigurationView(this.model,this),this.view.display(),this.configChange=!1,setInterval(this.saveConfig.bind(this),1e4),window.addEventListener("beforeunload",(event=>this.saveConfig()))}changeMade(change){this.configChange=change,this.view.changeSaveButton(this.configChange),this.parentController.mergeModuleDetails()}saveConfig(){this.configChange&&(this.changeMade(!1),this.parentController.saveConfig(),this.lastSaveTime=(new Date).getTime())}toggleConfigShowSwitch(event){DEBUG&&console.log("-------------- cc_ConfigurationController.toggleConfigShowSwitch()");const className=event.target.className;let status=this.model.getConfigShowClass(),newClass=this.model.getOtherConfigShowClass(className);DEBUG&&console.log(`changing to ${newClass} current setting is ${status}`),this.model.setConfigShowClass(newClass),this.view.display()}toggleModuleConfigSwitch(event){DEBUG&&console.log("-------------- cc_ConfigurationController.toggleModuleConfigSwitch()");const className=event.target.className;let idString=event.target.id;const moduleId=parseInt(idString.match(/cc-module-config-(\d+)-switch/)[1]);if(this.parentController&&this.parentController.courseId&&moduleId&&!window.location.href.endsWith(`#${moduleId}`)){let url=`https://${window.location.hostname}/courses/${this.parentController.courseId}/modules#${moduleId}`;window.history.pushState({},"",url)}this.model.setModuleConfigClass(moduleId,className),this.view.display(),document.getElementById(moduleId).scrollIntoView({behavior:"smooth"})}toggleOffOnSwitch(event){DEBUG&&console.log("-------------- cc_ConfigurationController.toggleOffOnSwitch()");const checked=event.target.checked,currentlyOn=this.model.isOn();DEBUG&&console.log(`currently on ${currentlyOn} and checked is ${checked}`),checked?(this.model.turnOn(),this.parentController.execute()):(this.model.turnOff(),this.parentController.turnOff()),this.changeMade(!0)}moveCollection(event){const idString=event.target.id,collectionName=idString.match(/cc-collection-(.*)-(up|down)/)[1],direction=idString.match(/cc-collection-(.*)-(up|down)/)[2],currentOrder=this.model.getExistingCollectionNames(),index=(currentOrder.join(","),currentOrder.indexOf(collectionName));"up"==direction?(currentOrder.splice(index,1),currentOrder.splice(index-1,0,collectionName)):(currentOrder.splice(index,1),currentOrder.splice(index+1,0,collectionName)),this.model.setExistingCollectionNames(currentOrder),this.changeMade(!0),this.view.updateExistingCollections(),this.parentController.collectionsController.view.display()}deleteCollection(event){const collectionName=event.target.id.match(/cc-collection-(.*)-delete/)[1];confirm(`Are you sure you want to delete the collection ${collectionName}?`)&&(this.model.deleteCollection(collectionName),this.changeMade(!0),this.view.showConfig(),this.parentController.collectionsController.view.display())}changeCollectionRepresentation(event){const collectionName=event.target.id.match(/cc-collection-(.*)-representation/)[1],newRepresentation=event.target.value;collectionName&&(this.model.setCollectionRepresentation(collectionName,newRepresentation),this.changeMade(!0),this.saveConfig(),collectionName===this.model.getCurrentCollection()&&this.parentController.updateCurrentRepresentation())}addNewCollection(event){DEBUG&&console.log("-------------- cc_ConfigurationController.addNewCollection()");let newCollection={};const newCollectionForm=document.querySelector("#cc-config-new-collection");if(newCollectionForm){const newCollectionFormElements=newCollectionForm.querySelectorAll("input , select");for(let i=0;i<newCollectionFormElements.length;i++){const element=newCollectionFormElements[i];if(element.id){newCollection[element.id.match(/cc-config-new-collection-(.*)/)[1]]=element.value}}console.log("-------------- addnewCollection"),console.log(newCollection)}if(""==newCollection.name)return void this.view.displayNewCollectionError("Name of new collection cannot be empty");const existingCollectionNames=this.model.getExistingCollectionNames();for(let i=0;i<existingCollectionNames.length;i++)if(existingCollectionNames[i]===newCollection.name)return void this.view.displayNewCollectionError(`Name of new collection (<strong>${newCollection.name}</strong>) is already in use`);this.model.addNewCollection(newCollection),this.changeMade(!0),this.view.showConfig(),this.parentController.collectionsController.view.display()}changeHideCollection(event){const value=event.target.checked,collectionName=event.target.id.match(/cc-config-collection-(.*)-hide/)[1];this.model.setCollectionAttribute(collectionName,"hide",value),this.changeMade(!0),this.parentController.collectionsController.view.display()}changeDefaultCollection(event){if(!event.target.checked)return void this.handleDefaultConfigurationError(event);const idString=event.target.id,collectionName=idString.match(/cc-config-collection-(.*)-default/)[1];this.model.setDefaultCollection(collectionName),this.changeMade(!0);const defaultCollectionCheckboxes=document.querySelectorAll("input.cc-config-collection-default");for(let i=0;i<defaultCollectionCheckboxes.length;i++){const checkbox=defaultCollectionCheckboxes[i];checkbox.id!==idString&&(checkbox.checked=!1)}}handleDefaultConfigurationError(event){event.target.checked=!0,alert("Unable to uncheck the default collection - there always needs to be one.  Check the new default collection to change.")}modifyCollectionPages(event){const value=event.target.value,idString=event.target.id,collectionName=idString.match(/cc-collection-([^-]+)-/)[1],pageType=idString.match(/-([^-]+)-page$/)[1];"output"!==pageType||"Canvas Collections Configuration"!==value?this.model.changeCollectionPage(collectionName,pageType,value)&&("output"===pageType&&this.view.showConfig(),this.changeMade(!0),this.parentController.collectionsController.view.display()):alert("Canvas Collections Configuration cannot be used as an output page")}updateModuleConfigField(event,updateView=!0){const idString=event.target.id,moduleId=parseInt(idString.match(/cc-module-config-(\d+)-(.*)/)[1]),fieldName=idString.match(/cc-module-config-(\d+)-(.*)/)[2];let value=event.target.value;"autonum"===fieldName&&(value=event.target.checked),this.model.changeModuleConfig(moduleId,fieldName,value),this.changeMade(!0),updateView&&(this.parentController.collectionsController.view.updateCurrentRepresentation(),this.view.updateSingleModuleConfig(moduleId))}manageModuleMetadata(event){const target=event.target,element=target.tagName.toLowerCase(),idString=target.id;if("button"===element){const moduleId=parseInt(idString.match(/cc-module-config-(\d+)-metadata-add/)[1]),name=document.querySelector(`#cc-module-config-${moduleId}-metadata-add-name`).value;if(name.includes('"'))return void alert('Metadata name cannot contain " characters');const value=document.querySelector(`#cc-module-config-${moduleId}-metadata-add-value`).value;if(""===name)return void alert("Unable to add metadata without a name.");this.model.addModuleMetadata(moduleId,name,value),this.changeMade(!0),this.view.updateSingleModuleConfig(moduleId),this.parentController.updateCurrentRepresentation()}else if("i"===element){const moduleId=parseInt(idString.match(/cc-module-config-(\d+)-metadata-(.*)-delete/)[1]),name=idString.match(/cc-module-config-(\d+)-metadata-(.*)-delete/)[2];this.model.deleteModuleMetadata(moduleId,name),this.changeMade(!0),this.view.updateSingleModuleConfig(moduleId),this.parentController.updateCurrentRepresentation()}else if("input"===element){const moduleId=parseInt(idString.match(/cc-module-config-(\d+)-metadata-(.*)-(.*)/)[1]),name=idString.match(/cc-module-config-(\d+)-metadata-(.*)-(.*)/)[2],fieldName=idString.match(/cc-module-config-(\d+)-metadata-(.*)-(.*)/)[3],valueChanged=target.value;if("name"===fieldName){const value=document.querySelector(`#cc-module-config-${moduleId}-metadata-${name}-value`).value;this.model.deleteModuleMetadata(moduleId,name),this.model.addModuleMetadata(moduleId,valueChanged,value)}else"value"===fieldName&&this.model.updateModuleMetadata(moduleId,name,valueChanged);this.changeMade(!0),this.view.updateSingleModuleConfig(moduleId),this.parentController.updateCurrentRepresentation()}}updateOutputPage(event){const collectionName=event.target.id.match(/cc-collection-(.*)-output-page-update/)[1];new updatePageController(this,void 0,collectionName).execute()}updateFullClaytons(event){const navigationOption=document.querySelector("#cc-config-full-claytons-navigation-option");let navigationOptionValue="1";navigationOption&&(navigationOptionValue=navigationOption.value),new updatePageController(this,navigationOptionValue).execute()}completeFullClaytons(pageController){let outcomes=pageController.generateOutcomesString();pageController.singleCollection||alert(`Full Claytons update ${outcomes}`)}applyModuleLabels(event){const collectionName=event.target.id.match(/cc-collection-(.*)-apply-module-labels/)[1];new moduleLabelApplicator(collectionName,this.parentController).execute()}manageBannerTabShow(event){const matches=document.querySelector(`#${event.target.id}`).panel.match(/^cc-module-config-(\d+)-(.*)$/);if(3===matches.length){const moduleId=parseInt(matches[1]),tabName=matches[2];this.model.changeModuleConfig(moduleId,"banner",tabName),this.changeMade(!0),this.parentController.updateCurrentRepresentation()}}manageColourPickerChange(event){const element=document.querySelector(`#${event.target.id}`),matches=element.id.match(/^cc-module-config-(\d+)-color$/);if(2===matches.length){const moduleId=parseInt(matches[1]);this.model.changeModuleConfig(moduleId,"bannerColour",element.value),this.changeMade(!0)}}manageAccordionToggle(event){const idString=document.querySelector(`#${event.target.id}`).id,eventType=event.type,matches=idString.match(/^cc-module-config-(\d+)-(.*)-accordion$/);if(3===matches.length){const moduleId=parseInt(matches[1]),accordionName=matches[2];console.log(`Accordion ${accordionName} for module ${moduleId} is ${eventType}`),this.model.changeModuleDisplay(moduleId,accordionName,eventType),this.changeMade(!0)}}}class CollectionsModel{constructor(controller){if(DEBUG&&console.log("-------------- CollectionsModel.constructor()"),this.controller=controller,this.cc_configuration=this.controller.parentController.cc_configuration,this.controller.hasOwnProperty("parentController")&&this.controller.parentController.hasOwnProperty("calendar")?this.calendar=this.controller.parentController.calendar:this.model.hasOwnProperty("controller")&&this.model.controller.hasOwnProperty("parentController")&&this.model.controller.parentController.hasOwnProperty("calendar")?this.calendar=this.model.controller.parentController.calendar:alert("Another funny calendar miss. Fix it"),void 0===this.currentCollection)if(this.controller.parentController.hasOwnProperty("URLCollectionNum")){let URLCollectionNum=this.controller.parentController.URLCollectionNum;Number.isInteger(URLCollectionNum)&&URLCollectionNum>=0&&URLCollectionNum<this.cc_configuration.COLLECTIONS_ORDER.length&&(this.currentCollection=this.cc_configuration.COLLECTIONS_ORDER[URLCollectionNum])}else this.controller.parentController.lastCollectionViewed&&""!==this.controller.parentController.lastCollectionViewed?this.currentCollection=this.controller.parentController.lastCollectionViewed:this.currentCollection=this.getDefaultCollection()}getEditMode(){return this.controller.parentController.editMode}getDefaultCollection(){return this.cc_configuration.DEFAULT_ACTIVE_COLLECTION}setCurrentCollection(newCollection){this.currentCollection=newCollection}getCollections(){return this.cc_configuration.COLLECTIONS_ORDER}getCurrentCollection(){return this.currentCollection}getCurrentCollectionDescription(){return this.cc_configuration.COLLECTIONS[this.currentCollection].description}getCurrentCollectionRepresentation(){return this.hasOwnProperty("currentCollection")&&this.cc_configuration.COLLECTIONS.hasOwnProperty(this.currentCollection)&&this.cc_configuration.COLLECTIONS[this.currentCollection].hasOwnProperty("representation")?this.cc_configuration.COLLECTIONS[this.currentCollection].representation:null}getCurrentCollectionIncludePage(){return this.hasOwnProperty("currentCollection")&&this.cc_configuration.COLLECTIONS.hasOwnProperty(this.currentCollection)&&this.cc_configuration.COLLECTIONS[this.currentCollection].hasOwnProperty("includePage")?this.cc_configuration.COLLECTIONS[this.currentCollection].includePage:null}getCollectionRepresentation(collection){return this.cc_configuration.COLLECTIONS.hasOwnProperty(collection)&&this.cc_configuration.COLLECTIONS[collection].hasOwnProperty("representation")?this.cc_configuration.COLLECTIONS[collection].representation:null}getCollectionNames(){return this.cc_configuration.COLLECTIONS_ORDER}getCollectionsModules(collection=""){if(""===collection)return this.cc_configuration.MODULES;const modules=this.cc_configuration.MODULES;return Object.keys(modules).filter((key=>modules[key].collection===collection)).map((key=>modules[key]))}createModuleCollections(){DEBUG&&console.log("-------------- cc_CollectionsModel.createModuleCollections()");let canvasModules=this.controller.parentController.moduleDetails,ccModules=this.cc_configuration.MODULES;this.modulesCollections=[];for(let i=0;i<canvasModules.length;i++){let details={};for(let key in canvasModules[i])details[key]=canvasModules[i][key];let ccModule=ccModules[canvasModules[i].id];if(ccModule){const skipFields=["name"];for(let key in ccModule)skipFields.includes(key)||(details[key]=ccModule[key])}details.cc_itemsCompleted=this.getItemsCompleted(details),this.modulesCollections.push(details)}console.log(this.modulesCollections)}getItemsCompleted(module){let itemsCompleted={numRequired:0,numCompleted:0};if(module.items){for(let i=0;i<module.items.length;i++){let item=module.items[i];item.completion_requirement&&(itemsCompleted.numRequired++,item.completion_requirement.completed&&itemsCompleted.numCompleted++)}if(0!==itemsCompleted.numRequired)return itemsCompleted}}getModules(){return this.controller.parentController.moduleDetails}getModulesCollections(collectionName=null){const mergedDetails=this.controller.parentController.mergedModuleDetails;if(null===collectionName){let values=Object.values(mergedDetails);return values.sort(((a,b)=>a.position-b.position)),values}return Object.keys(mergedDetails).filter((key=>mergedDetails[key].collection===collectionName))}deLabelModuleName(module){const existingName=module.name;let prepend="";module.label&&(prepend=module.label);let regex=new RegExp(`^${prepend}\\s*[:-]\\s*`);module.actualNum&&(regex=new RegExp(`^${prepend}\\s*${module.actualNum}\\s*[:-]\\s*`),prepend+=` ${module.actualNum}`," "===prepend.charAt(0)&&(prepend=prepend.substring(1))),prepend=`${prepend}: `;let newName=existingName;return": "!==prepend&&(newName=existingName.replace(regex,"").trim()),newName}getOutputPageCollections(){let collections=[];for(let i=0;i<this.cc_configuration.COLLECTIONS_ORDER.length;i++){let collection=this.cc_configuration.COLLECTIONS_ORDER[i];if(this.cc_configuration.COLLECTIONS[collection].hasOwnProperty("outputPage")&&""!==this.cc_configuration.COLLECTIONS[collection].outputPage){let collectionObj=this.cc_configuration.COLLECTIONS[collection];collectionObj.name=collection,collections.push(collectionObj)}}return collections}calculatePageUrl(pageName){const courseId=this.controller.parentController.courseId;let pageUrl=this.controller.parentController.documentUrl;return pageUrl=pageUrl.replace(/\/courses\/\d+\/.*/,`/courses/${courseId}/pages/`),pageUrl+=pageName.toLowerCase().replace(/ /g,"-"),pageUrl}getModuleViewUrl(){return this.controller.parentController.documentUrl}convertFrom24To12Format(time24){const timeMatch=time24.match(/([0-9]{1,2}):([0-9]{2})/);if(timeMatch){const[sHours,minutes]=timeMatch.slice(1);return`${+sHours%12||12}:${minutes} ${+sHours<12?"AM":"PM"}`}return time24}addCalendarDate(date){date.hasOwnProperty("day")||(date.day="Monday"),this.updateDate(date),this.updateDate(date.to)}updateDate(date){if(!date||!this.hasOwnProperty("calendar"))return;if(!date.hasOwnProperty("week")||""===date.week)return;const actualDate=this.calendar.getDate(date.week,!1,date.day),fields=["date","month","year"];for(let i=0;i<fields.length;i++)date[fields[i]]=actualDate[fields[i]]}}const NAV_WF_TOOLTIPS=[{contentText:"<p>Collection hidden from students. Any published modules for this collection\n\t\tmay be visible to students.</p>",targetSelector:"#cc-about-hide-collection",animateFunction:"spin",href:"https://djplaner.github.io/canvas-collections/reference/#hide-a-collection"}];class NavView extends cc_View{constructor(model,controller){super(model,controller),this.TOOLTIPS=NAV_WF_TOOLTIPS}display(){DEBUG&&console.log("-------------- cc_NavView.display()");let div=document.getElementById("cc-canvas-collections"),navBarHTML=this.generateHTML();div.insertAdjacentHTML("beforeend",navBarHTML);const navItems=document.querySelectorAll("li.cc-nav");for(let i=0;i<navItems.length;i+=1)navItems[i].onclick=event=>this.controller.navigateCollections(event);this.addTooltips()}generateHTML(collectionName="",variety=""){return"2"===variety?this.generatePageNavBar(collectionName):"3"===variety?this.generateTabNavBar(collectionName):"1"===variety?"":""!==variety?(alert(`NavView.generateHTML() - unknown variety: ${variety}`),""):this.generateLiveNavBar(collectionName)}generateLiveNavBar(collectionName){let navBar=document.createElement("div");navBar.className="cc-nav";navBar.insertAdjacentHTML("afterbegin","\n\t\t<style>\n.cc-content {\n    clear:both;\n}\n\n.cc-nav { \n    font-size: small;\n}\n\n.cc-nav ul  {\n\tlist-style-type: none;\n    margin: 0;\n    padding: 0;\n    overflow: hidden ;\n    background-color: #eee; \n\tdisplay: table;\n\ttable-layout: fixed;\n\twidth: 100%\n}\n\nli.cc-active {\n    background-color: var(--ic-brand-button--primary-bgd) !important; \n    font-weight: bold; \n}\n\nli.cc-active a {\n\tcolor: var(--ic-brand-button--primary-text) !important; \n\tborder-top: 4px solid var(--ic-brand-button--primary-bgd) !important; \n}\n\nli.cc-close {\n    float: right !important;\n    border-right: none !important;\n}\n\n.cc-nav ul li {\n\tdisplay: table-cell;\n\twidth: 100%;\n /*   border-right: 1px solid #000; */\n\tfloat: none;\n}\n\nli.cc-nav a {\n    display: block;\n    text-align: center !important;\n    text-decoration: none;\n    color: #2d3b45;  \n\tpadding: 1em 0.8em !important;\n\tborder-top: 4px solid #eee; \n\tbox-sizing: border-box;\n\tfont-size: 1.2em;\n\ttransition: background 0.3s linear 0s !important;\n}\n\n.cc-nav li a:hover {\n /*   background-color: #111; */\n    background-color: var(--ic-brand-button--primary-bgd); \n\tborder-top: 4px solid var(--ic-brand-button--primary-bgd); \n\t  color: rgb(255, 255, 255) !important;\n  background: rgba(51, 51, 51, 0.9) !important;\n  text-decoration: none !important;\n  color: rgb(255, 255, 255) !important;\n/*  border-top: 4px solid #c12525; */\n}\n\n.cc-nav li:nth-child(4) {\n    border-right: none;\n}\n\n.cc-collection-hidden {\n\tbackground: #cacaca;\n\ttext-align:center;\n}\ndiv.cc-collection-hidden > a {\n\tdisplay:inline;\n}\n</style>\n\t\t");const editMode=this.controller.parentController.editMode;let count=0,navList=document.createElement("ul"),collectionNum=1,currentUrl=window.location.href,newUrl=new URL(currentUrl);for(let collection of this.model.getCollectionNames()){let collectionDetails=this.model.cc_configuration.COLLECTIONS[collection],icon="";if(""!==collectionDetails.icon&&(icon=`<i class="${collectionDetails.icon}"></i>`),collectionDetails.hide&&!editMode)continue;newUrl.hash=`cc-collection-${collectionNum}`,collectionNum+=1;let navElement=`<a href="${newUrl.href}">${icon} ${collection}</a> `,navItem=document.createElement("li");if(navItem.className="cc-nav",(collection===this.model.currentCollection||void 0===this.model.currentCollection&&0===count)&&navItem.classList.add("cc-active"),count+=1,navItem.innerHTML=navElement,collectionDetails.hide&&editMode){let hiddenDiv=document.createElement("div");hiddenDiv.className="cc-collection-hidden",hiddenDiv.innerHTML='Hidden\n\t\t\t\t\t\t<a id="cc-about-hide-collection" target="_blank" href="">\n\t\t\t   \t\t\t\t\t<i class="icon-question"></i></a>',navItem.insertAdjacentElement("beforeend",hiddenDiv)}navList.appendChild(navItem)}return navBar.appendChild(navList),navBar.outerHTML}generatePageNavBar(collectionName=""){let CLAYTONS_NAVBAR_HTML='\n\t\t<div id="cc-nav" style="font-size:small">\n\t\t  <ul style="list-style-type:none;margin:0;padding:0;overflow:hidden;background-color:#eeeeee;display:table;table-layout:fixed;width:100%">\n\t\t  {{NAVBAR_ITEMS}}\n\t\t  </ul>\n\t    </div>';const collectionsOutput=this.model.getOutputPageCollections();let items="";return collectionsOutput.forEach((collection=>{let liStyle=' style="display:table-cell;width:100%;float:none"',aStyle=' style="text-decoration:none;display:block;text-align:center;padding:1em 0.8em;box-sizing:border-box;font-size:1.2em;border-top:4px solid #eee;"';collection.name===collectionName&&(liStyle=' style="display:table-cell;float:none;width:100%;font-weight:bold;background-color:#c12525;"',aStyle=' style="display:block;text-align:center;text-decoration:none;padding:1em 0.8em;box-sizing:border-box;font-size:1.2em;color:#fff;"');let pageUrl=this.model.calculatePageUrl(collection.outputPage);items=`${items}\n\t\t   <li${liStyle}>\n\t\t     <a${aStyle} href="${pageUrl}">${collection.name}</a>\n\t\t   </li>\n\t\t`})),CLAYTONS_NAVBAR_HTML.replace("{{NAVBAR_ITEMS}}",items)}generateTabNavBar(collectionName=""){let CLAYTONS_NAVBAR_HTML='\n\t\t<div id="cc-nav" class="enhanceable_content tabs" style="font-size:small">\n\t\t  <ul style="list-style-type:none;margin:0;padding:0;overflow:hidden;background-color:#eeeeee;display:table;table-layout:fixed;width:100%">\n\t\t  {{NAVBAR_ITEMS}}\n\t\t  </ul>\n\t    </div>';const collectionsOutput=this.model.getOutputPageCollections();let items="";return collectionsOutput.forEach((collection=>{let liStyle=' style="display:table-cell;width:100%;float:none"',aStyle=' style="text-decoration:none;display:block;text-align:center;padding:1em 0.8em;box-sizing:border-box;font-size:1.2em;border-top:4px solid #eee;"';collection.name===collectionName&&(liStyle=' style="display:table-cell;float:none;width:100%;font-weight:bold;background-color:#c12525;"',aStyle=' style="display:block;float:none;text-align:center;text-decoration:none;padding:1em 0.8em;box-sizing:border-box;font-size:1.2em;color:#fff;"');let pageUrl=`#cc-output-${collection.name}`;items=`${items}\n\t\t   <li${liStyle}>\n\t\t     <a${aStyle} href="${pageUrl}">${collection.name}</a>\n\t\t   </li>\n\t\t`})),CLAYTONS_NAVBAR_HTML.replace("{{NAVBAR_ITEMS}}",items)}}class TableView extends cc_View{constructor(model,controller){super(model,controller),this.currentCollection=this.model.getCurrentCollection()}display(){DEBUG&&console.log("-------------- TableView.display()");let div=document.getElementById("cc-canvas-collections"),message=document.createElement("div");message.className="cc-message",message.innerHTML="<h1> Hello from TableView </h1>",div.insertAdjacentElement("beforeend",message)}}const TABLE_STYLES="\n.cc-assessment-container { \n  margin: auto;\n  max-width: 90%;\n}\n\n/* Standard table styling, change as desired */\n.cc-assessment-container table {\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n  \n.cc-assessment-container caption { \n  font-size: 0.5em;\n  font-weight: 700;\n  text-align: left;\n}\n\ntd.descriptionCell {\n  width: 20rem;\n}\n  \n.cc-assessment-container th {\n  border-bottom: 1px solid #bfc1c3;\n  font-size: 1em;\n  padding: 0.5em 1em 0.5em 0;\n  vertical-align:top;\n  text-align: left;\n  background-color: #e03e2d;\n  color: #fff;\n  font-weight: bold;\n}\n  \n.cc-assessment-container td {\n  border-bottom: 1px solid #bfc1c3;\n  font-size: 1em;\n  padding: 0.5em; /*1em 0.5em 0; */\n  vertical-align: top;\n}\n\n/* Responsive table styling */\n.cc-assessment-container .cc-responsive-table { \n  margin-bottom: 0;\n  width: 100%;\n}\n\n.cc-assessment-container thead {\n  border: 0;\n  clip: rect(0 0 0 0);\n  -webkit-clip-path: inset(50%);\n  clip-path: inset(50%);\n  height: 1px;\n  margin: 0;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  white-space: nowrap;\n  width: 1px;\n}\n\n.cc-assessment-container tbody tr {\n  display: block;\n  margin-bottom: 1.5em;\n  padding: 0 0.5em;\n}\n\n.cc-assessment-container tr:nth-child(even) {\n  background-color: rgb(245,245,245) \n}\n\n/*.cc-assessment-container tr:nth-child(odd) {\n  background-color: rgb(128,);\n}*/\n\n.cc-assessment-container tbody tr td {\n  display: block; /* browsers that don't support flex */\n  display: flex;\n  justify-content: space-between;\n  min-width: 1px;\n  text-align: right;\n}\n\n@media all and (-ms-high-contrast: none) { /* IE11 flex fix */\n  .cc-assessment-container tbody tr td {\n    display: block;\n  }\n}\n\n.cc-assessment-container .cc-responsive-table__heading {\n  font-weight: 700;\n  padding-right: 0.5em;\n  text-align: left;\n  word-break: initial;\n}\n\n@media (max-width: 768px) {\n  .cc-assessment-container tbody tr td {\n    padding-right: 0;\n  }\n  .cc-assessment-container tbody tr td:last-child {\n    border-bottom: 0;\n  }\n  tbody tr {\n    .cc-assessment-container border-bottom: 3px solid grey;\n  }\n}\n\n@media (min-width: 769px) {\n  .cc-assessment-container thead {\n    clip: auto;\n    -webkit-clip-path: none;\n    clip-path: none;\n    display: table-header-group;\n    height: auto;\n    overflow: auto;\n    position: relative;\n    width: auto;\n  }\n  \n  .cc-assessment-container tbody tr {\n    display: table-row;\n  }\n  \n  .cc-assessment-container tbody tr td {\n    display: table-cell;\n    text-align: left;\n  }\n  \n  .cc-assessment-container .cc-responsive-table__heading {\n    display: none;\n  }\n}\n\n  .cc-table-header-text {\n    margin-left: 0.5rem;\n  }\n\n  .cc-table-cell-text {\n    margin: 0;\n  }\n\n  .cc-table-cell-text > p {\n    margin: 0.5rem;\n    font-size: 0.8rem;\n  }\n\n  #cc-assessment-table {\n    margin-top: 0.5rem !important;\n  }\n\t",TABLE_HTML=`\n\t\t<div id="cc-assessment-table" class="cc-assessment-container cc-representation">\n\t\t<style>\n\t\t\t${TABLE_STYLES}\n\t\t</style>\n\n\t\t\t<table class="cc-responsive-table" role="table">\n      \t\t\t<caption>{{CAPTION}}</caption>\n      \t\t\t<thead role="rowgroup">\n        \t\t\t<tr role="row">\n          \t\t\t\t<th role="columnheader" scope="col"><span class="cc-table-header-text">Title</span></th>\n          \t\t\t\t<th role="columnheader" scope="col"><span class="cc-table-header-text">Description</span></th>\n          \t\t\t\t<th role="columnheader" scope="col"><span class="cc-table-header-text">Weighting</span></th>\n          \t\t\t\t<th role="columnheader" scope="col"><span class="cc-table-header-text">Due Date</span></th>\n          \t\t\t\t<th role="columnheader" scope="col"><span class="cc-table-header-text">Learning Outcomes</span></th>\n\t\t\t\t\t</tr> \n\t\t\t\t</thead>\n   \t\t\t<tbody>\n\t\t \t      {{TABLE-ROWS}}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t\t`,TABLE_HTML_CLAYTONS='\n<div id="cc-assessment-table" class="cc-assessment-container">\n<table class="cc-assessment-table ic-Table--hover-row ic-Table ic-Table--striped -ic-Table--condensed" \n   role="table">\n  <thead role="rowgroup">\n    <tr role="row">\n      <th role="columnheader" scope="col" style="width:20%;background-color:#e03e2d">\n        <span style="color:#ffffff">Title</span>\n        </th>\n      <th role="columnheader" scope="col" style="width:40%;background-color:#e03e2d">\n        <span style="color:#ffffff">Description</span>\n        </th>\n      <th role="columnheader" scope="col" style="background-color:#e03e2d">\n        <span style="color:#ffffff">Weighting</span>\n        </th>\n      <th role="columnheader" scope="col" style="background-color:#e03e2d">\n        <span style="color:#ffffff">Due Date</span>\n        </th>\n      <th role="columnheader" scope="col" style="width:10%;background-color:#e03e2d">\n        <span style="color:#ffffff">Learning Outcomes</span>\n        </th>\n    </tr>\n  </thead>\n  <tbody>\n    {{TABLE-ROWS}}\n  </tbody>\n</table>\n</div>\n',TABLE_ROW_HTML='\n\t\t  <tr role="row">\n          <td role="cell">\n            <span class="cc-responsive-table__heading" aria-hidden="true">Title</span>\n            <div class="cc-table-cell-text"><p><a href="{{MODULE-ID}}">\n              {{TITLE}}\n\n            </a></p> </div>\n          </td>\n          <td role="cell" class="descriptionCell">\n            <span class="cc-responsive-table__heading" aria-hidden="true">Description</span>\n            <div class="cc-table-cell-text">\n            {{DESCRIPTION}}\n            </div>\n          </td>\n          <td role="cell">\n            <span class="cc-responsive-table__heading" aria-hidden="true">Weighting</span>\n            <div class="cc-table-cell-text">\n            <p>{{WEIGHTING}}</p>\n            </div>\n          </td>\n          <td role="cell">\n            <span class="cc-responsive-table__heading" aria-hidden="true">Due Date</span>\n            <div class="cc-table-cell-text">\n            <p>{{DATE-LABEL}}<br />{{DUE-DATE}}</p>\n            </div>\n          </td>\n          <td role="cell">\n            <span class="cc-responsive-table__heading" aria-hidden="true">Learning Outcomes</span>\n            <div class="cc-table-cell-text">\n            <p>{{LEARNING-OUTCOMES}}</p>\n            </div>\n          </td>\n        </tr>\n',TABLE_ROW_HTML_CLAYTONS='\n\t\t  <tr role="row">\n          <td role="cell" style="vertical-align:top; padding: 0.5rem">\n            <div class="cc-table-cell-text"><p><a href="{{MODULE-ID}}">\n              {{TITLE}}\n            </a></p> </div>\n          </td>\n          <td role="cell" class="descriptionCell" style="vertical-align:top; padding: 0.5rem">\n            <div class="cc-table-cell-text">\n            {{DESCRIPTION}}\n            </div>\n          </td>\n          <td role="cell" style="vertical-align:top;padding:0.5rem">\n            <div class="cc-table-cell-text">\n            <p>{{WEIGHTING}}</p>\n            </div>\n          </td>\n          <td role="cell" style="vertical-align:top;padding:0.5rem">\n            <div class="cc-table-cell-text">\n            <p>{{DATE-LABEL}}<br />{{DUE-DATE}}</p>\n            </div>\n          </td>\n          <td role="cell" style="vertical-align:top;padding:0.5rem">\n            <div class="cc-table-cell-text">\n            <p>{{LEARNING-OUTCOMES}}</p>\n            </div>\n          </td>\n        </tr>\n';class AssessmentTableView extends cc_View{constructor(model,controller){super(model,controller),this.TABLE_HTML=TABLE_HTML,this.TABLE_HTML_FIELD_NAMES=["DESCRIPTION","CAPTION","TABLE-ROWS","TITLE","TYPE","DATE-LABEL","DUE-DATE","WEIGHTING","LEARNING-OUTCOMES","DESCRIPTION","MODULE-ID"],this.currentCollection=this.model.getCurrentCollection()}display(){DEBUG&&console.log("-------------- AssessmentTable.display()");let div=document.getElementById("cc-canvas-collections"),existingDiv=document.querySelector("div.cc-assessment-table");existingDiv&&existingDiv.remove();let message=document.createElement("div");message.className="cc-assessment-table";const currentCollection=this.model.getCurrentCollection();message.innerHTML=this.generateHTML(currentCollection),div.insertAdjacentElement("beforeend",message)}generateHTML(collectionName,variety=""){let messageHtml=this.TABLE_HTML;"claytons"===variety&&(messageHtml=TABLE_HTML_CLAYTONS);this.model.getCurrentCollectionDescription();const modules=this.model.getModulesCollections(),modulesUrl=this.model.getModuleViewUrl();let tableRows="";for(let i=0;i<modules.length;i++){if(modules[i].collection!==collectionName)continue;let rowHtml=TABLE_ROW_HTML;"claytons"===variety&&(rowHtml=TABLE_ROW_HTML_CLAYTONS);let dateLabel="",dueDateString="",calendarDate=this.generateCalendarDate(modules[i].date);if(calendarDate){const dateFields=["time","day","date","month","year"];dateFields.forEach((field=>{calendarDate.hasOwnProperty(field)&&""!==calendarDate[field]&&(dueDateString=`${dueDateString} ${calendarDate[field]}`)})),calendarDate.hasOwnProperty("to")&&(dueDateString=`${dueDateString} - `,dateFields.forEach((field=>{calendarDate.to.hasOwnProperty(field)&&""!==calendarDate.to[field]&&(dueDateString=`${dueDateString} ${calendarDate.to[field]}`)}))),calendarDate.label&&(dateLabel=calendarDate.label)}let mapping={"MODULE-ID":`${modulesUrl}/#${modules[i].id}`,DESCRIPTION:modules[i].description,TITLE:this.model.deLabelModuleName(modules[i]),TYPE:modules[i].label,"DUE-DATE":dueDateString,"DATE-LABEL":dateLabel};"claytons"===variety&&(mapping["MODULE-ID"]=`${modulesUrl}#module_${modules[i].id}`);const metaData=modules[i].metadata;metaData&&(metaData.hasOwnProperty("weighting")&&(mapping.WEIGHTING=metaData.weighting),metaData.hasOwnProperty("learning outcomes")&&(mapping["LEARNING-OUTCOMES"]=metaData["learning outcomes"]));for(let key in mapping)mapping.hasOwnProperty(key)&&(rowHtml=rowHtml.replace(`{{${key}}}`,mapping[key]));tableRows+=rowHtml}messageHtml=messageHtml.replace(/{{TABLE-ROWS}}/g,tableRows);let editMode=!1;const ccController=this.controller.parentController;return ccController&&(editMode=ccController.editMode),editMode&&"claytons"!==variety||(messageHtml=this.emptyRemainingFields(messageHtml)),messageHtml}emptyRemainingFields(message){return this.TABLE_HTML_FIELD_NAMES.forEach((fieldName=>{message=message.replaceAll(`{{${fieldName}}}`,"")})),message}}class CollectionOnlyView extends cc_View{constructor(model,controller){super(model,controller),this.currentCollection=this.model.getCurrentCollection()}display(){DEBUG&&console.log("-------------- TableView.display()");let div=document.getElementById("cc-canvas-collections"),message=document.createElement("div");message.className="cc-message";const currentCollection=this.model.getCurrentCollection();message.innerHTML=this.generateHTML(currentCollection),div.insertAdjacentElement("beforeend",message)}generateHTML(collectionName){return""}}window.CircularProgressBar=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){t.exports=function(){"use strict";const t=function(t,e){const n="number"==typeof t?{value:t}:t;Object.entries(n).map((([t,n])=>e(n,t)))};function e(t,e){this.start=new Date/1e3,this.time=e,this.from=t,this.current=t,this.to=t,this.speed=0}return e.prototype.get=function(t){const e=t/1e3-this.start;if(e<0)throw new Error("Cannot read in the past");return e>=this.time?this.to:this.to-((t,e,n,i)=>(e*n+2*t)/n**3*i**3+-(2*e*n+3*t)/n**2*i**2+e*i+t)(this.to-this.from,this.speed,this.time,e)},e.prototype.getSpeed=function(t){const e=t/1e3-this.start;return e>=this.time?0:((t,e,n,i)=>(e*n+2*t)/n**3*3*i**2+-(2*e*n+3*t)/n**2*2*i+e)(this.to-this.from,this.speed,this.time,e)},e.prototype.set=function(t,e){const n=new Date,i=this.get(n);return this.speed=this.getSpeed(n),this.start=n/1e3,this.from=i,this.to=t,e&&(this.time=e),i},function(n,i=300){return"number"==typeof n&&(n={value:n}),t(n,((t,r)=>{const o=new e(t,i/1e3);Object.defineProperty(n,"_"+r,{value:o}),Object.defineProperty(n,r,{get:()=>o.get(new Date),set:t=>o.set(t),enumerable:!0})})),Object.defineProperty(n,"get",{get:()=>function(t="value",e=new Date){return this["_"+t].get(e)}}),Object.defineProperty(n,"set",{get:()=>function(e,n=0){t(e,((t,e)=>{this["_"+e].set(t,n/1e3)}))}}),n}}()},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return f}));var i=n(0),r=n.n(i);n(2);const o=(t,e)=>{Object.keys(e).forEach((n=>t.style[n]=e[n]))},s=Symbol("_values"),a=Symbol("_interpolated"),c=Symbol("_text"),u=Symbol("_update"),l=Symbol("_lastUpdate"),h=Symbol("_animationFrame");class f{constructor(t=0,e){this.options={...f.defaultOptions,...e},this.node=document.createElement("div"),this.node.className="circular-progress-bar",o(this.node,{width:`${this.options.size}px`,height:`${this.options.size}px`});const n=document.createElement("div");n.className="circular-progress-bar_value";const i=(100-this.options.barsWidth)/100*this.options.size;o(n,{background:this.options.valueBackground,width:`${i}px`,height:`${i}px`,top:this.options.barsWidth/2+"%",left:this.options.barsWidth/2+"%"}),this.node.appendChild(n),this[c]=document.createElement("div"),this[c].className="circular-progress-bar_value_text",o(this[c],{lineHeight:`${i}px`,fontSize:i/3+"px"}),n.appendChild(this[c]);const s=Array.isArray(t)?t:[t];this[a]=r()(s),this[u]=this[u].bind(this),this.values=s}get value(){return this.values[0]}get values(){return this[s]}set value(t){this.values=[t]}set values(t){if(this[s]=t,t.length!==this[a].length){const e=new Date,n=this[a].map(((t,e)=>this[a][`_${e}`]));for(;n.length&&0===n[n.length-1].get(e);)n.length-=1;const{length:i}=n;this[a]=r()(new Array(Math.max(i,t.length)).fill(0));for(let t=0;t<i;++t){const i=n[t],r=this[a][`_${t}`];r.time=0,r.to=i.get(e)}t.push(...new Array(Math.max(0,i-t.length)).fill(0))}this[a].set(t,this.options.transitionTime),this[l]=performance.now(),this[h]=this[u](0);const e=this[s].reduce(((t,e)=>t+e),0);let n="";if(e>=this.options.max&&this.options.valueWhenDone)n=this.options.valueWhenDone;else{let t=this.values.length>1?e:this.values[0];"%"===this.options.valueUnit&&(t/=this.options.max/100),n=`${t.toFixed(this.options.valueDecimals)}${this.options.valueUnit}`}this.options.showValue&&(this[c].textContent=n)}appendTo(t){t.appendChild(this.node)}remove(){this.node.remove()}static get defaultOptions(){return{size:150,barsWidth:20,max:100,showValue:!0,valueDecimals:0,valueUnit:"%",valueBackground:"#333",colors:["#0484d1","#e53b44","#2ce8f4","#ffe762","#63c64d","#fb922b"],background:"rgba(0, 0, 0, .3)",transitionTime:500,valueWhenDone:null}}}f.prototype[u]=function(t){if(t>this[l]+this.options.transitionTime)return;this[h]&&cancelAnimationFrame(this[h]),this[h]=requestAnimationFrame(this[u]);let e=0;const n=this[a].map(((t,n)=>{const i=t/this.options.max*100;if(i<.1)return null;const r=`${o=this.options.colors,s=n,o[s%o.length]} ${e}% ${e+i}%`;var o,s;return e+=i+.1,r})).filter((t=>t));e<100&&n.push(`transparent ${e}% 100%`),this.node.style.background=`conic-gradient(${n.join(",")}) ${this.options.background}`}},function(t,e,n){var i=n(3),r=n(4);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var s=(i(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});t.exports=s},function(t,e,n){"use strict";var i,o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function a(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function c(t,e){for(var n={},i=[],r=0;r<t.length;r++){var o=t[r],c=e.base?o[0]+e.base:o[0],u=n[c]||0,l="".concat(c," ").concat(u);n[c]=u+1;var h=a(l),f={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(s[h].references++,s[h].updater(f)):s.push({identifier:l,updater:v(f,e),references:1}),i.push(l)}return i}function u(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var s=o(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var l,h=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function f(t,e,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=h(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function p(t,e,n){var i=n.css,r=n.media,o=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var d=null,m=0;function v(t,e){var n,i,r;if(e.singleton){var o=m++;n=d||(d=u(e)),i=f.bind(null,n,o,!1),r=f.bind(null,n,o,!0)}else n=u(e),i=p.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var r=a(n[i]);s[r].references--}for(var o=c(t,e),u=0;u<n.length;u++){var l=a(n[u]);0===s[l].references&&(s[l].updater(),s.splice(l,1))}n=o}}}},function(t,e,n){(e=n(5)(!1)).push([t.i,".circular-progress-bar {\n  display: inline-block;\n  border-radius: 50%;\n}\n.circular-progress-bar .circular-progress-bar_value {\n  position: relative;\n  display: inline-block;\n  border-radius: 50%;\n}\n.circular-progress-bar .circular-progress-bar_value .circular-progress-bar_value_text {\n  text-align: center;\n  font-family: monospace;\n  color: #fff;\n  mix-blend-mode: difference;\n}\n",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var s,a,c,n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([r]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);i&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}}]).default;class GriffithCardsView extends cc_View{constructor(model,controller){super(model,controller),this.currentCollection=this.model.getCurrentCollection()}display(){DEBUG&&console.log("-------------- GriffithCardsView.display()");let div=document.getElementById("cc-canvas-collections"),message=document.createElement("div");message.className="cc-message",message.innerHTML="";document.body.insertAdjacentHTML("afterbegin",'<script src="https://unpkg.com/circular-progress-bar@2.1.0/public/circular-progress-bar.min.js"><\/script>');const currentCollection=this.model.getCurrentCollection(),cardsHtml=this.generateHTML(currentCollection);div.insertAdjacentElement("beforeend",message),div.insertAdjacentHTML("beforeend",cardsHtml),this.stopCardDescriptionPropagation(),this.makeCardsClickable()}generateHTML(collectionName,variety=""){let cardsHtml=this.generateCards(collectionName);return"claytons"===variety&&(cardsHtml=this.convertToClaytons(cardsHtml)),cardsHtml}generateCards(collectionName){DEBUG&&console.log("-------------- griffithCardsView.generateCards()");let cardCollection=document.createElement("div");cardCollection.id="cc-card-interface",cardCollection.classList.add("cc-representation");cardCollection.innerHTML="\n\t\t<style>\n\t\t#cc-canvas-collections{\n\t\t\toverflow:hidden;\n\t\t}\n\n\t\t#cc-card-interface { \n\t\t\tmargin-top: 0.5em !important;\n\t\t\tflex-wrap: wrap;\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\t.cc-clickable-card, .cc-coming-soon-card {\n\t\t\tpadding: 0.75rem;\n\t\t\tflex-direction: column;\n\t\t\tdisplay: flex;\n\t\t\twidth: 30%;\n\t\t}\n\n\t\t@media (max-width:640px) {\n\t\t\t.cc-clickable-card,  .cc-coming-soon-card {\n\t\t\t\twidth: 50%\n\t\t\t}\n\t\t}\n\n\t\t@media (max-width:480px) { \n\t\t    .cc-coming-soon-card, .cc-clickable-card {\n\t\t\t\twidth:100%;\n\t\t\t}\n\t\t}\n\n\t\t.cc-clickable-card:hover {\n\t\t\tcursor: pointer;\n\t\t\topacity: 0.8;\n\t\t}\n\n\t\t.cc-card {\n\t\t\tbox-shadow: 0 10px 15px -3px rgb(0 0 0/ 0.1);\n\t\t\tbackground-color: #fff;\n\t\t\tborder-radius: 1em;\n\t\t}\n\n\t\t.cc-card-flex {\n\t\t\toverflow: hidden;\n\t\t\tflex-direction: column;\n\t\t\tflex: 1 1 0%;\n\t\t\tdisplay: flex;\n\t\t\tposition:relative;\n\t\t\tborder-radius: 1em;\n\t\t}\n\n\t\t.cc-card:hover{\n\t\t\tbackground-color: #f5f5f5;\n\t\t\tbox-shadow: none;\n\t\t}\n\n\t\t.cc-card-image {\n\t\t\theight: 10rem;\n\t\t\twidth: 100%;\n\t\t}\n\n\t\t.cc-object-fit-old-kludge {\n\t\t\tbackground-size: contain !important; \n\t\t\tbackground-repeat: no-repeat; \n\t\t\tbackground-position: center;\n\t\t}\n\n\t\t.cc-object-fit-cover {\n\t\t\tobject-fit: cover;\n\t\t}\n\n\t\t.cc-object-fit-contain {\n\t\t\tobject-fit: contain;\n\t\t}\n\n\t\t.cc-object-fit-fill {\n\t\t\tobject-fit: fill;\n\t\t}\n\n\t\t.cc-object-fit-scale-down {\n\t\t\tobject-fit: scale-down;\n\t\t}\n\n\t\t.cc-object-fit-none {\n\t\t\tobject-fit: none;\n\t\t}\n\n\t\t.cc-card-content-height {\n\t\t\theight: 12rem;\n\t\t\toverflow: auto;\n\t\t\tborder-bottom-left-radius: 0.5rem;\n\t\t\tborder-bottom-right-radius: 0.5rem;\n\t\t}\n\n\t\t.cc-card-content {\n\t\t\tpadding: 0.5rem;\n\t\t\tflex: 1 1 0%;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t}\n\n\t\t.cc-card-content:hover {\n\t\t\tcursor: pointer;\n\t\t}\n\n\t\t.cc-card-description {\n\t\t\tfont-size: 0.75rem;\n\t\t}\n\n\t    .cc-card-description a {\n\t\t\ttext-decoration: underline;\n\t\t\tflex: 1 1 0%;\n\t\t\tmargin-bottom: 1rem;\n\t\t}\n\n\t\t.cc-progress {\n\t\t\tposition: absolute;\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t\tpadding: 0.5em;\n\t\t}\n\n\t\t.cc-card-title {\n\t\t\tfont-size: 1rem;\n\t\t\tfont-weight: bold;\n\t\t}\n\n\t\t.cc-card-label {\n\t\t\tfont-size: 0.9rem;\n\t\t\tmargin-bottom: 1rem;\n\t\t}\n\n\t\t.cc-card-engage {\n\t\t\tpadding: 1rem;\n\t\t\tpadding-top: 1.5rem;\n\t\t}\n\n\t\t.cc-card-engage-button {\n\t\t\tfloat: right;\n\t\t\tpadding-top: 0.5rem;\n\t\t\tpadding-bottom: 0.5rem;\n\t\t\tpadding-left: 1rem;\n\t\t\tpadding-right: 1rem;\n\t\t\tcolor: rgba(30,58,138,1);\n\t\t\tborder-style: solid;\n\t\t\tborder-width: 1px;\n\t\t\tborder-radius: 0.25rem;\n\t\t\tborder-color: rgba(30,58,138,1);\n\t\t}\n\n\t\t.cc-card-engage-button:hover {\n\t\t\tbackground-color: rgba(30,58,138,1);\n\t\t\tcolor: white;\n\t\t\ttext-decoration: none !important;\n\t\t\tborder: transparent;\n\t\t\tborder-radius: 0.25rem;\n\t\t}\n\n\t\t.cc-card-date {\n\t\t\ttext-align: center;\n\t\t\tbackground-color: #f5f5f5;\n\t\t\tborder-radius: 0.25rem;\n\t\t\toverflow: hidden;\n\t\t\twidth: 5rem;\n\t\t\tdisplay:block;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tright: 0;\n\t\t}\n\n\t\t.cc-card-date-label { \n\t\t\tcolor: white;\n\t\t\tfont-size: 0.75rem;\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t\tbackground-color: black;\n\t\t\tborder-color: black;\n\t\t\tborder-left-width: 1px;\n\t\t\tborder-right-width: 1px;\n\t\t\tborder-top-width: 1px;\n\t\t}\n\n\t\t.cc-card-hide {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.cc-card-date-week {\n\t\t\tcolor: black;\n\t\t\tbackground-color: #fff9c2;\n\t\t\tfont-size: 0.75rem;\n\t\t\tpadding-top: 0.15rem;\n\t\t}\n\n\t\t.cc-card-date-time {\n\t\t\tfont-size: 0.75rem;\n\t\t\tcolor: black;\n\t\t\tbackground-color: #fff382;\t\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t}\n\n\t\t.cc-card-date-dual-time {\n\t\t\tdisplay: flex;\n\t\t\tfont-size: 0.7rem;\n\t\t\tcolor: black;\n\t\t\tbackground-color: #fff382;\t\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t}\n\n\n\t\t.cc-card-date-month {\n\t\t\tcolor: white;\n\t\t\tbackground-color: red;\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t\tborder-color: black;\n\t\t\tborder-top-width: 1px;\n\t\t\tfont-size: 0.9rem;\n\t\t\tline-height: 1rem;\n\t\t}\n\n\t\t.cc-card-date-dual-month {\n\t\t\ttext-align:center;\n\t\t\talign-items: stretch;\n\t\t\tdisplay: flex;\n\t\t\tcolor: white;\n\t\t\tbackground-color: red;\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t\tborder-color: black;\n\t\t\tborder-top-width: 1px;\n\t\t}\n\n\t\t.cc-card-date-month-from {\n\t\t\twidth:50%;\n\t\t}\n\t\t.cc-card-date-month-to {\n\t\t\twidth:50%;\n\t\t}\n\n\t\t.cc-card-date-date {\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t\tborder-left-width: 1px;\n\t\t\tborder-bottom-right-radius: 0.25rem;\n\t\t\tborder-bottom-left-radius: 0.25rem;\n\t\t\tborder-color: black;\n\t\t\tfont-size: 0.9rem;\n\t\t\tfont-weight: bold;\n\t\t\tline-height: 1rem;\n\t\t}\n\n\t\t.cc-card-date-dual-date {\n\t\t\ttext-align:center;\n\t\t\tpadding-top: 0.25rem;\n\t\t\talign-items: stretch;\n\t\t\tdisplay: flex;\n\t\t\tborder-left-width: 1px;\n\t\t\tborder-right-width: 1px;\n\t\t\tborder-bottom-right-radius: 0.25rem;\n\t\t\tborder-bottom-left-radius: 0.25rem;\n\t\t\tborder-color: black;\n\t\t}\n\n\t\t.cc-card-date-date-from {\n\t\t\twidth:50%;\n\t\t}\n\n\t\t.cc-card-date-date-to {\n\t\t\twidth:50%;\n\t\t}\n\n\t\t.cc-card-date-time-from {\n\t\t\twidth: 50%;\n\t\t}\n\t\t.cc-card-date-time-to {\n\t\t\twidth: 50%;\n\t\t}\n\n\t\t.cc-card-date-day {\n\t\t\tfont-size: 0.7rem;\n\t\t}\n\n\t\t.cc-card-date-day-from {\n\t\t\twidth: 50%;\n\t\t}\n\t\t.cc-card-date-day-to {\n\t\t\twidth: 50%;\n\t\t}\n\n\t\t.cc-card-date-dual-day {\n\t\t\tdisplay:flex;\n\t\t\tfont-size: 0.7rem;\n\t\t}\n\n\t\t.cc-progress {\n\t\t\tfloat: right;\n\t\t}\n\n\t\t.cc-card-published {\n\t\t\tbackground-color: red;\n\t\t\tcolor: white;\n\t\t\tfont-size: x-small;\n\t\t\tfont-weight: bold;\n\t\t\tpadding-top: 0.25rem;\n\t\t\tpadding-bottom: 0.25rem;\n\t\t\ttext-align: center;\n\t\t\twidth: 100%;\n\t\t}\n\n\t\t.cc-coming-soon-message {\n\t\t\tfont-size: 0.75rem;\n\t\t\tpadding: .5em;\n            background-color: #feee88;\n\t\t}\n\n\t\t.gu-engage {\n\t\t\ttext-decoration: none;\n\t\t}\n\t\t</style>";const modulesCollections=this.model.getModulesCollections();for(let module of modulesCollections){if(DEBUG&&console.log(module),module.collection!==collectionName)continue;const card=this.generateCard(module);cardCollection.insertAdjacentElement("beforeend",card)}cardCollection=this.addComingSoonCards(cardCollection);return cardCollection.outerHTML}addComingSoonCards(cardCollection){const collectionsModules=this.model.getCollectionsModules(this.currentCollection);if(!collectionsModules)return cardCollection;if(this.model.getModulesCollections().filter((module=>module.collection===this.model.getCurrentCollection())).length===collectionsModules.length)return cardCollection;const comingSoonModules=collectionsModules.filter((module=>module.comingSoon));for(let module of comingSoonModules){const card=this.generateCard(module,!1),order=module.comingSoon.order-1,cards=cardCollection.querySelectorAll(".cc-clickable-card");cardCollection.insertBefore(card,cards[order])}return cardCollection}generateCard(module,published=!0){const moduleName=this.model.deLabelModuleName(module),LINK_ITEM=this.generateCardLinkItem(module),PUBLISHED=this.generateCardPublished(module);let DATE_WIDGET="";module.date&&(module.date.week||module.date.month&&module.date.date)&&(DATE_WIDGET=this.generateCardDate(module.date));let IMAGE_IFRAME=this.generateBanner(module);const description=module.description;let COMING_SOON=this.generateComingSoon(module);let CARD_LABEL="";module.label&&(CARD_LABEL=module.label),module.actualNum&&(CARD_LABEL+=` ${module.actualNum}`," "===CARD_LABEL.charAt(0)&&(CARD_LABEL=CARD_LABEL.substring(1)));const cardHtml=`\n    <div id="cc_module_${module.id}" class="cc-card">\n\t  <div class="cc-card-flex">\n\t      <a href="#module_${module.id}" class="cc-card-link"></a>\n\t\t  ${IMAGE_IFRAME}\n      \t${DATE_WIDGET}\n      \t${COMING_SOON}\n\t \t${PUBLISHED}\n\t  <div class="cc-card-content-height">\n      <div class="cc-card-content">\n\t\t<div class="cc-card-label">\n\t    \t<span class="cc-card-label"> ${CARD_LABEL} </span>\n\t    \t<h3 class="cc-card-title">${moduleName}</h3>\n\t\t</div>\n      \t<div class="cc-card-description">\n\t  \t\t${description}\n\t\t</div>\n\t\t</div> \x3c!-- cc-card-content-height --\x3e\n\t  </div> \n\t \n\t ${LINK_ITEM}\n\t \n\t \n\t  \n\t <div class="cc-progress"></div>\n      </div>\n    </div>\n    `;let wrapper=document.createElement("div");if(published)wrapper.classList.add("cc-clickable-card"),wrapper.innerHTML=cardHtml;else{wrapper.classList.add("cc-coming-soon-card"),wrapper.innerHTML=cardHtml,wrapper.querySelector(".cc-card-link").remove();const button=wrapper.querySelector(".cc-card-engage-button");button&&button.remove()}const progress=this.getCardProgressElement(module);if(progress){const progressDiv=wrapper.querySelector(".cc-progress");progressDiv&&progress.appendTo(progressDiv)}return wrapper.querySelector(".cc-card-published")&&wrapper.classList.add("unpublished"),wrapper}generateBanner(module){return module.hasOwnProperty("banner")||(module.banner="image"),"colour"===module.banner?this.generateBannerColour(module):"iframe"===module.banner?this.generateBannerIframe(module):this.generateCardImage(module)}generateBannerIframe(module){if(module.hasOwnProperty("iframe")&&""!==module.iframe){return module.iframe.match(/<iframe.*src="(.*)".*<\/iframe>/)?module.iframe:'<div class="cc-banner-colour" style="background-color:#ffffff;width:100%;height:10rem;">\n\t\t\t   <p>Iframe doesn\'t match expected iframe HTML format.</p></div>'}return'<div class="cc-banner-colour" style="background-color:#ffffff;width:100%;height:10rem;">(<em>No iframe specified</em>)</div>'}generateBannerColour(module){let bgColour="#ffffff";return module.hasOwnProperty("bannerColour")&&(bgColour=module.bannerColour),`<div class="cc-banner-colour"style="background-color:${bgColour};width:100%;height:10rem;">&nbsp;</div>`}generateCardImage(module){if(module.image.match(/<iframe.*src="(.*)".*<\/iframe>/))return module.image;const imageUrl=this.generateCardImageUrl(module);return`<img class="cc-card-image ${this.generateCardImageSize(module)}" src="${imageUrl}" \n\t\t \t\t\t\talt="Image representing '${module.name.replace(/(["'])/g,"\\$1")}'"> `}generateComingSoon(module){if(!module.comingSoon)return"";let date=this.convertUniDateToReal(module.comingSoon.date);return`\n\t\t<div class="cc-coming-soon-message">\n\t\t  <span>🚧</span>\n\t\t  <span>${`Available ${date.MONTH} ${date.DATE}`}</span>\n\t\t</div>\n\t\t`}generateCardDate(dateJson){return this.model.addCalendarDate(dateJson),this.convertDateToHtml(dateJson)}convertDateToHtml(date){const fields=["day","week","time"];let singleDate="";for(let field of fields)date.hasOwnProperty(field)&&(singleDate=`${singleDate}${date[field]}`);let extraDateLabelClass="";""===date.label&&(extraDateLabelClass=" cc-card-hide");const day=date.day||"Monday",month=date.month.substring(0,3);let time="";if(date.time&&(time=this.model.convertFrom24To12Format(date.time)),date.hasOwnProperty("to")){let dualDate="";for(let field of fields)date.to.hasOwnProperty(field)&&(dualDate=`${dualDate}${date.to[field]}`);if(""!==dualDate)return""===singleDate?"":this.generateDualDate(date)}if(""===singleDate)return"";const singleDateHtml=`\n\t\t<div class="cc-card-date">\n\t\t  <div class="cc-card-date-label${extraDateLabelClass}">\n             ${date.label}\n          </div>\n\t\t  <div class="cc-card-date-week">\n          \tWeek ${date.week}\n\t\t  </div>\n\t\t  <div class="cc-card-date-time">\n          ${time}\n\t\t  </div>\n\t\t  <div class="cc-card-date-day">\n\t\t    ${day}\n\t\t  </div>\n\t\t  <div class="cc-card-date-month">\n      \t     ${month}\n          </div>\n\t\t  <div class="cc-card-date-date">\n      \t     ${date.date}\n          </div>\n        </div>\n\t\t`;let element=(new DOMParser).parseFromString(singleDateHtml,"text/html").body.firstChild;return""===time&&element.removeChild(element.querySelector(".cc-card-date-time")),""===date.week&&element.removeChild(element.querySelector(".cc-card-date-week")),element.outerHTML}generateDualDate(date){let showDate={fromDay:"",toDay:"",fromDate:"",toDate:"",fromMonth:"",toMonth:"",fromTime:"",toTime:"",week:""};date.hasOwnProperty("week")&&(showDate.week=`${date.week}`),date.hasOwnProperty("day")&&(showDate.fromDay=date.day.substring(0,3)),date.hasOwnProperty("date")&&(showDate.fromDate=date.date),date.hasOwnProperty("month")&&(showDate.fromMonth=date.month.substring(0,3)),date.hasOwnProperty("time")&&(showDate.fromTime=this.model.convertFrom24To12Format(date.time)),date.hasOwnProperty("to")&&(date.to.hasOwnProperty("date")&&(showDate.toDate=date.to.date),date.to.hasOwnProperty("week")&&(showDate.week=`${showDate.week} - ${date.to.week}`),date.to.hasOwnProperty("day")&&(showDate.toDay=date.to.day.substring(0,3)||"Mon"),date.to.hasOwnProperty("month")&&(showDate.toMonth=date.to.month.substring(0,3)),date.to.hasOwnProperty("time")&&(showDate.toTime=this.model.convertFrom24To12Format(date.to.time)));const dualDateHtml=`\n\t\t<div class="cc-card-date">\n\t\t  <div class="cc-card-date-label">\n             ${date.label}\n          </div>\n\t\t  <div class="cc-card-date-week">\n          \tWeek ${showDate.week}\n\t\t  </div>\n\t\t  <div class="cc-card-date-dual-time">\n\t\t    <div class="cc-card-date-time-from">${showDate.fromTime}</div>\n            <div class="cc-card-date-time-to">${showDate.toTime}</div>\n\t\t  </div>\n\t\t  <div class="cc-card-date-dual-day">\n\t\t  \t<div class="cc-card-date-day-from">${showDate.fromDay}</div>\n\t\t\t<div class="cc-card-date-day-to">${showDate.toDay}</div>\n\t\t  </div> \n\t\t  <div class="cc-card-date-dual-month">\n\t\t     <div class="cc-card-date-month-from">${showDate.fromMonth}</div>\n\t\t\t <div class="cc-card-date-month-to">${showDate.toMonth}</div>\t\n          </div>\n\t\t  <div class="cc-card-date-dual-date">\n\t\t     <div class="cc-card-date-date-from">${showDate.fromDate}</div>\n\t\t     <div class="cc-card-date-date-to">${showDate.toDate}</div>\n          </div>\n        </div>\n`;let element=(new DOMParser).parseFromString(dualDateHtml,"text/html").body.firstChild;return""===date.label&&element.removeChild(element.querySelector(".cc-card-date-label")),""===showDate.toTime&&""===showDate.fromTime&&element.removeChild(element.querySelector(".cc-card-date-dual-time")),""===showDate.toWeek&&""===showdate.fromWeek&&element.removeChild(element.querySelector(".cc-card-date-dual-week")),element.outerHTML}generateCardCompletion(module){DEBUG&&console.log("----------- griffithCardsView.generateCardCompletion()");const colour={Completed:"bg-green-500","In Progress":"bg-yellow-500",Locked:"bg-red-500"};if(void 0===module.cc_itemsCompleted)return"";let completionStatus="In Progress";if(module.cc_itemsCompleted.numCompleted===module.cc_itemsCompleted.numRequired&&(completionStatus="Completed"),!(completionStatus in colour))return"";const length=completionStatus.length;return`\n      <div  class="${colour[completionStatus]} text-xs rounded-full py-1 text-center font-bold"\n\t    style="width:${length}em" >\n\t<div class="">${completionStatus}</div>\n      </div>\n\t    `}getCardProgressElement(module){if(void 0===module.cc_itemsCompleted)return;const percentComplete=100*module.cc_itemsCompleted.numCompleted/module.cc_itemsCompleted.numRequired;let valueBackground="#ccc";percentComplete>=100?valueBackground="rgb(16,185,129)":percentComplete<50&&(valueBackground="rgb(245,158,11)");return new CircularProgressBar(percentComplete,{size:50,background:"#eee",valueBackground:valueBackground,colors:["#0484d1","#e53b44","#2ce8f4","#ffe762","#63c64d","#fb922b"]})}generateCardImageUrl(module){let imageUrl="https://www.signfix.com.au/wp-content/uploads/2017/09/placeholder-600x400.png";return"image"in module&&""!==module.image&&(imageUrl=module.image),imageUrl}generateCardEngage(module){let engage="Engage";return"engage"in module&&(engage=module.engage),engage}generateCardImageSize(module){let imageSize="";const allowedObjectFit=["contain","cover","scale-down","fill"];return"imageSize"in module&&""!==module.imageSize&&("bg-contain"===module.imageSize?imageSize="cc-object-fit-old-kludge":allowedObjectFit.includes(module.imageSize)&&(imageSize=`cc-object-fit-${module.imageSize}`)),imageSize}generateCardLinkItem(module){const engage=this.generateCardEngage(module);let LINK_ITEM=`\n\x3c!--\t    <p>&nbsp;<br /> &nbsp;</p> --\x3e\n\t\t<div class="cc-card-engage">\n\t\t\t <div class="cc-card-engage-button">\n\t       \t\t<a href="#module_${module.id}" class="gu-engage">\n\t\t\t   ${engage}\n\t\t\t </a>\n\t         </div>\n\t    </div>\n\t    `;return"noEngage"in module&&module.noEngage&&(LINK_ITEM="\n            "),LINK_ITEM}generateCardPublished(module){if(module.published||void 0===module.published)return"";return'\n    <span class="cc-card-published">\n\t    Unpublished\n    </span>\n\t    '}stopCardDescriptionPropagation(){let links=document.querySelectorAll(".carddescription a:not(.gu-engage)");for(let i=0;i<links.length;i++)links[i].addEventListener("click",(function(e){e.stopPropagation()}))}makeCardsClickable(){let cards=document.getElementsByClassName("cc-clickable-card");for(let i=0;i<cards.length;i++){cards[i].addEventListener("click",(function(event){let link=this.querySelector(".cc-card-link");null!==link&&link.click()}))}}convertToClaytons(html){DEBUG&&console.log("-------------- GriffithCards::converToClaytons()");let doc=(new DOMParser).parseFromString(html,"text/html"),div=doc.getElementById("cc-card-interface");if(!div)return alert("GriffithCards::convertToClaytons() - div#cc-card-interface not found"),html;let h3s=div.querySelectorAll("h3.cc-card-title");for(let i=0;i<h3s.length;i++){let h3=h3s[i];h3.innerHTML="<strong>"+h3.innerHTML+"</strong>"}let progresses=div.querySelectorAll(".cc-progress");for(let i=0;i<progresses.length;i++){progresses[i].remove()}let currentUrl=window.location.href;currentUrl=currentUrl.split("#")[0],-1===currentUrl.indexOf("modules")&&(currentUrl+="/modules");let links=div.querySelectorAll("a.cc-card-link");for(let i=0;i<links.length;i++){let link=links[i];link.href=currentUrl+link.getAttribute("href")}let cardLinks=[];links=div.querySelectorAll("a.gu-engage");for(let i=0;i<links.length;i++){let link=links[i];link.href=currentUrl+link.getAttribute("href"),cardLinks[i]=link.href}let images=div.querySelectorAll("img.cc-card-image");for(let i=0;i<images.length;i++){let image=images[i],link=doc.createElement("a");link.classList.add("cc-card-link-image"),link.href=currentUrl,link.innerHTML=image.outerHTML,image.parentNode.replaceChild(link,image)}let titles=div.querySelectorAll("h3.cc-card-title");for(let i=0;i<titles.length;i++){let title=titles[i],link=doc.createElement("a");link.classList.add("cc-card-link-title"),link.href=cardLinks[i],link.innerHTML=title.innerHTML,title.innerHTML=link.outerHTML}let cards=div.querySelectorAll("div.cc-card-flex");for(let i=0;i<cards.length;i++){let card=cards[i];card.style.borderStyle="outset",card.style.borderRadius="1em"}let unpublisheds=div.querySelectorAll(".unpublished");for(let i=0;i<unpublisheds.length;i++){let unpublished=unpublisheds[i];if(unpublished.querySelector(".cc-coming-soon-message")){let span=unpublished.querySelector(".cc-card-published");span&&span.remove();let button=unpublished.querySelector(".cc-card-engage-button");button&&(button.style.display="none");let link=unpublished.querySelector(".cc-card-link-title");link&&link.replaceWith(...link.childNodes),link=unpublished.querySelector(".cc-card-link-image"),link&&link.replaceWith(...link.childNodes)}else unpublished.remove()}let newHtml=div.outerHTML;return juice(newHtml)}}class CanvasPageView extends cc_View{constructor(model,controller){super(model,controller),this.currentCollection=this.model.getCurrentCollection()}display(){DEBUG&&console.log("-------------- TableView.display()"),this.pageName=this.model.getCurrentCollectionPageName(),this.findPage()}showPage(page){const content=page.body;let div=document.getElementById("cc-canvas-collections"),message=document.createElement("div");message.className="cc-page-content",message.innerHTML=content,div.insertAdjacentElement("beforeend",message)}findPage(){if(!this.pageName)throw new Error("CanvasPage: missing page name");let callUrl=`/api/v1/courses/${this.controller.courseId}/pages?`+new URLSearchParams({search_term:this.pageName});DEBUG&&console.log(`CanvasPage: findPage: callUrl = ${callUrl}`);fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.controller.csrf}}).then(this.status).then((response=>response.json())).then((json=>{if(0===json.length)DEBUG&&console.log("CanvasPage: findConfigPage: no config page 'Canvas Collections Configuration' found");else if(1===json.length)this.pageObject=json[0],this.getPageBody();else{const error=`CanvasPage: findConfigPage: more than one (${json.length}) config page found`;DEBUG&&console.log(error)}})).catch((error=>{DEBUG&&console.log(`CanvasPage: findConfigPage: error = ${error}`)}),!1)}getPageBody(){let callUrl=`/api/v1/courses/${this.controller.courseId}/pages/${this.pageObject.page_id}`;DEBUG&&console.log(`CanvasPage: requestConfigPageContents: callUrl = ${callUrl}`),fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.controller.csrf}}).then(this.status).then((response=>response.json())).then((json=>{DEBUG&&console.log(`CanvasPage: requestConfigPageContents: json = ${JSON.stringify(json)}`),this.pageObject=json,this.showPage(json)})).catch((error=>{console.log("CanvasPage: requestConfig: error = "),console.log(error)}),!1)}}const VIEWS={TableView:TableView,CanvasPageView:CanvasPageView,AssessmentTableView:AssessmentTableView,CollectionOnlyView:CollectionOnlyView,GriffithCardsView:GriffithCardsView};class CollectionsViewFactory{static createView(viewType,model,controller){"View"!==viewType.endsWith(-4)&&(viewType+="View");const viewCreator=VIEWS[viewType];return viewCreator?new viewCreator(model,controller):null}}class CollectionsView extends cc_View{constructor(model,controller){super(model,controller),this.navView=new NavView(model,controller);model.getCurrentCollectionRepresentation();const collections=model.getCollections();this.representations={};for(let collection of collections){const representation=model.getCollectionRepresentation(collection);this.representations[collection]=CollectionsViewFactory.createView(representation,model,controller)}}display(){DEBUG&&console.log("-------------- cc_CollectionsView.display()"),this.removeCanvasCollectionsDiv(),this.addCanvasCollectionsDiv(),this.navView.display(),this.addIncludePage(),this.updateCurrentRepresentation()}generateHTML(collectionName,variety="",navOption="2"){if(!this.representations[collectionName])return;if("function"!=typeof this.representations[collectionName].generateHTML)return void alert(`generateHTML not defined for ${collectionName} representation`);let html=this.representations[collectionName].generateHTML(collectionName,variety);return navOption&&"2"===navOption&&(html=`${this.navView.generateHTML(collectionName,navOption)}${html}`),html}addIncludePage(){const includePageDiv=document.querySelector("div#cc-include-page");includePageDiv&&includePageDiv.remove();let ccIncludePage=document.createElement("div");ccIncludePage.id="cc-include-page";let ccNav=document.querySelector("div.cc-nav");ccNav&&ccNav.insertAdjacentElement("afterend",ccIncludePage);const includePage=this.model.getCurrentCollectionIncludePage();includePage&&this.findPage(includePage)}async findPage(pageName){let callUrl=`/api/v1/courses/${this.controller.parentController.courseId}/pages?`+new URLSearchParams({search_term:pageName});DEBUG&&console.log(`CollectionsView: findPage: callUrl = ${callUrl}`);const response=await fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.controller.csrf}});if(!response.ok)throw new Error(`CollectionsView: findPage: error ${response.status} ${response.statusText}`);const data=await response.json();0===data.length&&DEBUG&&console.log(`CollectionsView: findPage no page found for ${pageName}`),this.addPageContent(data[0]),data.length>1&&DEBUG&&console.log(`CollectionsView: findPage multiple pages found for ${pageName}`)}async addPageContent(pageObject){let callUrl=`/api/v1/courses/${this.controller.parentController.courseId}/pages/${pageObject.page_id}`;DEBUG&&console.log(`CanvasPage: requestConfigPageContents: callUrl = ${callUrl}`);const response=await fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.controller.csrf}});if(!response.ok)return void(DEBUG&&console.log("CanvasPage: requestConfigPageContents: response not ok"));const content=(await response.json()).body;let div=document.querySelector("div#cc-include-page");div&&(div.innerHTML=content)}updateCurrentRepresentation(justRepresentation=!1){const currentCollection=this.model.getCurrentCollection(),representation=this.model.getCollectionRepresentation(currentCollection);if(""===currentCollection||!representation)return;let ccRepresentation=document.querySelector("div.cc-representation");ccRepresentation&&ccRepresentation.remove(),this.representations[currentCollection]=CollectionsViewFactory.createView(representation,this.model,controller),this.representations[currentCollection].display(),justRepresentation||this.showCanvasModules()}showCanvasModules(){const modulesCollections=this.model.getModulesCollections(),currentCollection=this.model.getCurrentCollection(),editMode=this.model.getEditMode();for(let module of modulesCollections)if(module.collection&&""!==module.collection)if(module.collection!==currentCollection){const contextModule=document.querySelector(`div.context_module[data-module-id="${module.id}"]`);contextModule&&(contextModule.style.display="none")}else{const contextModule=document.querySelector(`div.context_module[data-module-id="${module.id}"]`);contextModule&&(contextModule.style.display="block")}else if(!editMode){const contextModule=document.querySelector(`div.context_module[data-module-id="${module.id}"]`);contextModule&&(contextModule.style.display="none")}}addCanvasCollectionsDiv(){let ccCanvasCollections=document.createElement("div");ccCanvasCollections.id="cc-canvas-collections";let canvasContent=document.getElementById("context_modules");canvasContent.insertBefore(ccCanvasCollections,canvasContent.firstChild)}removeCanvasCollectionsDiv(){let canvasCollections=document.getElementById("cc-canvas-collections");canvasCollections&&canvasCollections.parentNode.removeChild(canvasCollections)}}class cc_CollectionsController{constructor(controller){DEBUG&&console.log("-------------- cc_CollectionsController.constructor()"),this.parentController=controller,this.model=new CollectionsModel(this),this.view=new CollectionsView(this.model,this),this.view.display()}navigateCollections(event){DEBUG&&console.log("-------------- cc_CollectionsController.navigateCollections()"),DEBUG&&console.log(event),DEBUG&&console.log(`currentCollection: ${this.model.getCurrentCollection()}`),DEBUG&&console.log(`event innerText ${event.target.innerText}`);let newCollection=event.target.innerText;newCollection=newCollection.trim(),newCollection!==this.model.getCurrentCollection()&&(this.parentController.setLastCollectionViewed(newCollection),this.model.setCurrentCollection(newCollection),this.view.display())}}class juiceController{constructor(controller){DEBUG&&console.log("-------------- juiceController.constructor()"),this.parentController=controller,this.display()}display(){if(DEBUG&&console.log("-------------- juiceController.display()"),document.getElementById("cc_2_clipboard"))return;let addModuleButton=document.querySelector("button.add_module_link");if(addModuleButton){let button=document.querySelector("button.cc_clipboard");button||(button=document.createElement("button"),button.style="margin-left: 0.2em",button.classList.add("btn"),button.id="cc_2_clipboard",button.onclick=event=>this.juiceIt(event),button.innerHTML="Collections 2 Clipboard",addModuleButton.parentNode.insertBefore(button,addModuleButton.nextSibling))}}juiceIt(event){DEBUG&&console.log("-------------- juiceController.juiceIT()");let div=document.getElementById("cc-canvas-collections");if(div){div=div.cloneNode(!0);let nav=div.querySelector(".cc-nav");nav&&nav.remove();let message=div.querySelector(".cc-message");message&&message.remove();let h3s=div.querySelectorAll("h3.cc-card-title");for(let i=0;i<h3s.length;i++){let h3=h3s[i];h3.innerHTML="<strong>"+h3.innerHTML+"</strong>"}let progresses=div.querySelectorAll(".cc-progress");for(let i=0;i<progresses.length;i++){progresses[i].remove()}let currentUrl=window.location.href;currentUrl=currentUrl.split("#")[0],-1===currentUrl.indexOf("modules")&&(currentUrl+="/modules");let links=div.querySelectorAll("a.cc-card-link");for(let i=0;i<links.length;i++){let link=links[i];link.href=currentUrl+link.getAttribute("href")}let cardLinks=[];links=div.querySelectorAll("a.gu-engage");for(let i=0;i<links.length;i++){let link=links[i];link.href=currentUrl+link.getAttribute("href"),cardLinks[i]=link.href}let images=div.querySelectorAll("img.cc-card-image");for(let i=0;i<images.length;i++){let image=images[i],link=document.createElement("a");link.classList.add("cc-card-link-image"),link.href=currentUrl,link.innerHTML=image.outerHTML,image.parentNode.replaceChild(link,image)}let titles=div.querySelectorAll("h3.cc-card-title");for(let i=0;i<titles.length;i++){let title=titles[i],link=document.createElement("a");link.classList.add("cc-card-link-title"),link.href=cardLinks[i],link.innerHTML=title.innerHTML,title.innerHTML=link.outerHTML}let cardContents=div.querySelectorAll(".cc-card-content-height");for(let i=0;i<cardContents.length;i++){cardContents[i].style.backgroundColor="#efefef"}let cardEngages=div.querySelectorAll(".cc-card-engage");for(let i=0;i<cardEngages.length;i++){cardEngages[i].style.backgroundColor="#efefef"}let cardFlexes=div.querySelectorAll(".cc-card-flex");for(let i=0;i<cardFlexes.length;i++){cardFlexes[i].style.backgroundColor="#efefef"}let unpublisheds=div.querySelectorAll(".unpublished");for(let i=0;i<unpublisheds.length;i++){let unpublished=unpublisheds[i];if(unpublished.querySelector(".cc-coming-soon-message")){let span=unpublished.querySelector(".cc-card-published");span&&span.remove();let button=unpublished.querySelector(".cc-card-engage-button");button&&(button.style.display="none");let link=unpublished.querySelector(".cc-card-link-title");link&&link.replaceWith(...link.childNodes),link=unpublished.querySelector(".cc-card-link-image"),link&&link.replaceWith(...link.childNodes)}else unpublished.remove()}let html=div.outerHTML,juiceHTML=juice(html);navigator.clipboard&&navigator.clipboard.writeText(juiceHTML).then((()=>{alert("Canvas Collections: HTML for current representation copied to clipboard")}),(err=>{console.error("Canvas Collections: Error copying to clipboard: ",err)}))}else alert("Canvas Collections: No collections found to copy")}}const CONFIGURATION_PAGE_HTML_TEMPLATE='\n<div class="cc-config-explanation">\n<div style="float:left;padding:0.5em">\n  <img src="https://repository-images.githubusercontent.com/444951314/42343d35-e259-45ae-b74e-b9957222211f"\n      alt="canvas-collections logo" width="123" height="92" />\n</div>\n<div style="padding:0.5em">\n  <h3>Canvas Collections Configuration page</h3>\n  <p>This page is used to configure <a href="https://djplaner.github.io/canvas-collections/">Canvas Collections</a>.  \n  Avoid direct modification to this page, instead use the Canvas Collections configuration interface.  </p>\n  {{VISIBLE_TEXT}}\n </div>\n </div>\n <p style="clear:both"></p>\n<div class="cc_json" style="display:none">\n {{CONFIG}}\n </div>\n<div class="cc-card-images" id="cc-course-{{COURSE_ID}}" style="display:none">\n {{COURSE_IMAGES}}\n</div>\n',DEFAULT_CONFIGURATION_TEMPLATE={STATUS:"off",DEFAULT_ACTIVE_COLLECTION:"",COLLECTIONS:{},COLLECTIONS_ORDER:[],MODULES:{}};class cc_ConfigurationStore{constructor(controller){DEBUG&&console.log("-------------- cc_ConfigurationStore.constructor()"),this.parentController=controller,this.pageObject=null}getConfiguration(){DEBUG&&console.log("-------------- cc_ConfigurationStore.getConfiguration()"),this.requestConfigPageContents()}saveConfiguration(){this.saveConfigPage()}async requestConfigPageContents(){let callUrl=`/api/v1/courses/${this.parentController.courseId}/pages/canvas-collections-configuration`;DEBUG&&console.log(`cc_ConfigurationStore: requestConfigPageContents: callUrl = ${callUrl}`);const response=await fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.parentController.csrf}});if(!response.ok)throw 404===response.status&&this.initialiseConfigPage(),new Error(`cc_ConfigurationStore: requestConfigPageContents: error ${response.status} ${response.statusText}`);const data=await response.json();if(DEBUG&&console.log(`cc_ConfigurationStore: requestConfigPageContents: json = ${JSON.stringify(data)}`),0===data.length)throw new Error("cc_ConfigurationStore: requestConfigPageContents: no config page found");this.pageObject=data,this.parentController.published=this.pageObject.published,this.parseNewPageBody(),this.parentController.mergeModuleDetails(),this.parentController.retrieveLastCollectionViewed(),this.parentController.execute()}parseNewPageBody(){const data=this.pageObject,parsed=(new DOMParser).parseFromString(data.body,"text/html");let config=parsed.querySelector("div.cc_json");if(!config)throw new Error("cc_ConfigurationStore: requestConfigPageContents: no div.cc_json found in page");this.parentController.cc_configuration=JSON.parse(config.innerHTML),this.configConverted=this.checkConvertOldConfiguration(),DEBUG&&console.log("cc_ConfigurationStore: requestCOnfigPageContents: config"),this.parentController.ccOn="on"===this.parentController.cc_configuration.STATUS,this.parentController.cc_configuration.COLLECTIONS_ORDER||(this.parentController.cc_configuration.COLLECTIONS_ORDER=Object.keys(this.parentController.cc_configuration.COLLECTIONS));for(let key in this.parentController.cc_configuration.MODULES){const module=this.parentController.cc_configuration.MODULES[key];module.description=this.decodeHTML(module.description),module.collection=this.decodeHTML(module.collection),module.name=this.decodeHTML(module.name),module.hasOwnProperty("iframe")&&(module.iframe=this.decodeHTML(module.iframe)),module.image.startsWith("/")&&(module.image=`https://${window.location.hostname}${module.image}`)}let courseImages=parsed.querySelector("div.cc-card-images");const importConverted=this.checkConvertImport(courseImages);importConverted&&(this.configConverted=importConverted);const collections={};for(let key in this.parentController.cc_configuration.COLLECTIONS){const collection=this.parentController.cc_configuration.COLLECTIONS[key];collections[this.decodeHTML(key)]=collection}this.parentController.cc_configuration.COLLECTIONS=collections,this.parentController.cc_configuration.COLLECTIONS_ORDER=this.parentController.cc_configuration.COLLECTIONS_ORDER.map((collection=>this.decodeHTML(collection))),this.parentController.cc_configuration.DEFAULT_ACTIVE_COLLECTION=this.decodeHTML(this.parentController.cc_configuration.DEFAULT_ACTIVE_COLLECTION)}checkConvertImport(courseImages){if(courseImages&&courseImages.id){if(courseImages.id.replace("cc-course-","")===this.parentController.courseId)return!1;courseImages.querySelectorAll("img.cc-moduleImage").forEach((image=>{const moduleId=image.id.replace("cc-moduleImage-","");this.parentController.cc_configuration.MODULES[moduleId]&&(this.parentController.cc_configuration.MODULES[moduleId].image=image.src)}))}const collectionIds=Object.keys(this.parentController.cc_configuration.MODULES),canvasIds=this.parentController.moduleDetails.map((module=>module.id)),commonIds=collectionIds.filter((id=>canvasIds.includes(parseInt(id))));if(collectionIds.length===canvasIds.length&&collectionIds.length===commonIds.length)return!1;let ccModuleNames=[];for(let key in this.parentController.cc_configuration.MODULES)ccModuleNames.push(this.parentController.cc_configuration.MODULES[key].name);let moduleNames=this.parentController.moduleDetails.map((module=>module.name)),commonNames=moduleNames.filter((name=>ccModuleNames.includes(name)));if(collectionIds.length===canvasIds.length){if(0===commonIds.length&&commonNames.length===moduleNames.length&&commonNames.length===ccModuleNames.length){let nameToId={};for(let i=0;i<commonNames.length;i++){const name=commonNames[i],canvasModuleId=this.parentController.moduleDetails.find((module=>{if(module.name===name)return module.id})),ccModuleId=Object.keys(this.parentController.cc_configuration.MODULES).find((id=>{if(this.parentController.cc_configuration.MODULES[id].name===name)return id}));nameToId[name]={canvasModuleId:canvasModuleId,ccModuleId:ccModuleId}}let newModules={};for(let name in nameToId)newModules[nameToId[name].canvasModuleId.id]=this.parentController.cc_configuration.MODULES[nameToId[name].ccModuleId],newModules[nameToId[name].canvasModuleId.id].id=nameToId[name].canvasModuleId.id;this.parentController.cc_configuration.MODULES=newModules}return!0}}checkConvertOldConfiguration(){let collectionsModules=this.parentController.cc_configuration.MODULES,keys=Object.keys(collectionsModules);if(!/^\d+$/.test(keys[0])){const moduleDetailsHash={};let moduleDetails=this.parentController.moduleDetails;for(let i=0;i<moduleDetails.length;i++)moduleDetailsHash[moduleDetails[i].name]=moduleDetails[i];let new_modules={};for(let name in collectionsModules)if(moduleDetailsHash[name]){new_modules[moduleDetailsHash[name].id]=collectionsModules[name]}return this.parentController.cc_configuration.MODULES=new_modules,!0}return!1}saveConfigPage(create=!1){let callUrl=`/api/v1/courses/${this.parentController.courseId}/pages/${this.pageObject.page_id}`;DEBUG&&console.log(`cc_ConfigurationStore: saveConfigPage: callUrl = ${callUrl}`);let _body={wiki_page:{body:this.generateConfigPageContent()}};const bodyString=JSON.stringify(_body);fetch(callUrl,{method:"put",credentials:"include",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8","X-CSRF-Token":this.parentController.csrf},body:bodyString}).then(this.status).then((response=>{if(response.ok){const json=response.json();DEBUG&&console.log(`cc_ConfigurationStore: saveConfigPage: json = ${JSON.stringify(json)}`),this.parentController.completedSaveConfig()}else alert(`Problem saving config ${response.status} - `)})).catch((error=>{console.log("cc_ConfigurationStore: requestConfig: error = "),console.log(error),this.parentController.failedSaveConfig(error)}),!1)}generateConfigPageContent(){let content=CONFIGURATION_PAGE_HTML_TEMPLATE;if(this.hasOwnProperty("parentController")&&this.parentController.hasOwnProperty("cc_configuration")&&this.parentController.cc_configuration.hasOwnProperty("MODULES")){const filesUrl=`${window.location.hostname}/files/`,courseFilesUrl=`${window.location.hostname}/courses/${this.parentController.courseId}/files/`;let images="";for(let moduleId in this.parentController.cc_configuration.MODULES){const module=this.parentController.cc_configuration.MODULES[moduleId];module.image&&(module.image.startsWith("/")&&(module.image=`https://${window.location.hostname}${module.image}`),(module.image.includes(courseFilesUrl)||module.image.includes(filesUrl))&&(images+=`\n\t\t\t\t\t<img src="${module.image}" id="cc-moduleImage-${moduleId}" class="cc-moduleImage" />\n\t\t\t\t\t`))}content=content.replace("{{COURSE_IMAGES}}",images)}for(let key in this.parentController.cc_configuration.MODULES){const module=this.parentController.cc_configuration.MODULES[key];module.description=this.encodeHTML(module.description),module.collection=this.encodeHTML(module.collection),module.hasOwnProperty("iframe")&&(module.iframe=this.encodeHTML(module.iframe)),module.name=this.encodeHTML(module.name)}let safeContent=JSON.stringify(this.parentController.cc_configuration);safeContent&&(content=content.replace("{{CONFIG}}",safeContent));for(let key in this.parentController.cc_configuration.MODULES){const module=this.parentController.cc_configuration.MODULES[key];module.description=this.decodeHTML(module.description),module.collection=this.decodeHTML(module.collection),module.name=this.decodeHTML(module.name),module.hasOwnProperty("iframe")&&(module.iframe=this.decodeHTML(module.iframe))}let time=(new Date).toLocaleString();return content=content.replace("{{VISIBLE_TEXT}}",`<p>saved at ${time}</p>`),content=content.replace("{{COURSE_ID}}",this.parentController.courseId),content}async createConfigPage(){let callUrl=`/api/v1/courses/${this.parentController.courseId}/pages`;DEBUG&&console.log(`cc_ConfigurationStore: createConfigPage: callUrl = ${callUrl}`);let content=CONFIGURATION_PAGE_HTML_TEMPLATE;for(let key in this.parentController.cc_configuration.MODULES){const module=this.parentController.cc_configuration.MODULES[key];module.description=this.encodeHTML(module.description)}content=content.replace("{{CONFIG}}",JSON.stringify(this.parentController.cc_configuration));for(let key in this.parentController.cc_configuration.MODULES){const module=this.parentController.cc_configuration.MODULES[key];module.description=this.decodeHTML(module.description)}let time=(new Date).toISOString();content=content.replace("{{VISIBLE_TEXT}}",`<p> saved at ${time}</p>`);let _body={wiki_page:{body:content,title:"Canvas Collections Configuration",editing_roles:"teachers",notify_of_update:!1,published:!1,front_page:!1}};const bodyString=JSON.stringify(_body),response=await fetch(callUrl,{method:"post",credentials:"include",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8","X-CSRF-Token":this.parentController.csrf},body:bodyString});if(!response.ok)return void alert(`Problem creating config ${response.status} - `);const json=await response.json();this.pageObject=json,this.parentController.mergeModuleDetails(),this.parentController.execute()}decodeHTML(html){var txt=document.createElement("textarea");return txt.innerHTML=html,txt.value}encodeHTML(html,json=!0){let txt=document.createElement("textarea");return txt.innerHTML=html,txt.innerHTML}initialiseConfigPage(){const config=DEFAULT_CONFIGURATION_TEMPLATE;this.parentController.cc_configuration=config,this.parentController.ccOn="on"===this.parentController.cc_configuration.STATUS,this.initialiseModuleConfig(),this.createConfigPage()}initialiseModuleConfig(){if(!(this.hasOwnProperty("parentController")&&this.parentController.hasOwnProperty("moduleDetails")&&this.parentController.hasOwnProperty("cc_configuration")&&this.parentController.cc_configuration.hasOwnProperty("MODULES")))return void console.error("cc_ConfigurationStore: initialiseModuleConfig: no parentController or moduleDetails or cc config");const currentModules=this.parentController.moduleDetails;let ccModules=this.parentController.cc_configuration.MODULES,defaultCollection=this.parentController.cc_configuration.DEFAULT_ACTIVE_COLLECTION;for(let i=0;i<currentModules.length;i++){let newModule={name:currentModules[i].name,id:currentModules[i].id,collection:defaultCollection,description:"",label:"",num:"",image:""};ccModules[currentModules[i].id]=newModule}}}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const DEFAULT_PERIOD="3225",MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CALENDAR={3231:{0:{start:"2023-02-27",stop:"2023-03-03"},1:{start:"2023-03-06",stop:"2023-03-12"},2:{start:"2023-03-13",stop:"2023-03-19"},3:{start:"2023-03-20",stop:"2023-03-26"},4:{start:"2023-03-27",stop:"2023-04-09"},5:{start:"2023-04-10",stop:"2023-04-16"},6:{start:"2023-04-17",stop:"2023-04-23"},7:{start:"2023-04-24",stop:"2023-04-30"},8:{start:"2023-05-01",stop:"2023-05-07"},9:{start:"2023-05-08",stop:"2023-05-14"},10:{start:"2023-05-15",stop:"2023-05-21"},11:{start:"2023-05-22",stop:"2023-05-28"},12:{start:"2023-05-29",stop:"2023-06-04"},13:{start:"2023-06-05",stop:"2023-06-11"},14:{start:"2023-06-12",stop:"2023-06-18"},15:{start:"2023-06-19",stop:"2023-07-25"},exam:{start:"2023-06-08",stop:"2023-06-17"}},3221:{0:{start:"2022-03-07",stop:"2022-03-13"},1:{start:"2022-03-14",stop:"2022-03-20"},2:{start:"2022-03-21",stop:"2022-03-28"},3:{start:"2022-03-28",stop:"2022-04-03"},4:{start:"2022-04-04",stop:"2022-04-10"},5:{start:"2022-04-18",stop:"2022-04-24"},6:{start:"2022-04-25",stop:"2022-05-01"},7:{start:"2022-05-02",stop:"2022-05-08"},8:{start:"2022-05-09",stop:"2022-05-15"},9:{start:"2022-05-16",stop:"2022-05-22"},10:{start:"2022-05-23",stop:"2022-05-29"},11:{start:"2022-05-30",stop:"2022-06-05"},12:{start:"2022-06-06",stop:"2022-06-12"},13:{start:"2022-06-13",stop:"2022-06-19"},14:{start:"2022-06-20",stop:"2022-06-26"},15:{start:"2022-06-27",stop:"2022-07-03"},exam:{start:"2022-06-13",stop:"2022-06-25"}},2222:{0:{start:"2022-03-07",stop:"2022-03-13"},1:{start:"2022-03-14",stop:"2022-03-20"},2:{start:"2022-03-21",stop:"2022-03-28"},3:{start:"2022-03-28",stop:"2022-04-03"},4:{start:"2022-04-04",stop:"2022-04-10"},5:{start:"2022-04-18",stop:"2022-04-24"},6:{start:"2022-04-25",stop:"2022-05-01"},7:{start:"2022-05-02",stop:"2022-05-08"},8:{start:"2022-05-09",stop:"2022-05-15"},9:{start:"2022-05-16",stop:"2022-05-22"},10:{start:"2022-05-23",stop:"2022-05-29"},11:{start:"2022-05-30",stop:"2022-06-05"},12:{start:"2022-06-06",stop:"2022-06-12"},13:{start:"2022-06-13",stop:"2022-06-19"},14:{start:"2022-06-20",stop:"2022-06-26"},15:{start:"2022-06-27",stop:"2022-07-03"},exam:{start:"2022-06-13",stop:"2022-06-25"}},"3221QCM":{0:{start:"2022-02-21",stop:"2022-02-27"},1:{start:"2022-02-28",stop:"2022-03-06"},2:{start:"2022-03-07",stop:"2022-03-13"},3:{start:"2022-03-14",stop:"2022-03-20"},4:{start:"2022-03-21",stop:"2022-03-27"},5:{start:"2022-03-28",stop:"2022-04-03"},6:{start:"2022-04-04",stop:"2022-04-10"},7:{start:"2022-04-18",stop:"2022-04-24"},8:{start:"2022-04-25",stop:"2022-05-01"},9:{start:"2022-05-09",stop:"2022-05-15"},10:{start:"2022-05-16",stop:"2022-05-22"},11:{start:"2022-05-23",stop:"2022-05-29"},12:{start:"2022-05-30",stop:"2022-06-05"},13:{start:"2022-06-06",stop:"2022-06-12"},14:{start:"2022-06-13",stop:"2022-06-19"},15:{start:"2022-06-20",stop:"2022-07-26"},exam:{start:"2022-06-13",stop:"2022-06-25"}},3225:{0:{start:"2022-07-11",stop:"2022-07-17"},1:{start:"2022-07-18",stop:"2022-07-24"},2:{start:"2022-07-25",stop:"2022-07-31"},3:{start:"2022-08-01",stop:"2022-08-07"},4:{start:"2022-08-08",stop:"2022-08-14"},5:{start:"2022-08-22",stop:"2022-08-28"},6:{start:"2022-08-29",stop:"2022-09-04"},7:{start:"2022-09-05",stop:"2022-09-11"},8:{start:"2022-09-12",stop:"2022-09-18"},9:{start:"2022-09-19",stop:"2022-09-25"},10:{start:"2022-09-26",stop:"2022-10-02"},11:{start:"2022-10-03",stop:"2022-10-09"},12:{start:"2022-10-10",stop:"2022-10-16"},13:{start:"2022-10-17",stop:"2022-10-23"},14:{start:"2022-10-24",stop:"2022-10-30"},15:{start:"2022-10-31",stop:"2022-11-06"},exam:{start:"2022-10-20",stop:"2022-10-29"}},2224:{0:{start:"2022-07-11",stop:"2022-07-17"},1:{start:"2022-07-18",stop:"2022-07-24"},2:{start:"2022-07-25",stop:"2022-07-31"},3:{start:"2022-08-01",stop:"2022-08-07"},4:{start:"2022-08-08",stop:"2022-08-14"},5:{start:"2022-08-22",stop:"2022-08-28"},6:{start:"2022-08-29",stop:"2022-09-04"},7:{start:"2022-09-05",stop:"2022-09-11"},8:{start:"2022-09-12",stop:"2022-09-18"},9:{start:"2022-09-19",stop:"2022-09-25"},10:{start:"2022-09-26",stop:"2022-10-02"},11:{start:"2022-10-03",stop:"2022-10-09"},12:{start:"2022-10-10",stop:"2022-10-16"},13:{start:"2022-10-17",stop:"2022-10-23"},14:{start:"2022-10-24",stop:"2022-10-30"},15:{start:"2022-10-31",stop:"2022-11-06"},exam:{start:"2022-10-20",stop:"2022-10-29"}},"3225QCM":{0:{start:"2022-07-18",stop:"2022-07-24"},1:{start:"2022-07-25",stop:"2022-07-31"},2:{start:"2022-08-01",stop:"2022-08-07"},3:{start:"2022-08-08",stop:"2022-08-14"},4:{start:"2022-08-15",stop:"2022-08-21"},5:{start:"2022-08-22",stop:"2022-08-28"},6:{start:"2022-09-05",stop:"2022-09-11"},7:{start:"2022-09-12",stop:"2022-09-18"},8:{start:"2022-09-19",stop:"2022-09-25"},9:{start:"2022-10-03",stop:"2022-10-09"},10:{start:"2022-10-10",stop:"2022-10-16"},11:{start:"2022-10-17",stop:"2022-10-23"},12:{start:"2022-10-24",stop:"2022-10-30"},13:{start:"2022-10-31",stop:"2022-11-06"},14:{start:"2022-11-07",stop:"2022-11-13"},15:{start:"2022-11-14",stop:"2022-07-20"},exam:{start:"2022-11-07",stop:"2022-11-19"}},3228:{0:{start:"2022-10-31",stop:"2022-11-06"},1:{start:"2022-11-07",stop:"2022-11-13"},2:{start:"2022-11-14",stop:"2022-11-20"},3:{start:"2022-11-21",stop:"2022-11-27"},4:{start:"2022-11-28",stop:"2022-12-04"},5:{start:"2022-12-05",stop:"2022-12-11"},6:{start:"2022-12-12",stop:"2022-12-18"},7:{start:"2022-12-19",stop:"2022-12-25"},8:{start:"2023-01-09",stop:"2023-01-15"},9:{start:"2023-01-16",stop:"2023-01-22"},10:{start:"2023-01-23",stop:"2023-01-29"},11:{start:"2023-01-30",stop:"2023-02-05"},12:{start:"2023-02-06",stop:"2023-02-12"},13:{start:"2023-02-13",stop:"2023-02-19"},14:{start:"2023-02-20",stop:"2023-02-26"},15:{start:"2023-02-27",stop:"2023-03-05"}},2226:{0:{start:"2022-10-31",stop:"2022-11-06"},1:{start:"2022-11-07",stop:"2022-11-13"},2:{start:"2022-11-14",stop:"2022-11-20"},3:{start:"2022-11-21",stop:"2022-11-27"},4:{start:"2022-11-28",stop:"2022-12-04"},5:{start:"2022-12-05",stop:"2022-12-11"},6:{start:"2022-12-12",stop:"2022-12-18"},7:{start:"2022-12-19",stop:"2022-12-25"},8:{start:"2023-01-09",stop:"2023-01-15"},9:{start:"2023-01-16",stop:"2023-01-22"},10:{start:"2023-01-23",stop:"2023-01-29"},11:{start:"2023-01-30",stop:"2023-02-05"},12:{start:"2023-02-06",stop:"2023-02-12"},13:{start:"2023-02-13",stop:"2023-02-19"},14:{start:"2023-02-20",stop:"2023-02-26"},15:{start:"2023-02-27",stop:"2023-03-05"}},2211:{0:{start:"2021-02-22",stop:"2021-02-28"},1:{start:"2021-03-01",stop:"2021-03-07"},2:{start:"2021-03-08",stop:"2021-03-14"},3:{start:"2021-03-15",stop:"2021-03-21"},4:{start:"2021-03-22",stop:"2021-03-28"},5:{start:"2021-03-29",stop:"2021-04-04"},6:{start:"2021-04-05",stop:"2021-04-11"},7:{start:"2021-04-12",stop:"2021-04-18"},8:{start:"2021-04-19",stop:"2021-04-25"},9:{start:"2021-04-26",stop:"2021-05-02"},10:{start:"2021-05-03",stop:"2021-05-09"},11:{start:"2021-05-10",stop:"2021-05-16"},12:{start:"2021-05-17",stop:"2021-05-23"},13:{start:"2021-05-24",stop:"2021-05-30"},14:{start:"2021-05-31",stop:"2021-06-06"},exam:{start:"2021-05-31",stop:"2021-06-06"}},2213:{1:{start:"2021-05-31",stop:"2021-06-06"},2:{start:"2021-06-07",stop:"2021-06-13"},3:{start:"2021-06-14",stop:"2021-06-20"},4:{start:"2021-06-21",stop:"2021-06-27"},5:{start:"2021-06-28",stop:"2021-07-04"},6:{start:"2021-07-05",stop:"2021-07-11"},7:{start:"2021-07-12",stop:"2021-07-18"},8:{start:"2021-07-19",stop:"2021-07-25"},9:{start:"2021-07-26",stop:"2021-08-01"},10:{start:"2021-08-02",stop:"2021-08-08"},11:{start:"2021-08-09",stop:"2021-08-15"},12:{start:"2021-08-16",stop:"2021-08-22"},13:{start:"2021-08-23",stop:"2021-08-29"},exam:{start:"2021-08-30",stop:"2021-09-05"}},2215:{0:{start:"2021-08-23",stop:"2021-08-29"},1:{start:"2021-08-30",stop:"2021-09-05"},2:{start:"2021-09-06",stop:"2021-09-12"},3:{start:"2021-09-13",stop:"2021-09-19"},4:{start:"2021-09-20",stop:"2021-09-26"},5:{start:"2021-09-27",stop:"2021-10-03"},6:{start:"2021-10-04",stop:"2021-10-10"},7:{start:"2021-10-11",stop:"2021-10-17"},8:{start:"2021-10-18",stop:"2021-10-24"},9:{start:"2021-10-25",stop:"2021-10-31"},10:{start:"2021-11-01",stop:"2021-11-07"},11:{start:"2021-11-08",stop:"2021-11-14"},12:{start:"2021-11-15",stop:"2021-11-21"},13:{start:"2021-11-22",stop:"2021-11-28"},exam:{start:"2021-11-29",stop:"2021-12-05"}},2217:{0:{start:"2021-11-22",stop:"2021-11-28"},1:{start:"2021-11-29",stop:"2021-12-05"},2:{start:"2021-12-06",stop:"2021-12-12"},3:{start:"2021-12-13",stop:"2021-12-19"},4:{start:"2021-12-20",stop:"2021-12-26"},5:{start:"2021-12-27",stop:"2022-01-02"},6:{start:"2022-01-03",stop:"2022-01-09"},7:{start:"2022-01-10",stop:"2022-01-16"},8:{start:"2022-01-17",stop:"2022-01-23"},9:{start:"2022-01-24",stop:"2022-01-30"},10:{start:"2022-01-31",stop:"2022-02-06"},11:{start:"2022-02-07",stop:"2022-02-13"},12:{start:"2022-02-14",stop:"2022-02-20"},13:{start:"2022-02-21",stop:"2022-02-27"},exam:{start:"2022-02-28",stop:"2022-03-04"}},3218:{0:{start:"2021-11-01",stop:"2021-11-07"},1:{start:"2021-11-08",stop:"2021-11-14"},2:{start:"2021-11-15",stop:"2021-11-21"},3:{start:"2021-11-22",stop:"2021-11-28"},4:{start:"2021-11-29",stop:"2021-12-05"},5:{start:"2021-12-06",stop:"2021-12-12"},6:{start:"2021-12-13",stop:"2021-12-19"},7:{start:"2021-12-20",stop:"2021-12-26"},8:{start:"2022-01-10",stop:"2022-01-16"},9:{start:"2022-01-17",stop:"2022-01-23"},10:{start:"2022-01-24",stop:"2022-01-30"},11:{start:"2022-01-31",stop:"2022-02-06"},12:{start:"2022-02-07",stop:"2022-02-13"},13:{start:"2022-02-14",stop:"2022-02-20"},14:{start:"2022-02-21",stop:"2022-02-27"},15:{start:"2022-02-28",stop:"2022-03-06"},exam:{start:"2022-02-17",stop:"2022-02-26"}},3215:{0:{start:"2021-07-12",stop:"2021-07-18"},1:{start:"2021-07-19",stop:"2021-07-25"},2:{start:"2021-07-26",stop:"2021-08-01"},3:{start:"2021-08-02",stop:"2021-08-08"},4:{start:"2021-08-16",stop:"2021-08-22"},5:{start:"2021-08-23",stop:"2021-08-29"},6:{start:"2021-08-30",stop:"2021-09-05"},7:{start:"2021-09-06",stop:"2021-09-12"},8:{start:"2021-09-13",stop:"2021-09-19"},9:{start:"2021-09-20",stop:"2021-09-26"},10:{start:"2021-09-27",stop:"2021-10-03"},11:{start:"2021-10-04",stop:"2021-10-10"},12:{start:"2021-10-11",stop:"2021-10-17"},13:{start:"2021-10-18",stop:"2021-10-24"},14:{start:"2021-10-25",stop:"2021-10-31"},15:{start:"2021-11-01",stop:"2021-11-07"},exam:{start:"2021-10-21",stop:"2021-10-31"}},3211:{0:{start:"2021-03-01",stop:"2021-03-07"},1:{start:"2021-03-08",stop:"2021-03-14"},2:{start:"2021-03-15",stop:"2021-03-21"},3:{start:"2021-03-22",stop:"2021-03-28"},4:{start:"2021-03-29",stop:"2021-04-04"},5:{start:"2021-04-12",stop:"2021-04-18"},6:{start:"2021-04-19",stop:"2021-04-25"},7:{start:"2021-04-26",stop:"2021-05-02"},8:{start:"2021-05-03",stop:"2021-05-09"},9:{start:"2021-05-10",stop:"2021-05-16"},10:{start:"2021-05-17",stop:"2021-05-23"},11:{start:"2021-05-24",stop:"2021-05-30"},12:{start:"2021-05-31",stop:"2021-06-06"},13:{start:"2021-06-07",stop:"2021-06-13"},14:{start:"2021-06-14",stop:"2021-06-20"},15:{start:"2021-06-21",stop:"2021-06-27"},exam:{start:"2021-06-10",stop:"2021-06-19"}},"3215QCM":{0:{start:"2021-07-12",stop:"2021-07-18"},1:{start:"2021-07-19",stop:"2021-07-25"},2:{start:"2021-07-26",stop:"2021-08-01"},3:{start:"2021-08-02",stop:"2021-08-08"},4:{start:"2021-08-09",stop:"2021-08-15"},5:{start:"2021-08-16",stop:"2021-08-22"},6:{start:"2021-08-30",stop:"2021-09-05"},7:{start:"2021-09-06",stop:"2021-09-12"},8:{start:"2021-09-13",stop:"2021-09-19"},9:{start:"2021-09-20",stop:"2021-09-26"},10:{start:"2021-10-04",stop:"2021-10-10"},11:{start:"2021-10-11",stop:"2021-10-17"},12:{start:"2021-10-18",stop:"2021-10-24"},13:{start:"2021-10-25",stop:"2021-10-31"},14:{start:"2021-11-01",stop:"2021-11-07"},15:{start:"2021-11-08",stop:"2021-11-14"},exam:{start:"2021-10-30",stop:"2021-11-13"}},"3211QCM":{0:{start:"2021-02-22",stop:"2021-02-28"},1:{start:"2021-03-01",stop:"2021-03-07"},2:{start:"2021-03-08",stop:"2021-03-14"},3:{start:"2021-03-15",stop:"2021-03-21"},4:{start:"2021-03-22",stop:"2021-03-29"},5:{start:"2021-03-29",stop:"2021-04-04"},6:{start:"2021-04-12",stop:"2021-04-18"},7:{start:"2021-04-19",stop:"2021-04-25"},8:{start:"2021-04-26",stop:"2021-05-02"},9:{start:"2021-05-10",stop:"2021-05-16"},10:{start:"2021-05-17",stop:"2021-05-23"},11:{start:"2021-05-24",stop:"2021-05-30"},12:{start:"2021-05-31",stop:"2021-06-06"},13:{start:"2021-06-07",stop:"2021-03-13"},14:{start:"2021-06-14",stop:"2021-03-20"},15:{start:"2021-06-21",stop:"2021-03-26"},exam:{start:"2021-06-12",stop:"2021-06-26"}},2201:{0:{start:"2020-02-24",stop:"2020-03-01"},1:{start:"2020-03-02",stop:"2020-03-08"},2:{start:"2020-03-09",stop:"2020-03-15"},3:{start:"2020-03-16",stCop:"2020-03-22"},4:{start:"2020-03-23",stop:"2020-03-29"},5:{start:"2020-03-30",stop:"2020-04-05"},6:{start:"2020-04-06",stop:"2020-04-12"},7:{start:"2020-04-13",stop:"2020-04-19"},8:{start:"2020-04-20",stop:"2020-04-26"},9:{start:"2020-04-27",stop:"2020-05-03"},10:{start:"2020-05-04",stop:"2020-05-10"},11:{start:"2020-05-11",stop:"2020-05-17"},12:{start:"2020-05-18",stop:"2020-05-24"},13:{start:"2020-05-25",stop:"2020-05-31"},14:{start:"2020-06-01",stop:"2020-06-05"},exam:{start:"2020-06-01",stop:"2020-06-05"}},2203:{0:{start:"2020-05-25",stop:"2020-05-31"},1:{start:"2020-06-01",stop:"2020-06-07"},2:{start:"2020-06-08",stop:"2020-06-14"},3:{start:"2020-06-15",stop:"2020-06-21"},4:{start:"2020-06-22",stop:"2020-06-28"},5:{start:"2020-06-29",stop:"2020-07-05"},6:{start:"2020-07-06",stop:"2020-07-12"},7:{start:"2020-07-13",stop:"2020-07-19"},8:{start:"2020-07-20",stop:"2020-07-26"},9:{start:"2020-07-27",stop:"2020-08-02"},10:{start:"2020-08-03",stop:"2020-08-09"},11:{start:"2020-08-10",stop:"2020-05-17"},12:{start:"2020-08-17",stop:"2020-05-24"},13:{start:"2020-08-24",stop:"2020-05-31"},14:{start:"2020-08-31",stop:"2020-09-06"},exam:{start:"2020-08-31",stop:"2020-09-04"}},2205:{0:{start:"2020-08-24",stop:"2020-09-30"},1:{start:"2020-08-31",stop:"2020-09-06"},2:{start:"2020-09-07",stop:"2020-09-13"},3:{start:"2020-09-14",stop:"2020-09-20"},4:{start:"2020-09-21",stop:"2020-09-27"},5:{start:"2020-09-28",stop:"2020-10-04"},6:{start:"2020-10-05",stop:"2020-10-11"},7:{start:"2020-10-12",stop:"2020-10-19"},8:{start:"2020-10-19",stop:"2020-10-25"},9:{start:"2020-10-26",stop:"2020-11-01"},10:{start:"2020-11-02",stop:"2020-11-08"},11:{start:"2020-11-09",stop:"2020-11-15"},12:{start:"2020-11-16",stop:"2020-11-22"},13:{start:"2020-11-23",stop:"2020-11-29"},14:{start:"2020-11-30",stop:"2020-12-06"},15:{start:"2020-12-07",stop:"2020-12-13"},exam:{start:"2020-12-07",stop:"2020-12-13"}},2207:{0:{start:"2020-11-23",stop:"2020-11-29"},1:{start:"2020-11-30",stop:"2020-12-06"},2:{start:"2020-12-07",stop:"2020-12-13"},3:{start:"2020-12-14",stop:"2020-12-20"},4:{start:"2020-12-21",stop:"2020-12-27"},5:{start:"2020-12-28",stop:"2021-01-03"},6:{start:"2021-01-04",stop:"2021-01-10"},7:{start:"2021-01-11",stop:"2021-01-17"},8:{start:"2021-01-18",stop:"2021-01-24"},9:{start:"2021-01-25",stop:"2021-01-31"},10:{start:"2021-02-01",stop:"2021-02-07"},11:{start:"2021-02-08",stop:"2021-02-14"},12:{start:"2021-02-15",stop:"2021-02-21"},13:{start:"2021-02-22",stop:"2021-02-28"},14:{start:"2021-03-01",stop:"2021-03-07"},15:{start:"2021-03-08",stop:"2021-03-14"},exam:{start:"2021-03-01",stop:"2021-03-07"}},3208:{0:{start:"2020-10-26",stop:"2020-11-01"},1:{start:"2020-11-02",stop:"2020-11-08"},2:{start:"2020-11-09",stop:"2020-11-15"},3:{start:"2020-11-16",stop:"2020-11-22"},4:{start:"2020-11-23",stop:"2020-11-29"},5:{start:"2020-11-30",stop:"2020-12-06"},6:{start:"2020-12-07",stop:"2020-12-13"},7:{start:"2020-12-14",stop:"2020-12-20"},8:{start:"2021-01-04",stop:"2021-01-10"},9:{start:"2021-01-11",stop:"2021-01-17"},10:{start:"2021-01-18",stop:"2021-01-24"},11:{start:"2021-01-25",stop:"2021-01-31"},12:{start:"2021-02-01",stop:"2021-02-07"},13:{start:"2021-02-08",stop:"2021-02-14"},exam:{start:"2021-02-08",stop:"2021-02-20"}},3205:{0:{start:"2020-07-06",stop:"2020-07-12"},1:{start:"2020-07-13",stop:"2020-07-19"},2:{start:"2020-07-20",stop:"2020-08-26"},3:{start:"2020-07-27",stop:"2020-08-02"},4:{start:"2020-08-03",stop:"2020-08-16"},5:{start:"2020-08-17",stop:"2020-08-23"},6:{start:"2020-08-24",stop:"2020-08-30"},7:{start:"2020-08-31",stop:"2020-09-06"},8:{start:"2020-09-07",stop:"2020-09-13"},9:{start:"2020-09-14",stop:"2020-09-20"},10:{start:"2020-09-21",stop:"2020-09-27"},11:{start:"2020-09-28",stop:"2020-10-04"},12:{start:"2020-10-05",stop:"2020-10-11"},13:{start:"2020-10-12",stop:"2020-10-18"},14:{start:"2020-10-19",stop:"2020-10-25"},15:{start:"2020-10-27",stop:"2020-11-01"},exam:{start:"2020-10-12",stop:"2020-10-18"}},3201:{0:{start:"2020-02-17",stop:"2020-02-23"},1:{start:"2020-02-24",stop:"2020-03-01"},2:{start:"2020-03-02",stop:"2020-03-08"},3:{start:"2020-03-09",stop:"2020-03-15"},4:{start:"2020-03-16",stop:"2020-03-22"},5:{start:"2020-03-23",stop:"2020-03-29"},6:{start:"2020-03-30",stop:"2020-04-05"},7:{start:"2020-04-13",stop:"2020-04-19"},8:{start:"2020-04-20",stop:"2020-04-26"},9:{start:"2020-04-27",stop:"2020-05-03"},10:{start:"2020-05-04",stop:"2020-05-10"},11:{start:"2020-05-11",stop:"2020-05-17"},12:{start:"2020-05-18",stop:"2020-05-24"},13:{start:"2020-05-25",stop:"2020-05-31"},exam:{start:"2020-06-01",stop:"2020-06-07"}},3198:{0:{start:"2019-10-21",stop:"2019-10-27"},1:{start:"2019-10-28",stop:"2019-11-03"},2:{start:"2019-11-04",stop:"2019-11-10"},3:{start:"2019-11-11",stop:"2019-11-17"},4:{start:"2019-11-18",stop:"2019-11-24"},5:{start:"2019-11-25",stop:"2019-12-1"},6:{start:"2019-12-02",stop:"2019-12-08"},7:{start:"2019-12-09",stop:"2019-12-15"},8:{start:"2019-12-16",stop:"2019-12-22"},9:{start:"2020-01-06",stop:"2020-01-12"},10:{start:"2020-01-13",stop:"2020-01-19"},11:{start:"2020-01-20",stop:"2020-01-26"},12:{start:"2020-01-27",stop:"2020-02-02"},13:{start:"2020-02-03",stop:"2020-02-09"},exam:{start:"2020-02-06",stop:"2020-02-15"}},2197:{0:{start:"2019-11-18",stop:"2019-11-24"},1:{start:"2019-11-25",stop:"2019-12-01"},2:{start:"2019-12-02",stop:"2019-12-08"},3:{start:"2019-12-09",stop:"2019-12-15"},4:{start:"2019-12-16",stop:"2019-12-22"},5:{start:"2019-12-23",stop:"2019-09-29"},6:{start:"2019-12-30",stop:"2020-01-05"},7:{start:"2020-01-06",stop:"2020-01-12"},8:{start:"2020-01-13",stop:"2020-01-19"},9:{start:"2020-01-20",stop:"2020-01-26"},10:{start:"2020-01-27",stop:"2020-02-02"},11:{start:"2020-02-03",stop:"2020-02-09"},12:{start:"2020-02-10",stop:"2020-02-16"},13:{start:"2019-02-17",stop:"2020-02-23"},14:{start:"2020-02-24",stop:"2020-03-01"},15:{start:"2020-03-02",stop:"2020-03-08"}},2195:{0:{start:"2019-08-19",stop:"2019-09-25"},1:{start:"2019-08-26",stop:"2019-09-01"},2:{start:"2019-09-02",stop:"2019-09-18"},3:{start:"2019-09-09",stop:"2019-09-15"},4:{start:"2019-09-16",stop:"2019-09-22"},5:{start:"2019-09-23",stop:"2019-09-29"},6:{start:"2019-09-30",stop:"2019-10-06"},7:{start:"2019-10-07",stop:"2019-10-13"},8:{start:"2019-10-14",stop:"2019-08-20"},9:{start:"2019-10-21",stop:"2019-10-27"},10:{start:"2019-10-28",stop:"2019-11-03"},11:{start:"2019-11-04",stop:"2019-11-10"},12:{start:"2019-11-11",stop:"2019-11-17"},13:{start:"2019-11-18",stop:"2019-11-24"},14:{start:"2019-11-25",stop:"2019-12-01"},15:{start:"2019-10-07",stop:"2019-10-13"}},3195:{0:{start:"2019-07-01",stop:"2019-07-07"},1:{start:"2019-07-08",stop:"2019-07-14"},2:{start:"2019-07-15",stop:"2019-07-21"},3:{start:"2019-07-22",stop:"2019-07-28"},4:{start:"2019-07-29",stop:"2019-08-04"},5:{start:"2019-08-05",stop:"2019-08-11"},6:{start:"2019-08-19",stop:"2019-08-25"},7:{start:"2019-08-26",stop:"2019-09-01"},8:{start:"2019-09-02",stop:"2019-09-08"},9:{start:"2019-09-09",stop:"2019-09-15"},10:{start:"2019-09-16",stop:"2019-09-22"},11:{start:"2019-09-23",stop:"2019-09-29"},12:{start:"2019-09-30",stop:"2019-10-06"},13:{start:"2019-10-07",stop:"2019-10-13"},14:{start:"2019-10-14",stop:"2019-10-20"},15:{start:"2019-10-21",stop:"2019-10-27"},exam:{start:"2019-10-10",stop:"2019-10-19"}},3191:{0:{start:"2019-02-18",stop:"2019-02-24"},1:{start:"2019-02-25",stop:"2019-03-03"},2:{start:"2019-03-04",stop:"2019-03-10"},3:{start:"2019-03-11",stop:"2019-03-17"},4:{start:"2019-03-18",stop:"2019-03-24"},5:{start:"2019-03-25",stop:"2019-03-31"},6:{start:"2019-04-01",stop:"2019-04-07"},7:{start:"2019-04-08",stop:"2019-04-14"},8:{start:"2019-04-22",stop:"2019-04-28"},9:{start:"2019-04-29",stop:"2019-05-05"},10:{start:"2019-05-06",stop:"2019-05-12"},11:{start:"2019-05-13",stop:"2019-05-19"},12:{start:"2019-05-20",stop:"2019-05-26"},13:{start:"2019-05-27",stop:"2019-06-02"},14:{start:"2019-06-03",stop:"2019-06-09"},15:{start:"2019-06-10",stop:"2019-06-17"},exam:{start:"2019-05-30",stop:"2019-06-08"}}};class UniversityDateCalendar{constructor(strm="3225"){if(UniversityDateCalendar._instance)return UniversityDateCalendar._instance;UniversityDateCalendar._instance=this,this.defaultPeriod="3225",strm&&CALENDAR[strm]&&(this.defaultPeriod=strm)}setStudyPeriod(studyPeriod){this.defaultPeriod=studyPeriod}getWeekDetails(week="all",period=this.defaultPeriod){return"all"===week?CALENDAR[period]:("string"==typeof week&&week.startsWith("Week")&&(week=parseInt(week.substring(4))),period in CALENDAR&&week in CALENDAR[period]?CALENDAR[period][week]:null)}getDate(week,startWeek=!0,dayOfWeek="Monday"){let date={date:"",month:"",week:week,year:0};dayOfWeek=dayOfWeek.toLowerCase();let weekDetails=this.getWeekDetails(week);if(null===weekDetails)return date;let d=new Date(weekDetails.start);const dayToNum={tuesday:1,tue:1,wednesday:2,wed:2,thursday:3,thu:3,friday:4,fri:4,saturday:5,sat:5,sunday:6,sun:6};return"monday"!==dayOfWeek&&(date.day=dayOfWeek.charAt(0).toUpperCase()+dayOfWeek.substring(1,3),dayOfWeek in dayToNum&&d.setDate(d.getDate()+dayToNum[dayOfWeek.toLowerCase()])),date.month=MONTHS[d.getMonth()],date.date=d.getDate(),date.year=d.getFullYear(),date}getCurrentPeriod(courseCode){if(!courseCode.match(/\(([^)]+)\)/)){if(courseCode.startsWith("DEV_")){const match=/^DEV_([^_]*)_([\d]*)$/.exec(courseCode);return match?match[2]:this.defaultPeriod}return this.defaultPeriod}const canvasCourseCode=courseCode.match(/\(([^)]+)\)/)[1],match=/^([^_]*)_([\d][\d][\d][\d])(_.*)*$/.exec(canvasCourseCode);return match?match[2]:this.defaultPeriod}}const DEBUG=!0;class cc_Controller{constructor(){DEBUG&&console.log("-------------- cc_Controller.constructor()"),this.injectShoelace(),this.setContext(),DEBUG&&console.log(`cc_Controller: location = ${location}`),DEBUG&&console.log(`cc_Controller: courseId = ${this.courseId}`),DEBUG&&console.log(`cc_Controller: modulesPage = ${this.modulesPage}`),DEBUG&&console.log(`cc_Controller: homeModulesPage = ${this.homeModulesPage}`),DEBUG&&console.log(`cc_Controller: editMode = ${this.editMode}`),DEBUG&&console.log(`cc_Controller: ccOn = ${this.ccOn}`),this.configFileDetails=null,this.cc_configuration=null,this.lastCollectionViewed=null,this.configurationStore=new cc_ConfigurationStore(this),(this.modulesPage||this.homeModulesPage)&&(this.setCsrfToken(),DEBUG&&console.log(`cc_Controller: csrf = ${this.csrf}`),this.requestCourseObject())}injectShoelace(){if(document.querySelector("#shoelace.js"))return;const shoelaceScript=document.createElement("script");shoelaceScript.type="module",shoelaceScript.id="shoelace.js",shoelaceScript.src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/shoelace.js",document.head.appendChild(shoelaceScript);const shoelaceLink=document.createElement("link");shoelaceLink.rel="stylesheet",shoelaceLink.href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/themes/light.css",document.head.appendChild(shoelaceLink)}async requestCourseObject(){let callUrl=`/api/v1/courses/${this.courseId}`;DEBUG&&console.log(`cc_Controller: requestCourseOjbect: callUrl = ${callUrl}`);const response=await fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.csrfToken}});if(!response.ok)throw new Error(`cc_Controller: requestCourseObject: error ${response.status}`);const data=await response.json();0===data.length?DEBUG&&console.log("cc_Controller: requestCourseObject: couldn't get course object"):(this.courseObject=data,this.generateSTRM(),this.requestModuleInformation())}generateSTRM(){this.hasOwnProperty("calendar")||(this.calendar=new UniversityDateCalendar),this.studyPeriod=this.calendar.getCurrentPeriod(this.courseObject.course_code),this.calendar.setStudyPeriod(this.studyPeriod),this.parseStrm()}parseStrm(){if(this.type=void 0,this.year=void 0,this.period=void 0,void 0===this.strm)return;const strm=this.strm.split("");if(strm.length>4)return void console.error(`cc_Controller: parseStrm: strm too long: ${this.strm}`);for(let i=0;i<strm.length;i++)if(isNaN(strm[i]))return void console.error(`cc_Controller: parseStrm: strm not numeric: ${this.strm}`);this.type=strm[0],this.year=`20${strm[1]}${strm[2]}`,this.period=strm[3];let translate={1:1,5:2,8:3};2===this.type&&(translate={1:1,2:1,3:2,4:2,5:3,6:3,7:4}),this.period=translate[this.period]}async requestModuleInformation(responseHandler){DEBUG&&console.log(`cc_Controller: requestModuleInformation: for ${this.courseId}`);let callUrl=`/api/v1/courses/${this.courseId}/modules?include=items&per_page=500`;DEBUG&&console.log(`cc_Controller: requestModuleInformation: callUrl = ${callUrl}`);const response=await fetch(callUrl,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":this.csrf}});if(!response.ok)throw new Error(`cc_Controller: requestModuleInformation: error ${response.status}`);const data=await response.json();DEBUG&&console.log(`cc_Controller: requestModuleInformation: json = ${JSON.stringify(data)}`),this.moduleDetails=data,responseHandler?responseHandler(response.ok):this.configurationStore.getConfiguration()}mergeModuleDetails(execute=!0){const canvasModules=this.moduleDetails,collectionsModules=this.cc_configuration.MODULES;this.mergedModuleDetails={},this.removeDeletedModules(collectionsModules,canvasModules);let numCalculator={};for(let i=0;i<canvasModules.length;i++){let details={};const canvasModule=canvasModules[i],canvasModuleId=canvasModule.id;for(let key in canvasModule)details[key]=canvasModules[i][key];let ccModule=collectionsModules[canvasModuleId];if(ccModule){const skipFields=["name"];ccModule.name=canvasModule.name;for(let key in ccModule)skipFields.includes(key)||(details[key]=ccModule[key])}if(details.hasOwnProperty("num"))details.actualNum=details.num;else{const collectionName=details.collectionName,label=details.label;numCalculator.hasOwnProperty(collectionName)&&numCalculator[collectionName].hasOwnProperty(label)?details.actualNum=++numCalculator[collectionName][label]:(numCalculator.hasOwnProperty(collectionName)||(numCalculator[collectionName]={}),numCalculator[collectionName][label]=1,details.actualNum=1)}this.mergedModuleDetails[canvasModuleId]=details}}removeDeletedModules(collectionsModules,canvasModules){let canvasModuleIds={};for(let i=0;i<canvasModules.length;i++)canvasModuleIds[canvasModules[i].id]=!0;for(let moduleId in collectionsModules)canvasModuleIds.hasOwnProperty(moduleId)||(console.log(`cc_Controller: removeDeletedModules: removing module ${moduleId} from collections configuration`),alert(`cc_Controller: removeDeletedModules: removing module ${moduleId} from collections configuration`),delete collectionsModules[moduleId])}execute(){if(this.modulesPage||this.homeModulesPage){if(this.configurationStore.configConverted&&this.saveConfig(),DEBUG&&console.log("-------------- cc_Controller.execute()"),this.editMode){const configShowSwitch=document.getElementById("configShowSwitch");configShowSwitch&&(configShowSwitch.style.display="inline-block"),null===this.cc_configuration?(DEBUG&&console.log("-------------- cc_Controller.execute() Edit Mode - no config"),this.showConfiguration()):(DEBUG&&console.log("-------------- cc_Controller.execute() Edit Mode - config"),this.showConfiguration(),this.ccOn&&this.showCollections())}else null!==this.cc_configuration&&(DEBUG&&console.log("-------------- cc_Controller.execute() Students Mode - config"),this.ccOn&&this.showCollections());this.ccOn&&this.showJuice()}else DEBUG&&console.log('-------------- cc_Controller.execute() ERROR SHOULDN"T BE RUNNING')}thisShowModules(){const modules=document.getElementsByClassName("editable_context_module");for(let i=0;i<modules.length;i++){const module=modules[i];"none"===module.style.display&&(module.style.display="block")}}turnOff(){let cc_canvas_collection=document.getElementById("cc-canvas-collections");cc_canvas_collection&&cc_canvas_collection.parentNode.removeChild(cc_canvas_collection),document.querySelectorAll("div.cc-module-config").forEach((moduleConfig=>{moduleConfig.remove()})),this.thisShowModules();let cc_config_wrapper=document.getElementById("cc-config-wrapper");if(cc_config_wrapper){cc_config_wrapper.remove();let cc_switch_container=document.querySelector("div.cc-switch-container");cc_switch_container&&(cc_switch_container.style.borderBottom="1px solid #c7cdd1")}let cc_2_clipboard=document.getElementById("cc_2_clipboard");cc_2_clipboard&&cc_2_clipboard.remove();const configShowSwitch=document.getElementById("configShowSwitch");configShowSwitch&&(configShowSwitch.style.display="none")}showJuice(){"function"==typeof juice&&(console.log("------ setting up juice"),this.juiceController=new juiceController(this))}showConfiguration(){DEBUG&&console.log("-------------- cc_Controller.showConfiguration()"),this.configurationController=new cc_ConfigurationController(this)}showCollections(){DEBUG&&console.log("-------------- cc_Controller.showCollectionsStudentMode()"),this.collectionsController=new cc_CollectionsController(this)}updateCurrentRepresentation(justRepresentation=!1){this.mergeModuleDetails(!1),this.collectionsController.view.updateCurrentRepresentation(justRepresentation)}checkQueryString(){}setContext(){window.location.href;let url=new URL(window.location.href),hash=url.hash;if(hash){let checkNum=hash.match(/cc-collection-(\d+)/);checkNum&&(this.URLCollectionNum=parseInt(checkNum[1])-1)}url.hash="",this.documentUrl=url.href;let courseId=ENV.COURSE_ID||ENV.course_id;if(!courseId){let urlPartIncludingCourseId=this.documentUrl.split("courses/")[1];urlPartIncludingCourseId&&(courseId=urlPartIncludingCourseId.split("/")[0])}this.courseId=courseId;let regEx=new RegExp(`courses/${courseId}/modules(#*|#[^/]+)$`);this.modulesPage=regEx.test(this.documentUrl),regEx=new RegExp(`courses/${courseId}$`),this.homeModulesPage=regEx.test(this.documentUrl)&&null!==document.getElementById("context_modules"),this.editMode=null!==document.getElementById("easy_student_view"),this.ccOn=!1}setCsrfToken(){let csrfRegex=new RegExp("^_csrf_token=(.*)$"),cookies=document.cookie.split(";");for(let i=0;i<cookies.length;i++){let cookie=cookies[i].trim(),match=csrfRegex.exec(cookie);if(match){this.csrf=decodeURIComponent(match[1]);break}}}saveConfig(){this.configurationStore.saveConfiguration()}completedSaveConfig(){}failedSaveConfig(error){alert(`Failed to save configuration - ${error}`)}retrieveLastCollectionViewed(){let hostname=window.location.hostname;this.lastCollectionViewed=localStorage.getItem(`cc-${hostname}-${this.courseId}-last-collection`)}setLastCollectionViewed(collectionName){this.lastCollectionViewed=collectionName;let hostname=window.location.hostname;localStorage.setItem(`cc-${hostname}-${this.courseId}-last-collection`,this.lastCollectionViewed)}}let controller=new cc_Controller;